!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager"),t=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),n=tinymce.util.Tools.resolve("tinymce.EditorManager"),r=tinymce.util.Tools.resolve("tinymce.Env"),i=tinymce.util.Tools.resolve("tinymce.util.Tools"),c=function(e){return e.getParam("importcss_merge_classes")},o=function(e){return e.getParam("importcss_exclusive")},s=function(e){return e.getParam("importcss_selector_converter")},u=function(e){return e.getParam("importcss_selector_filter")},l=function(e){return e.getParam("importcss_groups")},a=function(e){return e.getParam("importcss_append")},f=function(e){return e.getParam("importcss_file_filter")},m=function(e){var t=r.cacheSuffix;return"string"==typeof e&&(e=e.replace("?"+t,"").replace("&"+t,"")),e},g=function(e,t){var r=e.settings,i=!1!==r.skin&&(r.skin||"lightgray");if(i){return t===(r.skin_url?e.documentBaseURI.toAbsolute(r.skin_url):n.baseURL+"/skins/"+i)+"/content"+(e.inline?".inline":"")+".min.css"}return!1},p=function(e){return"string"==typeof e?function(t){return-1!==t.indexOf(e)}:e instanceof RegExp?function(t){return e.test(t)}:e},v=function(e,t){var n,r=/^(?:([a-z0-9\-_]+))?(\.[a-z0-9_\-\.]+)$/i.exec(t);if(r){var o=r[1],s=r[2].substr(1).split(".").join(" "),u=i.makeMap("a,img");return r[1]?(n={title:t},e.schema.getTextBlockElements()[o]?n.block=o:e.schema.getBlockElements()[o]||u[o.toLowerCase()]?n.selector=o:n.inline=o):r[2]&&(n={inline:"span",title:t.substr(1),classes:s}),!1!==c(e)?n.classes=s:n.attributes={"class":s},n}},h=function(e,t){return null===t||!1!==o(e)},d=v,y=function(e){e.on("renderFormatsMenu",function(n){var r={},c=p(u(e)),o=n.control,d=function(e){return i.map(e,function(e){return i.extend({},e,{original:e,selectors:{},filter:p(e.filter),item:{text:e.title,menu:[]}})})}(l(e)),y=function(n,c){if(function(e,t,n,r){return!(h(e,n)?t in r:t in n.selectors)}(e,n,c,r)){!function(e,t,n,r){h(e,n)?r[t]=!0:n.selectors[t]=!0}(e,n,c,r);var u=function(e,t,n,r){return(r&&r.selector_converter?r.selector_converter:s(e)?s(e):function(){return v(e,n)}).call(t,n,r)}(e,e.plugins.importcss,n,c);if(u){var l=u.name||t.DOM.uniqueId();return e.formatter.register(l,u),i.extend({},o.settings.itemDefaults,{text:u.title,format:l})}}return null};a(e)||o.items().remove(),i.each(function(e,t,n){function r(t,o){var s,u=t.href;if((u=m(u))&&n(u,o)&&!g(e,u)){i.each(t.imports,function(e){r(e,!0)});try{s=t.cssRules||t.rules}catch(l){}i.each(s,function(e){e.styleSheet?r(e.styleSheet,!0):e.selectorText&&i.each(e.selectorText.split(","),function(e){c.push(i.trim(e))})})}}var c=[],o={};i.each(e.contentCSS,function(e){o[e]=!0}),n||(n=function(e,t){return t||o[e]});try{i.each(t.styleSheets,function(e){r(e)})}catch(s){}return c}(e,n.doc||e.getDoc(),p(f(e))),function(e){if(-1===e.indexOf(".mce-")&&(!c||c(e))){var t=function(e,t){return i.grep(e,function(e){return!e.filter||e.filter(t)})}(d,e);if(t.length>0)i.each(t,function(t){var n=y(e,t);n&&t.item.menu.push(n)});else{var n=y(e,null);n&&o.add(n)}}}),i.each(d,function(e){e.item.menu.length>0&&o.add(e.item)}),n.control.renderNew()})},_=function(e){return{convertSelectorToFormat:function(t){return d(e,t)}}};e.add("importcss",function(e){return y(e),_(e)})}();