!function(){"use strict";function n(n,e){return t(document.createElement("canvas"),n,e)}function e(n){return n.getContext("2d")}function t(n,e,t){return n.width=e,n.height=t,n}function r(n){return new tf(function(e,t){function r(){a(),e(u)}function o(){a(),t("Unable to load data of type "+n.type+": "+i)}var i=URL.createObjectURL(n),u=new Image,a=function(){u.removeEventListener("load",r),u.removeEventListener("error",o)};u.addEventListener("load",r),u.addEventListener("error",o),u.src=i,u.complete&&r()})}function o(n){return new tf(function(e){var t=new XMLHttpRequest;t.open("GET",n,!0),t.responseType="blob",t.onload=function(){200==this.status&&e(this.response)},t.send()})}function i(n){var e=n.split(","),t=/data:([^;]+)/.exec(e[0]);if(!t)return p.none();for(var r=t[1],o=e[1],i=af.atob(o),u=i.length,a=Math.ceil(u/1024),c=new Array(a),s=0;s<a;++s){for(var f=1024*s,l=Math.min(f+1024,u),d=new Array(l-f),m=f,g=0;m<l;++g,++m)d[g]=i[m].charCodeAt(0);c[s]=uf(d)}return p.some(rf(c,{type:r}))}function u(n){return new tf(function(e,t){i(n).fold(function(){t("uri is not base64: "+n)},e)})}function a(n){return new tf(function(e){var t=new of;t.onloadend=function(){e(t.result)},t.readAsDataURL(n)})}var c=function(n){return function(){return n}},s={noop:function(){},noarg:function(n){return function(){return n()}},compose:function(n,e){return function(){return n(e.apply(null,arguments))}},constant:c,identity:function(n){return n},tripleEquals:function(n,e){return n===e},curry:function(n){for(var e=new Array(arguments.length-1),t=1;t<arguments.length;t++)e[t-1]=arguments[t];return function(){for(var t=new Array(arguments.length),r=0;r<t.length;r++)t[r]=arguments[r];var o=e.concat(t);return n.apply(null,o)}},not:function(n){return function(){return!n.apply(null,arguments)}},die:function(n){return function(){throw new Error(n)}},apply:function(n){return n()},call:function(n){n()},never:c(!1),always:c(!0)},f=s.never,l=s.always,d=function(){return m},m=function(){var n=function(n){return n.isNone()},e=function(n){return n()},t=function(n){return n},r={fold:function(n,e){return n()},is:f,isSome:f,isNone:l,getOr:t,getOrThunk:e,getOrDie:function(n){throw new Error(n||"error: getOrDie called on none.")},or:t,orThunk:e,map:d,ap:d,each:function(){},bind:d,flatten:d,exists:f,forall:l,filter:d,equals:n,equals_:n,toArray:function(){return[]},toString:s.constant("none()")};return Object.freeze&&Object.freeze(r),r}(),g=function(n){var e=function(){return n},t=function(){return o},r=function(e){return e(n)},o={fold:function(e,t){return t(n)},is:function(e){return n===e},isSome:l,isNone:f,getOr:e,getOrThunk:e,getOrDie:e,or:t,orThunk:t,map:function(e){return g(e(n))},ap:function(e){return e.fold(d,function(e){return g(e(n))})},each:function(e){e(n)},bind:r,flatten:e,exists:r,forall:r,filter:function(e){return e(n)?o:m},equals:function(e){return e.is(n)},equals_:function(e,t){return e.fold(f,function(e){return t(n,e)})},toArray:function(){return[n]},toString:function(){return"some("+n+")"}};return o},p={some:g,none:d,from:function(n){return null===n||n===undefined?m:g(n)}},h=function(){var n=Array.prototype.indexOf;return n===undefined?function(n,e){return T(n,e)}:function(e,t){return n.call(e,t)}}(),v=function(n,e){return h(n,e)>-1},y=function(n,e){for(var t=n.length,r=new Array(t),o=0;o<t;o++){var i=n[o];r[o]=e(i,o,n)}return r},b=function(n,e){for(var t=0,r=n.length;t<r;t++){e(n[t],t,n)}},w=function(n,e){for(var t=n.length-1;t>=0;t--){e(n[t],t,n)}},S=function(n,e){for(var t=[],r=0,o=n.length;r<o;r++){var i=n[r];e(i,r,n)&&t.push(i)}return t},x=function(n,e){for(var t=0,r=n.length;t<r;t++){if(e(n[t],t,n))return p.some(t)}return p.none()},T=function(n,e){for(var t=0,r=n.length;t<r;++t)if(n[t]===e)return t;return-1},O=Array.prototype.push,k=function(n){for(var e=[],t=0,r=n.length;t<r;++t){if(!Array.prototype.isPrototypeOf(n[t]))throw new Error("Arr.flatten item "+t+" was not an array, input: "+n);O.apply(e,n[t])}return e},C=function(n,e){for(var t=0,r=n.length;t<r;++t){if(!0!==e(n[t],t,n))return!1}return!0},E=Array.prototype.slice,D={map:y,each:b,eachr:w,partition:function(n,e){for(var t=[],r=[],o=0,i=n.length;o<i;o++){var u=n[o];(e(u,o,n)?t:r).push(u)}return{pass:t,fail:r}},filter:S,groupBy:function(n,e){if(0===n.length)return[];for(var t=e(n[0]),r=[],o=[],i=0,u=n.length;i<u;i++){var a=n[i],c=e(a);c!==t&&(r.push(o),o=[]),t=c,o.push(a)}return 0!==o.length&&r.push(o),r},indexOf:function(n,e){var t=h(n,e);return-1===t?p.none():p.some(t)},foldr:function(n,e,t){return w(n,function(n){t=e(t,n)}),t},foldl:function(n,e,t){return b(n,function(n){t=e(t,n)}),t},find:function(n,e){for(var t=0,r=n.length;t<r;t++){var o=n[t];if(e(o,t,n))return p.some(o)}return p.none()},findIndex:x,flatten:k,bind:function(n,e){var t=y(n,e);return k(t)},forall:C,exists:function(n,e){return x(n,e).isSome()},contains:v,equal:function(n,e){return n.length===e.length&&C(n,function(n,t){return n===e[t]})},reverse:function(n){var e=E.call(n,0);return e.reverse(),e},chunk:function(n,e){for(var t=[],r=0;r<n.length;r+=e){var o=n.slice(r,r+e);t.push(o)}return t},difference:function(n,e){return S(n,function(n){return!v(e,n)})},mapToObject:function(n,e){for(var t={},r=0,o=n.length;r<o;r++){var i=n[r];t[String(i)]=e(i,r)}return t},pure:function(n){return[n]},sort:function(n,e){var t=E.call(n,0);return t.sort(e),t},range:function(n,e){for(var t=[],r=0;r<n;r++)t.push(e(r));return t},head:function(n){return 0===n.length?p.none():p.some(n[0])},last:function(n){return 0===n.length?p.none():p.some(n[n.length-1])}},A="undefined"!=typeof window?window:Function("return this;")(),M=function(n,e){for(var t=e!==undefined&&null!==e?e:A,r=0;r<n.length&&t!==undefined&&null!==t;++r)t=t[n[r]];return t},R=function(n,e){var t=n.split(".");return M(t,e)},B=function(n,e){var t=function(n,e){return R(n,e)}(n,e);if(t===undefined||null===t)throw n+" not available on this browser";return t},I=function(){return B("Node")},F=function(n,e,t){return 0!=(n.compareDocumentPosition(e)&t)},H=function(n,e){return F(n,e,I().DOCUMENT_POSITION_CONTAINED_BY)},N=function(n){var e,t=!1;return function(){return t||(t=!0,e=n.apply(null,arguments)),e}},V=function(n,e){var t=function(n,e){for(var t=0;t<n.length;t++){var r=n[t];if(r.test(e))return r}return undefined}(n,e);if(!t)return{major:0,minor:0};var r=function(n){return Number(e.replace(t,"$"+n))};return L(r(1),r(2))},j=function(){return L(0,0)},L=function(n,e){return{major:n,minor:e}},P={nu:L,detect:function(n,e){var t=String(e).toLowerCase();return 0===n.length?j():V(n,t)},unknown:j},W=function(n,e){return function(){return e===n}},U=function(n){var e=n.current;return{current:e,version:n.version,isEdge:W("Edge",e),isChrome:W("Chrome",e),isIE:W("IE",e),isOpera:W("Opera",e),isFirefox:W("Firefox",e),isSafari:W("Safari",e)}},z={unknown:function(){return U({current:undefined,version:P.unknown()})},nu:U,edge:s.constant("Edge"),chrome:s.constant("Chrome"),ie:s.constant("IE"),opera:s.constant("Opera"),firefox:s.constant("Firefox"),safari:s.constant("Safari")},G=function(n,e){return function(){return e===n}},$=function(n){var e=n.current;return{current:e,version:n.version,isWindows:G("Windows",e),isiOS:G("iOS",e),isAndroid:G("Android",e),isOSX:G("OSX",e),isLinux:G("Linux",e),isSolaris:G("Solaris",e),isFreeBSD:G("FreeBSD",e)}},_={unknown:function(){return $({current:undefined,version:P.unknown()})},nu:$,windows:s.constant("Windows"),ios:s.constant("iOS"),android:s.constant("Android"),linux:s.constant("Linux"),osx:s.constant("OSX"),solaris:s.constant("Solaris"),freebsd:s.constant("FreeBSD")},q=function(n,e){var t=String(e).toLowerCase();return D.find(n,function(n){return n.search(t)})},K=function(n,e){return q(n,e).map(function(n){var t=P.detect(n.versionRegexes,e);return{current:n.name,version:t}})},X=function(n,e){return q(n,e).map(function(n){var t=P.detect(n.versionRegexes,e);return{current:n.name,version:t}})},Y=function(n,e){return n.replace(/\${([^{}]*)}/g,function(n,t){var r=e[t];return function(n){var e=typeof n;return"string"===e||"number"===e}(r)?r:n})},J=function(n,e){return-1!==n.indexOf(e)},Q=function(n){return n.replace(/^\s+|\s+$/g,"")},Z=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,nn=function(n){return function(e){return J(e,n)}},en=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:function(n){return J(n,"edge/")&&J(n,"chrome")&&J(n,"safari")&&J(n,"applewebkit")}},{name:"Chrome",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Z],search:function(n){return J(n,"chrome")&&!J(n,"chromeframe")}},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:function(n){return J(n,"msie")||J(n,"trident")}},{name:"Opera",versionRegexes:[Z,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:nn("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:nn("firefox")},{name:"Safari",versionRegexes:[Z,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:function(n){return(J(n,"safari")||J(n,"mobile/"))&&J(n,"applewebkit")}}],tn=[{name:"Windows",search:nn("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:function(n){return J(n,"iphone")||J(n,"ipad")},versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:nn("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"OSX",search:nn("os x"),versionRegexes:[/.*?os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:nn("linux"),versionRegexes:[]},{name:"Solaris",search:nn("sunos"),versionRegexes:[]},{name:"FreeBSD",search:nn("freebsd"),versionRegexes:[]}],rn={browsers:s.constant(en),oses:s.constant(tn)},on=function(n){var e=rn.browsers(),t=rn.oses(),r=K(e,n).fold(z.unknown,z.nu),o=X(t,n).fold(_.unknown,_.nu);return{browser:r,os:o,deviceType:function(n,e,t){var r=n.isiOS()&&!0===/ipad/i.test(t),o=n.isiOS()&&!r,i=n.isAndroid()&&3===n.version.major,u=n.isAndroid()&&4===n.version.major,a=r||i||u&&!0===/mobile/i.test(t),c=n.isiOS()||n.isAndroid(),f=c&&!a,l=e.isSafari()&&n.isiOS()&&!1===/safari/i.test(t);return{isiPad:s.constant(r),isiPhone:s.constant(o),isTablet:s.constant(a),isPhone:s.constant(f),isTouch:s.constant(c),isAndroid:n.isAndroid,isiOS:n.isiOS,isWebView:s.constant(l)}}(o,r,n)}},un={detect:N(function(){var n=navigator.userAgent;return on(n)})},an=function(n){if(null===n||n===undefined)throw new Error("Node cannot be null or undefined");return{dom:s.constant(n)}},cn={fromHtml:function(n,e){var t=(e||document).createElement("div");if(t.innerHTML=n,!t.hasChildNodes()||t.childNodes.length>1)throw console.error("HTML does not have a single root node",n),"HTML must have a single root node";return an(t.childNodes[0])},fromTag:function(n,e){var t=(e||document).createElement(n);return an(t)},fromText:function(n,e){var t=(e||document).createTextNode(n);return an(t)},fromDom:an,fromPoint:function(n,e,t){return p.from(n.dom().elementFromPoint(e,t)).map(an)}},sn=8,fn=9,ln=1,dn=3,mn=ln,gn=fn,pn=function(n){return n.nodeType!==mn&&n.nodeType!==gn||0===n.childElementCount},hn=function(n,e){var t=e===undefined?document:e.dom();return pn(t)?[]:D.map(t.querySelectorAll(n),cn.fromDom)},vn=function(n,e){var t=n.dom();if(t.nodeType!==mn)return!1;if(t.matches!==undefined)return t.matches(e);if(t.msMatchesSelector!==undefined)return t.msMatchesSelector(e);if(t.webkitMatchesSelector!==undefined)return t.webkitMatchesSelector(e);if(t.mozMatchesSelector!==undefined)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")},yn=function(n,e){var t=e===undefined?document:e.dom();return pn(t)?p.none():p.from(t.querySelector(n)).map(cn.fromDom)},bn=function(n,e){return n.dom()===e.dom()},wn=(un.detect().browser.isIE(),bn),Sn=function(n,e){return wn(n.element(),e.event().target())},xn={contextmenu:s.constant("contextmenu"),touchstart:s.constant("touchstart"),touchmove:s.constant("touchmove"),touchend:s.constant("touchend"),gesturestart:s.constant("gesturestart"),mousedown:s.constant("mousedown"),mousemove:s.constant("mousemove"),mouseout:s.constant("mouseout"),mouseup:s.constant("mouseup"),mouseover:s.constant("mouseover"),focusin:s.constant("focusin"),keydown:s.constant("keydown"),input:s.constant("input"),change:s.constant("change"),focus:s.constant("focus"),click:s.constant("click"),transitionend:s.constant("transitionend"),selectstart:s.constant("selectstart")},Tn={tap:s.constant("alloy.tap")},On={focus:s.constant("alloy.focus"),postBlur:s.constant("alloy.blur.post"),receive:s.constant("alloy.receive"),execute:s.constant("alloy.execute"),focusItem:s.constant("alloy.focus.item"),tap:Tn.tap,tapOrClick:un.detect().deviceType.isTouch()?Tn.tap:xn.click,longpress:s.constant("alloy.longpress"),sandboxClose:s.constant("alloy.sandbox.close"),systemInit:s.constant("alloy.system.init"),windowScroll:s.constant("alloy.system.scroll"),attachedToDom:s.constant("alloy.system.attached"),detachedFromDom:s.constant("alloy.system.detached"),changeTab:s.constant("alloy.change.tab"),dismissTab:s.constant("alloy.dismiss.tab")},kn=function(n){return function(e){return function(n){if(null===n)return"null";var e=typeof n;return"object"===e&&Array.prototype.isPrototypeOf(n)?"array":"object"===e&&String.prototype.isPrototypeOf(n)?"string":e}(e)===n}},Cn={isString:kn("string"),isObject:kn("object"),isArray:kn("array"),isNull:kn("null"),isBoolean:kn("boolean"),isUndefined:kn("undefined"),isFunction:kn("function"),isNumber:kn("number")},En=function(n){return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(0===e.length)throw new Error("Can't merge zero objects");for(var r={},o=0;o<e.length;o++){var i=e[o];for(var u in i)i.hasOwnProperty(u)&&(r[u]=n(r[u],i[u]))}return r}},Dn=En(function(n,e){return Cn.isObject(n)&&Cn.isObject(e)?Dn(n,e):e}),An=En(function(n,e){return e}),Mn={deepMerge:Dn,merge:An},Rn=function(){var n=Object.keys;return n===undefined?function(n){var e=[];for(var t in n)n.hasOwnProperty(t)&&e.push(t);return e}:n}(),Bn=function(n,e){for(var t=Rn(n),r=0,o=t.length;r<o;r++){var i=t[r];e(n[i],i,n)}},In=function(n,e){var t={};return Bn(n,function(r,o){var i=e(r,o,n);t[i.k]=i.v}),t},Fn=function(n,e){var t=[];return Bn(n,function(n,r){t.push(e(n,r))}),t},Hn=function(n){return Fn(n,function(n){return n})},Nn={bifilter:function(n,e){var t={},r={};return Bn(n,function(n,o){(e(n,o)?t:r)[o]=n}),{t:t,f:r}},each:Bn,map:function(n,e){return In(n,function(n,t,r){return{k:t,v:e(n,t,r)}})},mapToArray:Fn,tupleMap:In,find:function(n,e){for(var t=Rn(n),r=0,o=t.length;r<o;r++){var i=t[r],u=n[i];if(e(u,i,n))return p.some(u)}return p.none()},keys:Rn,values:Hn,size:function(n){return Hn(n).length}},Vn=function(n,e){jn(n,n.element(),e,{})},jn=function(n,e,t,r){var o=Mn.deepMerge({target:e},r);n.getSystem().triggerEvent(t,e,Nn.map(o,s.constant))},Ln=Vn,Pn=function(n,e,t){jn(n,n.element(),e,t)},Wn=function(n){Vn(n,On.execute())},Un=function(n,e,t){jn(n,e,t,{})},zn=function(n,e,t,r){n.getSystem().triggerEvent(t,e,r.event())},Gn=function(n,e){n.getSystem().triggerFocus(e,n.element())},$n=function(n){if(!Cn.isArray(n))throw new Error("cases must be an array");if(0===n.length)throw new Error("there must be at least one case");var e=[],t={};return D.each(n,function(r,o){var i=Nn.keys(r);if(1!==i.length)throw new Error("one and only one name per case");var u=i[0],a=r[u];if(t[u]!==undefined)throw new Error("duplicate key detected:"+u);if("cata"===u)throw new Error("cannot have a case named cata (sorry)");if(!Cn.isArray(a))throw new Error("case arguments must be an array");e.push(u),t[u]=function(){var t=arguments.length;if(t!==a.length)throw new Error("Wrong number of arguments to case "+u+". Expected "+a.length+" ("+a+"), got "+t);for(var r=new Array(t),i=0;i<r.length;i++)r[i]=arguments[i];return{fold:function(){if(arguments.length!==n.length)throw new Error("Wrong number of arguments to fold. Expected "+n.length+", got "+arguments.length);return arguments[o].apply(null,r)},match:function(n){var t=Nn.keys(n);if(e.length!==t.length)throw new Error("Wrong number of arguments to match. Expected: "+e.join(",")+"\nActual: "+t.join(","));if(!D.forall(e,function(n){return D.contains(t,n)}))throw new Error("Not all branches were specified when using match. Specified: "+t.join(", ")+"\nRequired: "+e.join(", "));return n[u].apply(null,r)},log:function(n){console.log(n,{constructors:e,constructor:u,params:r})}}}}),t},_n=$n([{strict:[]},{defaultedThunk:["fallbackThunk"]},{asOption:[]},{asDefaultedOptionThunk:["fallbackThunk"]},{mergeWithThunk:["baseThunk"]}]),qn={strict:_n.strict,asOption:_n.asOption,defaulted:function(n){return _n.defaultedThunk(s.constant(n))},defaultedThunk:_n.defaultedThunk,asDefaultedOption:function(n){return _n.asDefaultedOptionThunk(s.constant(n))},asDefaultedOptionThunk:_n.asDefaultedOptionThunk,mergeWith:function(n){return _n.mergeWithThunk(s.constant(n))},mergeWithThunk:_n.mergeWithThunk},Kn=function(n){return{is:function(e){return n===e},isValue:s.constant(!0),isError:s.constant(!1),getOr:s.constant(n),getOrThunk:s.constant(n),getOrDie:s.constant(n),or:function(e){return Kn(n)},orThunk:function(e){return Kn(n)},fold:function(e,t){return t(n)},map:function(e){return Kn(e(n))},each:function(e){e(n)},bind:function(e){return e(n)},exists:function(e){return e(n)},forall:function(e){return e(n)},toOption:function(){return p.some(n)}}},Xn=function(n){return{is:s.constant(!1),isValue:s.constant(!1),isError:s.constant(!0),getOr:s.identity,getOrThunk:function(n){return n()},getOrDie:function(){return s.die(n)()},or:function(n){return n},orThunk:function(n){return n()},fold:function(e,t){return e(n)},map:function(e){return Xn(n)},each:s.noop,bind:function(e){return Xn(n)},exists:s.constant(!1),forall:s.constant(!0),toOption:p.none}},Yn={value:Kn,error:Xn},Jn=($n([{bothErrors:["error1","error2"]},{firstError:["error1","value2"]},{secondError:["value1","error2"]},{bothValues:["value1","value2"]}]),function(n){var e=[],t=[];return D.each(n,function(n){n.fold(function(n){e.push(n)},function(n){t.push(n)})}),{errors:e,values:t}}),Qn=function(n){return s.compose(Yn.error,D.flatten)(n)},Zn=function(n,e){var t=Jn(n);return t.errors.length>0?Qn(t.errors):function(n,e){return Yn.value(Mn.deepMerge.apply(undefined,[e].concat(n)))}(t.values,e)},ne=function(n){var e=Jn(n);return e.errors.length>0?Qn(e.errors):Yn.value(e.values)},ee=function(n,e){var t={};return D.each(e,function(e){n[e]!==undefined&&n.hasOwnProperty(e)&&(t[e]=n[e])}),t},te=function(n,e){var t={};return Nn.each(n,function(n,r){D.contains(e,r)||(t[r]=n)}),t},re=function(n){return function(e){return e.hasOwnProperty(n)?p.from(e[n]):p.none()}},oe=re,ie=function(n,e){return function(t){return re(n)(t).getOr(e)}},ue=function(n,e){return re(e)(n)},ae=function(n,e){return n.hasOwnProperty(e)&&n[e]!==undefined&&null!==n[e]},ce=function(n,e){var t={};return t[n]=e,t},se=function(n){var e={};return D.each(n,function(n){e[n.key]=n.value}),e},fe=function(n,e){return ee(n,e)},le=function(n,e){return te(n,e)},de=function(n){return oe(n)},me=function(n,e){return ie(n,e)},ge=function(n,e){return ue(n,e)},pe=function(n,e){return ce(n,e)},he=function(n){return se(n)},ve=function(n,e){return ae(n,e)},ye=function(n,e){return Zn(n,e)},be=function(){return B("JSON")},we=function(n,e,t){return be().stringify(n,e,t)},Se=function(n){return Cn.isObject(n)&&Nn.keys(n).length>100?" removed due to size":we(n,null,2)},xe=function(n){var e=n.length>10?n.slice(0,10).concat([{path:[],getErrorInfo:function(){return"... (only showing first ten failures)"}}]):n;return D.map(e,function(n){return"Failed path: ("+n.path.join(" > ")+")\n"+n.getErrorInfo()})},Te=function(n,e){return Yn.error([{path:n,getErrorInfo:e}])},Oe=function(n,e,t){return Te(n,function(){return'Could not find valid *strict* value for "'+e+'" in '+Se(t)})},ke=function(n,e){return Te(n,function(){return'Choice schema did not contain choice key: "'+e+'"'})},Ce=function(n,e,t){return Te(n,function(){return'The chosen schema: "'+t+'" did not exist in branches: '+Se(e)})},Ee=function(n,e){return Te(n,function(){return"There are unsupported fields: ["+e.join(", ")+"] specified"})},De=function(n,e){return Te(n,function(){return e})},Ae={typeAdt:$n([{setOf:["validator","valueType"]},{arrOf:["valueType"]},{objOf:["fields"]},{itemOf:["validator"]},{choiceOf:["key","branches"]}]),fieldAdt:$n([{field:["name","presence","type"]},{state:["name"]}])},Me=$n([{field:["key","okey","presence","prop"]},{state:["okey","instantiator"]}]),Re=function(n,e,t){var r=ue(n,e).fold(function(){return t(n)},s.identity);return Yn.value(r)},Be=function(n,e,t,r){return t.fold(function(t,o,i,u){var a=function(e){return u.extract(n.concat([t]),r,e).map(function(n){return ce(o,r(n))})},c=function(e){return e.fold(function(){var n=ce(o,r(p.none()));return Yn.value(n)},function(e){return u.extract(n.concat([t]),r,e).map(function(n){return ce(o,r(p.some(n)))})})};return i.fold(function(){return function(n,e,t){return ue(e,t).fold(function(){return Oe(n,t,e)},Yn.value)}(n,e,t).bind(a)},function(n){return Re(e,t,n).bind(a)},function(){return function(n,e){return Yn.value(ue(n,e))}(e,t).bind(c)},function(n){return function(n,e,t){var r=ue(n,e).map(function(e){return!0===e?t(n):e});return Yn.value(r)}(e,t,n).bind(c)},function(n){var r=n(e);return Re(e,t,s.constant({})).map(function(n){return Mn.deepMerge(r,n)}).bind(a)})},function(n,t){var o=t(e);return Yn.value(ce(n,r(o)))})},Ie=function(n){return{extract:function(e,t,r){return n(r).fold(function(n){return De(e,n)},Yn.value)},toString:function(){return"val"},toDsl:function(){return Ae.typeAdt.itemOf(n)}}},Fe=function(n){return{extract:function(e,t,r){return function(n,e,t,r){var o=D.map(t,function(t){return Be(n,e,t,r)});return Zn(o,{})}(e,r,n,t)},toString:function(){return"obj{\n"+D.map(n,function(n){return n.fold(function(n,e,t,r){return n+" -> "+r.toString()},function(n,e){return"state("+n+")"})}).join("\n")+"}"},toDsl:function(){return Ae.typeAdt.objOf(D.map(n,function(n){return n.fold(function(n,e,t,r){return Ae.fieldAdt.field(n,t,r)},function(n,e){return Ae.fieldAdt.state(n)})}))}}},He=function(n){return{extract:function(e,t,r){var o=D.map(r,function(r,o){return n.extract(e.concat(["["+o+"]"]),t,r)});return ne(o)},toString:function(){return"array("+n.toString()+")"},toDsl:function(){return Ae.typeAdt.arrOf(n)}}},Ne=Ie(Yn.value),Ve=s.compose(He,Fe),je={anyValue:s.constant(Ne),value:Ie,obj:Fe,objOnly:function(n){var e=Fe(n),t=D.foldr(n,function(n,e){return e.fold(function(e){return Mn.deepMerge(n,pe(e,!0))},s.constant(n))},{});return{extract:function(n,r,o){var i=Cn.isBoolean(o)?[]:function(n){var e=Nn.keys(n);return D.filter(e,function(e){return ve(n,e)})}(o),u=D.filter(i,function(n){return!ve(t,n)});return 0===u.length?e.extract(n,r,o):Ee(n,u)},toString:e.toString,toDsl:e.toDsl}},arr:He,setOf:function(n,e){return{extract:function(t,r,o){var i=Nn.keys(o);return function(e,t){return He(Ie(n)).extract(e,s.identity,t)}(t,i).bind(function(n){var i=D.map(n,function(n){return Me.field(n,n,qn.strict(),e)});return Fe(i).extract(t,r,o)})},toString:function(){return"setOf("+e.toString()+")"},toDsl:function(){return Ae.typeAdt.setOf(n,e)}}},arrOfObj:Ve,state:Me.state,field:Me.field,output:function(n,e){return Me.state(n,s.constant(e))},snapshot:function(n){return Me.state(n,s.identity)}},Le=function(n,e){return je.field(n,n,qn.strict(),e)},Pe=function(n){return je.field(n,n,qn.strict(),je.anyValue())},We=Le,Ue=function(n,e){return je.field(n,n,qn.strict(),je.obj(e))},ze=function(n){return je.field(n,n,qn.strict(),je.value(function(n){return Cn.isFunction(n)?Yn.value(n):Yn.error("Not a function")}))},Ge=function(n,e){return je.field(n,n,qn.asOption(),je.value(function(t){return Yn.error("The field: "+n+" is forbidden. "+e)}))},$e=function(n){return je.field(n,n,qn.asOption(),je.anyValue())},_e=function(n,e){return je.field(n,n,qn.asOption(),e)},qe=function(n,e){return je.field(n,n,qn.asOption(),je.obj(e))},Ke=function(n,e){return je.field(n,n,qn.asOption(),je.objOnly(e))},Xe=function(n,e){return je.field(n,n,qn.defaulted(e),je.anyValue())},Ye=function(n,e,t){return je.field(n,n,qn.defaulted(e),t)},Je=function(n,e,t){return je.field(n,n,qn.defaulted(e),je.obj(t))},Qe=function(n,e,t,r){return je.field(n,e,t,r)},Ze=function(n,e){return je.state(n,e)},nt=function(n,e){return{extract:function(t,r,o){return ge(o,n).fold(function(){return ke(t,n)},function(n){return function(n,e,t,r,o){return ge(r,o).fold(function(){return Ce(n,r,o)},function(r){return je.obj(r).extract(n.concat(["branch: "+o]),e,t)})}(t,r,o,e,n)})},toString:function(){return"chooseOn("+n+"). Possible values: "+Nn.keys(e)},toDsl:function(){return Ae.typeAdt.choiceOf(n,e)}}},et=je.value(Yn.value),tt=je.arr,rt=je.obj,ot=je.objOnly,it=je.setOf,ut=function(n,e,t,r){return e.extract([n],t,r).fold(function(n){return Yn.error({input:r,errors:n})},Yn.value)},at=function(n,e,t){return ut(n,e,s.constant,t)},ct=function(n,e,t){return ut(n,e,s.identity,t)},st=function(n){return n.fold(function(n){throw new Error(ft(n))},s.identity)},ft=function(n){return"Errors: \n"+xe(n.errors)+"\n\nInput object: "+Se(n.input)},lt={anyValue:s.constant(et),arrOfObj:function(n){return je.arrOfObj(n)},arrOf:tt,arrOfVal:function(){return je.arr(et)},valueOf:function(n){return je.value(n)},setOf:it,objOf:rt,objOfOnly:ot,asStruct:at,asRaw:ct,asStructOrDie:function(n,e,t){return st(at(n,e,t))},asRawOrDie:function(n,e,t){return st(ct(n,e,t))},getOrDie:st,formatError:ft,choose:function(n,e){return nt(n,e)}},dt=function(n){if(!ve(n,"can")&&!ve(n,"abort")&&!ve(n,"run"))throw new Error("EventHandler defined by: "+we(n,null,2)+" does not have can, abort, or run!");return lt.asRawOrDie("Extracting event.handler",lt.objOfOnly([Xe("can",s.constant(!0)),Xe("abort",s.constant(!1)),Xe("run",s.noop)]),n)},mt=function(n){return Cn.isFunction(n)?{can:s.constant(!0),abort:s.constant(!1),run:n}:n},gt=function(n){var e=function(n,e){return function(){var t=Array.prototype.slice.call(arguments,0);return D.foldl(n,function(n,r){return n&&e(r).apply(undefined,t)},!0)}}(n,function(n){return n.can}),t=function(n,e){return function(){var t=Array.prototype.slice.call(arguments,0);return D.foldl(n,function(n,r){return n||e(r).apply(undefined,t)},!1)}}(n,function(n){return n.abort});return dt({can:e,abort:t,run:function(){var e=Array.prototype.slice.call(arguments,0);D.each(n,function(n){n.run.apply(undefined,e)})}})},pt=dt,ht=function(n,e){return{key:n,value:pt({run:e})}},vt=function(n){return function(e){return{key:n,value:pt({run:function(n,t){Sn(n,t)&&e(n,t)}})}}},yt=function(n,e){return ht(n,function(t,r){t.getSystem().getByUid(e).each(function(e){zn(e,e.element(),n,r)})})},bt={derive:he,run:ht,preventDefault:function(n){return{key:n,value:pt({run:function(n,e){e.event().prevent()}})}},runActionExtra:function(n,e,t){return{key:n,value:pt({run:function(n){e.apply(undefined,[n].concat(t))}})}},runOnAttached:vt(On.attachedToDom()),runOnDetached:vt(On.detachedFromDom()),runOnInit:vt(On.systemInit()),runOnExecute:function(n){return function(e){return ht(n,e)}}(On.execute()),redirectToUid:yt,redirectToPart:function(n,e,t){var r=e.partUids()[t];return yt(n,r)},runWithTarget:function(n,e){return ht(n,function(n,t){n.getSystem().getByDom(t.event().target()).each(function(r){e(n,r,t)})})},abort:function(n,e){return{key:n,value:pt({abort:e})}},can:function(n,e){return{key:n,value:pt({can:e})}},cutter:function(n){return ht(n,function(n,e){e.cut()})},stopper:function(n){return ht(n,function(n,e){e.stop()})}},wt=function(n,e,t){return n},St=function(n,e){return n},xt=function(n,e){return n},Tt=(p.none,function(n){return n.slice(0).sort()}),Ot=function(n,e){throw new Error("All required keys ("+Tt(n).join(", ")+") were not specified. Specified keys were: "+Tt(e).join(", ")+".")},kt=function(n){throw new Error("Unsupported keys for object: "+Tt(n).join(", "))},Ct=function(n,e){if(!Cn.isArray(e))throw new Error("The "+n+" fields must be an array. Was: "+e+".");D.each(e,function(e){if(!Cn.isString(e))throw new Error("The value "+e+" in the "+n+" fields was not a string.")})},Et=function(n,e){throw new Error("All values need to be of type: "+e+". Keys ("+Tt(n).join(", ")+") were not.")},Dt=function(n){var e=Tt(n);D.find(e,function(n,t){return t<e.length-1&&n===e[t+1]}).each(function(n){throw new Error("The field: "+n+" occurs more than once in the combined fields: ["+e.join(", ")+"].")})},At=function(){var n=arguments;return function(){for(var e=new Array(arguments.length),t=0;t<e.length;t++)e[t]=arguments[t];if(n.length!==e.length)throw new Error('Wrong number of arguments to struct. Expected "['+n.length+']", got '+e.length+" arguments");var r={};return D.each(n,function(n,t){r[n]=s.constant(e[t])}),r}},Mt=function(n,e){var t=n.concat(e);if(0===t.length)throw new Error("You must specify at least one required or optional field.");return Ct("required",n),Ct("optional",e),Dt(t),function(r){var o=Nn.keys(r);D.forall(n,function(n){return D.contains(o,n)})||Ot(n,o);var i=D.filter(o,function(n){return!D.contains(t,n)});i.length>0&&kt(i);var u={};return D.each(n,function(n){u[n]=s.constant(r[n])}),D.each(e,function(n){u[n]=s.constant(Object.prototype.hasOwnProperty.call(r,n)?p.some(r[n]):p.none())}),u}},Rt=function(n){return{tag:n.tag(),classes:n.classes().getOr([]),attributes:n.attributes().getOr({}),styles:n.styles().getOr({}),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().getOr("<none>"),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},Bt={nu:Mt(["tag"],["classes","attributes","styles","value","innerHtml","domChildren","defChildren"]),defToStr:function(n){var e=Rt(n);return we(e,null,2)},defToRaw:Rt},It=Mt([],["classes","attributes","styles","value","innerHtml","defChildren","domChildren"]),Ft=function(n){return{classes:n.classes().getOr("<none>"),attributes:n.attributes().getOr("<none>"),styles:n.styles().getOr("<none>"),value:n.value().getOr("<none>"),innerHtml:n.innerHtml().getOr("<none>"),defChildren:n.defChildren().getOr("<none>"),domChildren:n.domChildren().fold(function(){return"<none>"},function(n){return 0===n.length?"0 children, but still specified":String(n.length)})}},Ht=function(n,e,t){return e.fold(function(){return t.fold(function(){return{}},function(e){return pe(n,e)})},function(e){return t.fold(function(){return pe(n,e)},function(e){return pe(n,e)})})},Nt={nu:It,derive:function(n){var e={},t=Nn.keys(n);return D.each(t,function(t){n[t].each(function(n){e[t]=n})}),It(e)},merge:function(n,e){var t=Mn.deepMerge({tag:n.tag(),classes:e.classes().getOr([]).concat(n.classes().getOr([])),attributes:Mn.merge(n.attributes().getOr({}),e.attributes().getOr({})),styles:Mn.merge(n.styles().getOr({}),e.styles().getOr({}))},e.innerHtml().or(n.innerHtml()).map(function(n){return pe("innerHtml",n)}).getOr({}),Ht("domChildren",e.domChildren(),n.domChildren()),Ht("defChildren",e.defChildren(),n.defChildren()),e.value().or(n.value()).map(function(n){return pe("value",n)}).getOr({}));return Bt.nu(t)},modToStr:function(n){var e=Ft(n);return we(e,null,2)},modToRaw:Ft},Vt=function(n){return{key:n,value:undefined}},jt=function(n,e,t,r,o,i,u){var a=function(n){return ve(n,t)?n[t]():p.none()},c=Nn.map(o,function(n,e){return function(n,e,t){return wt(function(r){var o=arguments;return r.config({name:s.constant(n)}).fold(function(){throw new Error("We could not find any behaviour configuration for: "+n+". Using API: "+t)},function(n){var t=Array.prototype.slice.call(o,1);return e.apply(undefined,[r,n.config,n.state].concat(t))})},t,e)}(t,n,e)}),f=Nn.map(i,function(n,e){return St(n,e)}),l=Mn.deepMerge(f,c,{revoke:s.curry(Vt,t),config:function(e){var r=lt.asStructOrDie(t+"-config",n,e);return{key:t,value:{config:r,me:l,configAsRaw:N(function(){return lt.asRawOrDie(t+"-config",n,e)}),initialConfig:e,state:u}}},schema:function(){return e},exhibit:function(n,e){return a(n).bind(function(n){return ge(r,"exhibit").map(function(t){return t(e,n.config,n.state)})}).getOr(Nt.nu({}))},name:function(){return t},handlers:function(n){return a(n).bind(function(n){return ge(r,"events").map(function(e){return e(n.config,n.state)})}).getOr({})}});return l},Lt=function(n,e,t){return bt.runOnExecute(function(r){t(r,n,e)})},Pt=function(n,e,t){return bt.runOnInit(function(r,o){t(r,n,e)})},Wt=function(n,e,t,r,o,i){var u=lt.objOfOnly(n),a=qe(e,[Ke("config",n)]);return jt(u,a,e,t,r,o,i)},Ut=function(n,e,t,r,o,i){var u=n,a=qe(e,[_e("config",n)]);return jt(u,a,e,t,r,o,i)},zt=function(n,e){return Gt(n,e,{validate:Cn.isFunction,label:"function"})},Gt=function(n,e,t){if(0===e.length)throw new Error("You must specify at least one required field.");return Ct("required",e),Dt(e),function(r){var o=Nn.keys(r);D.forall(e,function(n){return D.contains(o,n)})||Ot(e,o),n(e,o);var i=D.filter(e,function(n){return!t.validate(r[n],n)});return i.length>0&&Et(i,t.label),r}},$t=s.noop,_t={exactly:s.curry(zt,function(n,e){var t=D.filter(e,function(e){return!D.contains(n,e)});t.length>0&&kt(t)}),ensure:s.curry(zt,$t),ensureWith:s.curry(Gt,$t)},qt=_t.ensure(["readState"]),Kt={init:function(){return qt({readState:function(){return"No State required"}})}},Xt=lt.objOfOnly([Pe("fields"),Pe("name"),Xe("active",{}),Xe("apis",{}),Xe("extra",{}),Xe("state",Kt)]),Yt=lt.objOfOnly([Pe("branchKey"),Pe("branches"),Pe("name"),Xe("active",{}),Xe("apis",{}),Xe("extra",{}),Xe("state",Kt)]),Jt={derive:function(n){return he(n)},revoke:s.constant(undefined),noActive:s.constant({}),noApis:s.constant({}),noExtra:s.constant({}),noState:s.constant(Kt),create:function(n){var e=lt.asRawOrDie("Creating behaviour: "+n.name,Xt,n);return Wt(e.fields,e.name,e.active,e.apis,e.extra,e.state)},createModes:function(n){var e=lt.asRawOrDie("Creating behaviour: "+n.name,Yt,n);return Ut(lt.choose(e.branchKey,e.branches),e.name,e.active,e.apis,e.extra,e.state)}},Qt=function(n,e,t){var r=t||!1,o=function(){e(),r=!0},i=function(){n(),r=!1};return{on:o,off:i,toggle:function(){(r?i:o)()},isOn:function(){return r}}},Zt=function(n){return n.dom().nodeName.toLowerCase()},nr=function(n){return n.dom().nodeType},er=function(n){return function(e){return nr(e)===n}},tr=er(ln),rr=er(dn),or=er(fn),ir={name:Zt,type:nr,value:function(n){return n.dom().nodeValue},isElement:tr,isText:rr,isDocument:or,isComment:function(n){return nr(n)===sn||"#comment"===Zt(n)}},ur=function(n,e,t){if(!(Cn.isString(t)||Cn.isBoolean(t)||Cn.isNumber(t)))throw console.error("Invalid call to Attr.set. Key ",e,":: Value ",t,":: Element ",n),new Error("Attribute value was not simple");n.setAttribute(e,t+"")},ar=function(n,e,t){ur(n.dom(),e,t)},cr=function(n,e){var t=n.dom().getAttribute(e);return null===t?undefined:t},sr=function(n,e){var t=n.dom();return!(!t||!t.hasAttribute)&&t.hasAttribute(e)},fr=ar,lr=function(n,e){var t=n.dom();Nn.each(e,function(n,e){ur(t,e,n)})},dr=cr,mr=sr,gr=function(n,e){n.dom().removeAttribute(e)},pr=function(n,e){var t=dr(n,e);return t===undefined||""===t?[]:t.split(" ")},hr=pr,vr=function(n,e,t){var r=pr(n,e).concat([t]);fr(n,e,r.join(" "))},yr=function(n,e,t){var r=D.filter(pr(n,e),function(n){return n!==t});r.length>0?fr(n,e,r.join(" ")):gr(n,e)},br=function(n){return hr(n,"class")},wr=function(n,e){return vr(n,"class",e)},Sr=function(n,e){return yr(n,"class",e)},xr=br,Tr=wr,Or=Sr,kr=function(n,e){D.contains(br(n),e)?Sr(n,e):wr(n,e)},Cr=function(n){return n.dom().classList!==undefined},Er=function(n,e){return Cr(n)&&n.dom().classList.contains(e)},Dr={add:function(n,e){Cr(n)?n.dom().classList.add(e):Tr(n,e)},remove:function(n,e){Cr(n)?n.dom().classList.remove(e):Or(n,e);!function(n){0===(Cr(n)?n.dom().classList:xr(n)).length&&gr(n,"class")}(n)},toggle:function(n,e){return Cr(n)?n.dom().classList.toggle(e):kr(n,e)},toggler:function(n,e){var t=Cr(n),r=n.dom().classList;return Qt(function(){t?r.remove(e):Or(n,e)},function(){t?r.add(e):Tr(n,e)},Er(n,e))},has:Er},Ar=function(n,e,t){Dr.remove(n,t),Dr.add(n,e)},Mr={toAlpha:function(n,e,t){Ar(n.element(),e.alpha(),e.omega())},toOmega:function(n,e,t){Ar(n.element(),e.omega(),e.alpha())},isAlpha:function(n,e,t){return Dr.has(n.element(),e.alpha())},isOmega:function(n,e,t){return Dr.has(n.element(),e.omega())},clear:function(n,e,t){Dr.remove(n.element(),e.alpha()),Dr.remove(n.element(),e.omega())}},Rr=[Pe("alpha"),Pe("omega")],Br=Jt.create({fields:Rr,name:"swapping",apis:Mr}),Ir=function(n,e){var t=[],r=function(n){return t.push(n),e(n)},o=e(n);do{o=o.bind(r)}while(o.isSome());return t},Fr=function(n){return cn.fromDom(n.dom().ownerDocument)},Hr=function(n){var e=n.dom();return p.from(e.parentNode).map(cn.fromDom)},Nr=function(n){var e=n.dom();return p.from(e.previousSibling).map(cn.fromDom)},Vr=function(n){var e=n.dom();return p.from(e.nextSibling).map(cn.fromDom)},jr=function(n){var e=n.dom();return D.map(e.childNodes,cn.fromDom)},Lr=function(n,e){var t=n.dom().childNodes;return p.from(t[e]).map(cn.fromDom)},Pr=At("element","offset"),Wr={owner:Fr,defaultView:function(n){var e=n.dom().ownerDocument.defaultView;return cn.fromDom(e)},documentElement:function(n){var e=Fr(n);return cn.fromDom(e.dom().documentElement)},parent:Hr,findIndex:function(n){return Hr(n).bind(function(e){var t=jr(e);return D.findIndex(t,function(e){return wn(n,e)})})},parents:function(n,e){for(var t=Cn.isFunction(e)?e:s.constant(!1),r=n.dom(),o=[];null!==r.parentNode&&r.parentNode!==undefined;){var i=r.parentNode,u=cn.fromDom(i);if(o.push(u),!0===t(u))break;r=i}return o},siblings:function(n){return Hr(n).map(jr).map(function(e){return D.filter(e,function(e){return!wn(n,e)})}).getOr([])},prevSibling:Nr,offsetParent:function(n){var e=n.dom();return p.from(e.offsetParent).map(cn.fromDom)},prevSiblings:function(n){return D.reverse(Ir(n,Nr))},nextSibling:Vr,nextSiblings:function(n){return Ir(n,Vr)},children:jr,child:Lr,firstChild:function(n){return Lr(n,0)},lastChild:function(n){return Lr(n,n.dom().childNodes.length-1)},childNodesCount:function(n){return n.dom().childNodes.length},hasChildNodes:function(n){return n.dom().hasChildNodes()},leaf:function(n,e){var t=jr(n);return t.length>0&&e<t.length?Pr(t[e],0):Pr(n,e)}},Ur=function(n,e){Wr.parent(n).each(function(t){t.dom().insertBefore(e.dom(),n.dom())})},zr=function(n,e){n.dom().appendChild(e.dom())},Gr={before:Ur,after:function(n,e){Wr.nextSibling(n).fold(function(){Wr.parent(n).each(function(n){zr(n,e)})},function(n){Ur(n,e)})},prepend:function(n,e){Wr.firstChild(n).fold(function(){zr(n,e)},function(t){n.dom().insertBefore(e.dom(),t.dom())})},append:zr,appendAt:function(n,e,t){Wr.child(n,t).fold(function(){zr(n,e)},function(n){Ur(n,e)})},wrap:function(n,e){Ur(n,e),zr(e,n)}},$r=function(n,e){D.each(e,function(e){Gr.before(n,e)})},_r=function(n,e){D.each(e,function(e){Gr.append(n,e)})},qr=function(n){var e=n.dom();null!==e.parentNode&&e.parentNode.removeChild(e)},Kr={empty:function(n){n.dom().textContent="",D.each(Wr.children(n),function(n){qr(n)})},remove:qr,unwrap:function(n){var e=Wr.children(n);e.length>0&&$r(n,e),qr(n)}},Xr=N(function(){return Yr(cn.fromDom(document))}),Yr=function(n){var e=n.dom().body;if(null===e||e===undefined)throw"Body is not available yet";return cn.fromDom(e)},Jr={body:Xr,getBody:Yr,inBody:function(n){var e=ir.isText(n)?n.dom().parentNode:n.dom();return e!==undefined&&null!==e&&e.ownerDocument.body.contains(e)}},Qr=function(n){Ln(n,On.detachedFromDom());var e=n.components();D.each(e,Qr)},Zr=function(n){var e=n.components();D.each(e,Zr),Ln(n,On.attachedToDom())},no=function(n,e,t){n.getSystem().addToWorld(e),t(n.element(),e.element()),Jr.inBody(n.element())&&Zr(e),n.syncComponents()},eo=function(n){Qr(n),Kr.remove(n.element()),n.getSystem().removeFromWorld(n)},to={attach:function(n,e){no(n,e,Gr.append)},attachWith:no,detach:function(n){var e=Wr.parent(n.element()).bind(function(e){return n.getSystem().getByDom(e).fold(p.none,p.some)});eo(n),e.each(function(n){n.syncComponents()})},detachChildren:function(n){var e=n.components();D.each(e,eo),Kr.empty(n.element()),n.syncComponents()},attachSystem:function(n,e){Gr.append(n,e.element());var t=Wr.children(e.element());D.each(t,function(n){e.getByDom(n).each(Zr)})},detachSystem:function(n){var e=Wr.children(n.element());D.each(e,function(e){n.getByDom(e).each(Qr)}),Kr.remove(n.element())}},ro=function(n,e){var t=(e||document).createElement("div");return t.innerHTML=n,Wr.children(cn.fromDom(t))},oo=function(n){return n.dom().innerHTML},io=oo,uo=function(n,e){var t=Wr.owner(n).dom(),r=cn.fromDom(t.createDocumentFragment()),o=ro(e,t);_r(r,o),Kr.empty(n),Gr.append(n,r)},ao=function(n){var e=cn.fromTag("div"),t=cn.fromDom(n.dom().cloneNode(!0));return Gr.append(e,t),oo(e)},co=function(n,e){return cn.fromDom(n.dom().cloneNode(e))},so=function(n){return co(n,!1)},fo=function(n){var e=so(n);return ao(e)},lo=function(n){return fo(n)},mo=function(n){for(var e=[],t=function(n){e.push(n)},r=0;r<n.length;r++)n[r].each(t);return e},go=function(n,e){for(var t=0;t<n.length;t++){var r=e(n[t],t);if(r.isSome())return r}return p.none()},po="__CHROME_INSPECTOR_CONNECTION_TO_ALLOY__",ho=[],vo=["alloy/data/Fields","alloy/debugging/Debugging"],yo={logEventCut:s.noop,logEventStopped:s.noop,logNoParent:s.noop,logEventNoHandlers:s.noop,logEventResponse:s.noop,write:s.noop},bo=function(){return window[po]!==undefined?window[po]:(window[po]={systems:{},lookup:function(n){var e=window[po].systems,t=Nn.keys(e);return go(t,function(t){return e[t].getByUid(n).toOption().map(function(n){return pe(lo(n.element()),function(n){var e=function(n){var t=n.spec();return{"(original.spec)":t,"(dom.ref)":n.element().dom(),"(element)":lo(n.element()),"(initComponents)":D.map(t.components!==undefined?t.components:[],e),"(components)":D.map(n.components(),e),"(bound.events)":Nn.mapToArray(n.events(),function(n,e){return[e]}).join(", "),"(behaviours)":t.behaviours!==undefined?Nn.map(t.behaviours,function(e,t){return e===undefined?"--revoked--":{config:e.configAsRaw(),"original-config":e.initialConfig,state:n.readState(t)}}):"none"}};return e(n)}(n))})})}},window[po])},wo=function(n,e,t){},So=(s.constant(yo),function(){var n=new Error;if(n.stack!==undefined){var e=n.stack.split("\n");return D.find(e,function(n){return n.indexOf("alloy")>0&&!D.exists(vo,function(e){return n.indexOf(e)>-1})}).getOr("unknown")}return"unknown"}),xo=function(n,e,t){var r="*"===ho||D.contains(ho,n)?function(){var t=[];return{logEventCut:function(n,e,r){t.push({outcome:"cut",target:e,purpose:r})},logEventStopped:function(n,e,r){t.push({outcome:"stopped",target:e,purpose:r})},logNoParent:function(n,e,r){t.push({outcome:"no-parent",target:e,purpose:r})},logEventNoHandlers:function(n,e){t.push({outcome:"no-handlers-left",target:e})},logEventResponse:function(n,e,r){t.push({outcome:"response",purpose:r,target:e})},write:function(){D.contains(["mousemove","mouseover","mouseout",On.systemInit()],n)||console.log(n,{event:n,target:e.dom(),sequence:D.map(t,function(n){return D.contains(["cut","stopped","response"],n.outcome)?"{"+n.purpose+"} "+n.outcome+" at ("+lo(n.target)+")":n.outcome})})}}}():yo,o=t(r);return r.write(),o},To=(s.constant(!0),function(n,e){bo().systems[n]=e}),Oo=function(n){var e=n,t=function(){return e};return{get:t,set:function(n){e=n},clone:function(){return Oo(t())}}},ko=function(n,e,t,r,o){return n(t,r)?p.some(t):Cn.isFunction(o)&&o(t)?p.none():e(t,r,o)},Co=function(n,e,t){for(var r=n.dom(),o=Cn.isFunction(t)?t:s.constant(!1);r.parentNode;){r=r.parentNode;var i=cn.fromDom(r);if(e(i))return p.some(i);if(o(i))break}return p.none()},Eo=function(n,e){return D.find(n.dom().childNodes,s.compose(e,cn.fromDom)).map(cn.fromDom)},Do=function(n,e){var t=function(n){for(var r=0;r<n.childNodes.length;r++){if(e(cn.fromDom(n.childNodes[r])))return p.some(cn.fromDom(n.childNodes[r]));var o=t(n.childNodes[r]);if(o.isSome())return o}return p.none()};return t(n.dom())},Ao={first:function(n){return Do(Jr.body(),n)},ancestor:Co,closest:function(n,e,t){return ko(function(n){return e(n)},Co,n,e,t)},sibling:function(n,e){var t=n.dom();return t.parentNode?Eo(cn.fromDom(t.parentNode),function(t){return!wn(n,t)&&e(t)}):p.none()},child:Eo,descendant:Do},Mo=function(n){n.dom().focus()},Ro=function(n){var e=n!==undefined?n.dom():document;return p.from(e.activeElement).map(cn.fromDom)},Bo=function(n){var e=Wr.owner(n).dom();return n.dom()===e.activeElement},Io=Mo,Fo=function(n){n.dom().blur()},Ho=Ro,No=function(n){return Ro(Wr.owner(n)).filter(function(e){return n.dom().contains(e.dom())})},Vo=tinymce.util.Tools.resolve("tinymce.ThemeManager"),jo=tinymce.util.Tools.resolve("tinymce.dom.DOMUtils"),Lo=function(n){var e=document.createElement("a");e.target="_blank",e.href=n.href,e.rel="noreferrer noopener";var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(e),e.dispatchEvent(t),document.body.removeChild(e)},Po=function(n){return!1===n.settings.skin},Wo={formatChanged:s.constant("formatChanged"),orientationChanged:s.constant("orientationChanged"),dropupDismissed:s.constant("dropupDismissed")},Uo={events:function(n){return bt.derive([bt.run(On.receive(),function(e,t){var r=n.channels(),o=function(n,e){return e.universal()?n:D.filter(n,function(n){return D.contains(e.channels(),n)})}(Nn.keys(r),t);D.each(o,function(n){var o=r[n](),i=o.schema(),u=lt.asStructOrDie("channel["+n+"] data\nReceiver: "+lo(e.element()),i,t.data());o.onReceive()(e,u)})})])}},zo=[Pe("menu"),Pe("selectedMenu")],Go=[Pe("item"),Pe("selectedItem")],$o=lt.objOfOnly(Go.concat(zo)),_o=lt.objOfOnly(Go),qo={menuFields:s.constant(zo),itemFields:s.constant(Go),schema:s.constant($o),itemSchema:s.constant(_o)},Ko=Ue("initSize",[Pe("numColumns"),Pe("numRows")]),Xo=function(n,e,t){var r=So();return Qe(e,e,t,lt.valueOf(function(t){return Yn.value(function(){return wo(n,e,r),t.apply(undefined,arguments)})}))},Yo={initSize:s.constant(Ko),itemMarkers:function(){return We("markers",qo.itemSchema())},menuMarkers:function(){return We("markers",qo.schema())},tieredMenuMarkers:function(){return Ue("markers",[Pe("backgroundMenu")].concat(qo.menuFields()).concat(qo.itemFields()))},markers:function(n){return Ue("markers",D.map(n,Pe))},onHandler:function(n){return Xo("onHandler",n,qn.defaulted(s.noop))},onKeyboardHandler:function(n){return Xo("onKeyboardHandler",n,qn.defaulted(p.none))},onStrictHandler:function(n){return Xo("onHandler",n,qn.strict())},onStrictKeyboardHandler:function(n){return Xo("onKeyboardHandler",n,qn.strict())},output:function(n,e){return Ze(n,s.constant(e))},snapshot:function(n){return Ze(n,s.identity)}},Jo=[We("channels",lt.setOf(Yn.value,lt.objOfOnly([Yo.onStrictHandler("onReceive"),Xe("schema",lt.anyValue())])))],Qo=Jt.create({fields:Jo,name:"receiving",active:Uo}),Zo=function(n,e){var t=ti(n,e),r=e.aria();r.update()(n,r,t)},ni=function(n,e,t){Dr.add(n.element(),e.toggleClass()),Zo(n,e)},ei=function(n,e,t){Dr.remove(n.element(),e.toggleClass()),Zo(n,e)},ti=function(n,e){return Dr.has(n.element(),e.toggleClass())},ri={onLoad:function(n,e,t){(e.selected()?ni:ei)(n,e,t)},toggle:function(n,e,t){Dr.toggle(n.element(),e.toggleClass()),Zo(n,e)},isOn:ti,on:ni,off:ei},oi={exhibit:function(n,e,t){return Nt.nu({})},events:function(n,e){var t=Lt(n,e,ri.toggle),r=Pt(n,e,ri.onLoad);return bt.derive(D.flatten([n.toggleOnExecute()?[t]:[],[r]]))}},ii=function(n,e,t){fr(n.element(),"aria-expanded",t)},ui={button:["aria-pressed"],"input:checkbox":["aria-checked"]},ai={button:["aria-pressed"],listbox:["aria-pressed","aria-expanded"],menuitemcheckbox:["aria-checked"]},ci={updatePressed:function(n,e,t){fr(n.element(),"aria-pressed",t),e.syncWithExpanded()&&ii(n,e,t)},updateSelected:function(n,e,t){fr(n.element(),"aria-selected",t)},updateChecked:function(n,e,t){fr(n.element(),"aria-checked",t)},updateExpanded:ii,updateAuto:function(n,e,t){var r=function(n){var e=n.element();if(mr(e,"role")){var t=dr(e,"role");return ge(ai,t)}return p.none()}(n).orThunk(function(){return function(n){var e=n.element(),t=ir.name(e),r="input"===t&&mr(e,"type")?":"+dr(e,"type"):"";return ge(ui,t+r)}(n)}).getOr([]);D.each(r,function(e){fr(n.element(),e,t)})}},si=[Xe("selected",!1),Pe("toggleClass"),Xe("toggleOnExecute",!0),Ye("aria",{mode:"none"},lt.choose("mode",{pressed:[Xe("syncWithExpanded",!1),Yo.output("update",ci.updatePressed)],checked:[Yo.output("update",ci.updateChecked)],expanded:[Yo.output("update",ci.updateExpanded)],selected:[Yo.output("update",ci.updateSelected)],none:[Yo.output("update",s.noop)]}))],fi=Jt.create({fields:si,name:"toggling",active:oi,apis:ri}),li=function(n,e){return Qo.config({channels:pe(Wo.formatChanged(),{onReceive:function(t,r){r.command===n&&e(t,r.state)}})})},di=function(n){return Qo.config({channels:pe(Wo.orientationChanged(),{onReceive:n})})},mi=function(n,e){return{key:n,value:{onReceive:e}}},gi={resolve:function(n){return"tinymce-mobile-"+n},prefix:s.constant("tinymce-mobile")},pi={events:function(n){return bt.derive([bt.abort(xn.selectstart(),s.constant(!0))])},exhibit:function(n,e){return Nt.nu({styles:{"-webkit-user-select":"none","user-select":"none","-ms-user-select":"none","-moz-user-select":"-moz-none"},attributes:{unselectable:"on"}})}},hi=Jt.create({fields:[],name:"unselecting",active:pi}),vi={focus:function(n,e){e.ignore()||(Io(n.element()),e.onFocus()(n))},blur:function(n,e){e.ignore()||Fo(n.element())},isFocused:function(n){return Bo(n.element())}},yi={exhibit:function(n,e){return e.ignore()?Nt.nu({}):Nt.nu({attributes:{tabindex:"-1"}})},events:function(n){return bt.derive([bt.run(On.focus(),function(e,t){vi.focus(e,n),t.stop()})])}},bi=[Yo.onHandler("onFocus"),Xe("ignore",!1)],wi=Jt.create({fields:bi,name:"focusing",active:yi,apis:vi}),Si={BACKSPACE:s.constant([8]),TAB:s.constant([9]),ENTER:s.constant([13]),SHIFT:s.constant([16]),CTRL:s.constant([17]),ALT:s.constant([18]),CAPSLOCK:s.constant([20]),ESCAPE:s.constant([27]),SPACE:s.constant([32]),PAGEUP:s.constant([33]),PAGEDOWN:s.constant([34]),END:s.constant([35]),HOME:s.constant([36]),LEFT:s.constant([37]),UP:s.constant([38]),RIGHT:s.constant([39]),DOWN:s.constant([40]),INSERT:s.constant([45]),DEL:s.constant([46]),META:s.constant([91,93,224]),F10:s.constant([121])},xi=function(n,e,t,r){var o=n+e;return o>r?t:o<t?r:o},Ti=function(n,e,t){return n<=e?e:n>=t?t:n},Oi=function(n,e,t){return D.filter(Wr.parents(n,t),e)},ki=function(n,e){return D.filter(Wr.siblings(n),e)},Ci=function(n){return hn(n)},Ei=function(n,e,t){return Oi(n,function(n){return vn(n,e)},t)},Di=function(n,e){return ki(n,function(n){return vn(n,e)})},Ai=function(n,e){return hn(e,n)},Mi=function(n,e,t){return Ao.ancestor(n,function(n){return vn(n,e)},t)},Ri=function(n){return yn(n)},Bi=Mi,Ii=function(n,e){return yn(e,n)},Fi=function(n,e,t){return ko(vn,Mi,n,e,t)},Hi=function(n,e,t){var r=Ai(n.element(),"."+e.highlightClass());D.each(r,function(t){Dr.remove(t,e.highlightClass()),n.getSystem().getByDom(t).each(function(t){e.onDehighlight()(n,t)})})},Ni=function(n,e,t,r){var o=Vi(n,e,t,r);Hi(n,e),Dr.add(r.element(),e.highlightClass()),o||e.onHighlight()(n,r)},Vi=function(n,e,t,r){return Dr.has(r.element(),e.highlightClass())},ji=function(n,e,t,r){var o=Ai(n.element(),"."+e.itemClass());return p.from(o[r]).fold(function(){return Yn.error("No element found with index "+r)},n.getSystem().getByDom)},Li=function(n,e,t){return Ii(n.element(),"."+e.itemClass()).bind(n.getSystem().getByDom)},Pi=function(n,e,t){var r=Ai(n.element(),"."+e.itemClass());return(r.length>0?p.some(r[r.length-1]):p.none()).bind(n.getSystem().getByDom)},Wi=function(n,e,t,r){var o=Ai(n.element(),"."+e.itemClass());return D.findIndex(o,function(n){return Dr.has(n,e.highlightClass())}).bind(function(e){var t=xi(e,r,0,o.length-1);return n.getSystem().getByDom(o[t])})},Ui={dehighlightAll:Hi,dehighlight:function(n,e,t,r){var o=Vi(n,e,t,r);Dr.remove(r.element(),e.highlightClass()),o&&e.onDehighlight()(n,r)},highlight:Ni,highlightFirst:function(n,e,t){Li(n,e,t).each(function(r){Ni(n,e,t,r)})},highlightLast:function(n,e,t){Pi(n,e,t).each(function(r){Ni(n,e,t,r)})},highlightAt:function(n,e,t,r){ji(n,e,t,r).fold(function(n){throw new Error(n)},function(r){Ni(n,e,t,r)})},highlightBy:function(n,e,t,r){var o=Ai(n.element(),"."+e.itemClass()),i=mo(D.map(o,function(e){return n.getSystem().getByDom(e).toOption()}));D.find(i,r).each(function(r){Ni(n,e,t,r)})},isHighlighted:Vi,getHighlighted:function(n,e,t){return Ii(n.element(),"."+e.highlightClass()).bind(n.getSystem().getByDom)},getFirst:Li,getLast:Pi,getPrevious:function(n,e,t){return Wi(n,e,0,-1)},getNext:function(n,e,t){return Wi(n,e,0,1)}},zi=[Pe("highlightClass"),Pe("itemClass"),Yo.onHandler("onHighlight"),Yo.onHandler("onDehighlight")],Gi=Jt.create({fields:zi,name:"highlighting",apis:Ui}),$i=function(){return{get:function(n){return No(n.element())},set:function(n,e){n.getSystem().triggerFocus(e,n.element())}}},_i=function(){return{get:function(n){return Gi.getHighlighted(n).map(function(n){return n.element()})},set:function(n,e){n.getSystem().getByDom(e).fold(s.noop,function(e){Gi.highlight(n,e)})}}},qi=function(n){return!0===n.raw().shiftKey},Ki=function(n){return!0===n.raw().ctrlKey},Xi={inSet:function(n){return function(e){return D.contains(n,e.raw().which)}},and:function(n){return function(e){return D.forall(n,function(n){return n(e)})}},is:function(n){return function(e){return e.raw().which===n}},isShift:qi,isNotShift:s.not(qi),isControl:Ki,isNotControl:s.not(Ki)},Yi=function(n,e){return{matches:n,classification:e}},Ji=function(n,e){return D.find(n,function(n){return n.matches(e)}).map(function(n){return n.classification})},Qi=function(n,e,t,r,o,i){var u=function(n,e,r,o){var i=t(n,e,r,o);return Ji(i,e.event()).bind(function(t){return t(n,e,r,o)})},a={schema:function(){return n.concat([Xe("focusManager",$i()),Yo.output("handler",a),Yo.output("state",e)])},processKey:u,toEvents:function(n,e){var t=r(n,e),o=bt.derive(i.map(function(t){return bt.run(On.focus(),function(r,o){t(r,n,e,o),o.stop()})}).toArray().concat([bt.run(xn.keydown(),function(t,r){u(t,r,n,e).each(function(n){r.stop()})})]));return Mn.deepMerge(t,o)},toApis:o};return a},Zi=function(n,e,t){var r=D.reverse(n.slice(0,e)),o=D.reverse(n.slice(e+1));return D.find(r.concat(o),t)},nu=function(n,e,t){var r=n.slice(0,e),o=n.slice(e+1);return D.find(o.concat(r),t)},eu=function(n,e,t){var r=D.reverse(n.slice(0,e));return D.find(r,t)},tu=function(n,e,t){var r=n.slice(e+1);return D.find(r,t)},ru=function(n){return n.style!==undefined},ou=function(n,e,t){if(!Cn.isString(t))throw console.error("Invalid call to CSS.set. Property ",e,":: Value ",t,":: Element ",n),new Error("CSS value must be a string: "+t);ru(n)&&n.style.setProperty(e,t)},iu=function(n,e){ru(n)&&n.style.removeProperty(e)},uu=function(n,e,t){var r=n.dom();ou(r,e,t)},au=function(n,e){return ru(n)?n.style.getPropertyValue(e):""},cu=function(n,e){var t=n.dom(),r=au(t,e);return p.from(r).filter(function(n){return n.length>0})},su=uu,fu=function(n,e){var t=n.dom();Nn.each(e,function(n,e){ou(t,e,n)})},lu=function(n,e){var t=n.dom();iu(t,e),mr(n,"style")&&""===Q(dr(n,"style"))&&gr(n,"style")},du=function(n,e){var t=n.dom(),r=window.getComputedStyle(t).getPropertyValue(e),o=""!==r||Jr.inBody(n)?r:au(t,e);return null===o?undefined:o},mu=cu,gu=function(n){return n.dom().offsetWidth},pu=function(n,e){var t=function(t){var r=e(t);if(r<=0||null===r){var o=du(t,n);return parseFloat(o)||0}return r},r=function(n,e){return D.foldl(e,function(e,t){var r=du(n,t),o=r===undefined?0:parseInt(r,10);return isNaN(o)?e:e+o},0)};return{set:function(e,t){if(!Cn.isNumber(t)&&!t.match(/^[0-9]+$/))throw n+".set accepts only positive integer values. Value was "+t;var r=e.dom();ru(r)&&(r.style[n]=t+"px")},get:t,getOuter:t,aggregate:r,max:function(n,e,t){var o=r(n,t);return e>o?e-o:0}}},hu=pu("height",function(n){return Jr.inBody(n)?n.dom().getBoundingClientRect().height:n.dom().offsetHeight}),vu=function(n){return hu.get(n)},yu=function(n){var e=[$e("onEscape"),$e("onEnter"),Xe("selector",'[data-alloy-tabstop="true"]'),Xe("firstTabstop",0),Xe("useTabstopAt",s.constant(!0)),$e("visibilitySelector")].concat([n]),t=function(n,e){var t=n.visibilitySelector().bind(function(n){return Fi(e,n)}).getOr(e);return vu(t)>0},r=function(n,e,r,o,i){return i(e,r,function(n){return function(n,e){return t(n,e)&&n.useTabstopAt()(e)}(o,n)}).fold(function(){return o.cyclic()?p.some(!0):p.none()},function(e){return o.focusManager().set(n,e),p.some(!0)})},o=function(n,e,t,o){var i=Ai(n.element(),t.selector());return function(n,e){return e.focusManager().get(n).bind(function(n){return Fi(n,e.selector())})}(n,t).bind(function(e){return D.findIndex(i,s.curry(wn,e)).bind(function(e){return r(n,i,e,t,o)})})},i=s.constant([Yi(Xi.and([Xi.isShift,Xi.inSet(Si.TAB())]),function(n,e,t,r){var i=t.cyclic()?Zi:eu;return o(n,0,t,i)}),Yi(Xi.inSet(Si.TAB()),function(n,e,t,r){var i=t.cyclic()?nu:tu;return o(n,0,t,i)}),Yi(Xi.inSet(Si.ESCAPE()),function(n,e,t,r){return t.onEscape().bind(function(t){return t(n,e)})}),Yi(Xi.and([Xi.isNotShift,Xi.inSet(Si.ENTER())]),function(n,e,t,r){return t.onEnter().bind(function(t){return t(n,e)})})]),u=s.constant({}),a=s.constant({});return Qi(e,Kt.init,i,u,a,p.some(function(n,e,r){(function(n,e){var r=Ai(n.element(),e.selector()),o=D.filter(r,function(n){return t(e,n)});return p.from(o[e.firstTabstop()])})(n,e).each(function(t){e.focusManager().set(n,t)})}))},bu=yu(Ze("cyclic",s.constant(!1))),wu=yu(Ze("cyclic",s.constant(!0))),Su=function(n){return"input"===ir.name(n)&&"radio"!==dr(n,"type")||"textarea"===ir.name(n)},xu=function(n,e,t){return Su(t)&&Xi.inSet(Si.SPACE())(e.event())?p.none():function(n,e,t){return Un(n,t,On.execute()),p.some(!0)}(n,0,t)},Tu=[Xe("execute",xu),Xe("useSpace",!1),Xe("useEnter",!0),Xe("useControlEnter",!1),Xe("useDown",!1)],Ou=function(n,e,t,r){return t.execute()(n,e,n.element())},ku=s.constant({}),Cu=s.constant({}),Eu=Qi(Tu,Kt.init,function(n,e,t,r){var o=t.useSpace()&&!Su(n.element())?Si.SPACE():[],i=t.useEnter()?Si.ENTER():[],u=t.useDown()?Si.DOWN():[],a=o.concat(i).concat(u);return[Yi(Xi.inSet(a),Ou)].concat(t.useControlEnter()?[Yi(Xi.and([Xi.isControl,Xi.inSet(Si.ENTER())]),Ou)]:[])},ku,Cu,p.none()),Du={flatgrid:function(n){var e=Oo(p.none());return qt({readState:s.constant({}),setGridSize:function(n,t){e.set(p.some({numRows:s.constant(n),numColumns:s.constant(t)}))},getNumRows:function(){return e.get().map(function(n){return n.numRows()})},getNumColumns:function(){return e.get().map(function(n){return n.numColumns()})}})},init:function(n){return n.state()(n)}},Au=function(n){return"rtl"===du(n,"direction")?"rtl":"ltr"},Mu=function(n,e){return function(t){return"rtl"===Au(t)?e:n}},Ru=function(n){return function(e,t,r,o){var i=n(e.element());return Iu(i,e,t,r,o)}},Bu=function(n){return function(e,t,r,o){return Iu(n,e,t,r,o)}},Iu=function(n,e,t,r,o){return r.focusManager().get(e).bind(function(t){return n(e.element(),t,r,o)}).map(function(n){return r.focusManager().set(e,n),!0})},Fu=function(n,e){var t=Mu(e,n);return Ru(t)},Hu=function(n,e){var t=Mu(n,e);return Ru(t)},Nu=Bu,Vu=Bu,ju=Bu,Lu=Mt(["index","candidates"],[]),Pu=function(n,e){return D.findIndex(n,e).map(function(e){return Lu({index:e,candidates:n})})},Wu=function(n){return!function(n){return n.offsetWidth<=0&&n.offsetHeight<=0}(n.dom())},Uu=function(n,e,t,r){var o=s.curry(wn,e),i=Ai(n,t),u=D.filter(i,Wu);return Pu(u,o)},zu=function(n,e,t){return Uu(n,e,t,Wu)},Gu=function(n,e){return D.findIndex(n,function(n){return wn(e,n)})},$u=function(n,e,t,r){return r(Math.floor(e/t),e%t).bind(function(e){var r=e.row()*t+e.column();return r>=0&&r<n.length?p.some(n[r]):p.none()})},_u=function(n,e,t,r,o){return $u(n,e,r,function(e,i){var u=e===t-1?n.length-e*r:r,a=xi(i,o,0,u-1);return p.some({row:s.constant(e),column:s.constant(a)})})},qu=function(n,e,t,r,o){return $u(n,e,r,function(e,i){var u=xi(e,o,0,t-1),a=u===t-1?n.length-u*r:r,c=Ti(i,0,a-1);return p.some({row:s.constant(u),column:s.constant(c)})})},Ku=function(n,e,t,r){return qu(n,e,t,r,1)},Xu=function(n,e,t,r){return qu(n,e,t,r,-1)},Yu=function(n,e,t,r){return _u(n,e,t,r,-1)},Ju=function(n,e,t,r){return _u(n,e,t,r,1)},Qu=[Pe("selector"),Xe("execute",xu),Yo.onKeyboardHandler("onEscape"),Xe("captureTab",!1),Yo.initSize()],Zu=function(n){return function(e,t,r,o){return zu(e,t,r.selector()).bind(function(e){return n(e.candidates(),e.index(),o.getNumRows().getOr(r.initSize().numRows()),o.getNumColumns().getOr(r.initSize().numColumns()))})}},na=function(n,e,t,r){return t.captureTab()?p.some(!0):p.none()},ea=Zu(Yu),ta=Zu(Ju),ra=Zu(Xu),oa=Zu(Ku),ia=s.constant([Yi(Xi.inSet(Si.LEFT()),Hu(ea,ta)),Yi(Xi.inSet(Si.RIGHT()),Fu(ea,ta)),Yi(Xi.inSet(Si.UP()),Nu(ra)),Yi(Xi.inSet(Si.DOWN()),Vu(oa)),Yi(Xi.and([Xi.isShift,Xi.inSet(Si.TAB())]),na),Yi(Xi.and([Xi.isNotShift,Xi.inSet(Si.TAB())]),na),Yi(Xi.inSet(Si.ESCAPE()),function(n,e,t,r){return t.onEscape()(n,e)}),Yi(Xi.inSet(Si.SPACE().concat(Si.ENTER())),function(n,e,t,r){return function(n,e){return e.focusManager().get(n).bind(function(n){return Fi(n,e.selector())})}(n,t).bind(function(r){return t.execute()(n,e,r)})})]),ua=s.constant({}),aa=Qi(Qu,Du.flatgrid,ia,ua,{},p.some(function(n,e,t){Ii(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),ca=function(n,e,t,r){return zu(n,t,e,s.constant(!0)).bind(function(n){var e=n.index(),t=n.candidates(),o=xi(e,r,0,t.length-1);return p.from(t[o])})},sa=[Pe("selector"),Xe("getInitial",p.none),Xe("execute",xu),Xe("executeOnMove",!1)],fa=function(n,e,t){return function(n,e){return e.focusManager().get(n).bind(function(n){return Fi(n,e.selector())})}(n,t).bind(function(r){return t.execute()(n,e,r)})},la=function(n,e,t){return ca(n,t.selector(),e,-1)},da=function(n,e,t){return ca(n,t.selector(),e,1)},ma=function(n){return function(e,t,r){return n(e,t,r).bind(function(){return r.executeOnMove()?fa(e,t,r):p.some(!0)})}},ga=s.constant({}),pa=s.constant({}),ha=Qi(sa,Kt.init,function(n){return[Yi(Xi.inSet(Si.LEFT().concat(Si.UP())),ma(Hu(la,da))),Yi(Xi.inSet(Si.RIGHT().concat(Si.DOWN())),ma(Fu(la,da))),Yi(Xi.inSet(Si.ENTER()),fa),Yi(Xi.inSet(Si.SPACE()),fa)]},ga,pa,p.some(function(n,e){e.getInitial()(n).or(Ii(n.element(),e.selector())).each(function(t){e.focusManager().set(n,t)})})),va=Mt(["rowIndex","columnIndex","cell"],[]),ya=function(n,e,t){return p.from(n[e]).bind(function(n){return p.from(n[t]).map(function(n){return va({rowIndex:e,columnIndex:t,cell:n})})})},ba=function(n,e,t,r){var o=n[e].length,i=xi(t,r,0,o-1);return ya(n,e,i)},wa=function(n,e,t,r){var o=xi(t,r,0,n.length-1),i=n[o].length,u=Ti(e,0,i-1);return ya(n,o,u)},Sa=function(n,e,t,r){var o=n[e].length,i=Ti(t+r,0,o-1);return ya(n,e,i)},xa=function(n,e,t,r){var o=Ti(t+r,0,n.length-1),i=n[o].length,u=Ti(e,0,i-1);return ya(n,o,u)},Ta=function(n,e,t){return ba(n,e,t,1)},Oa=function(n,e,t){return ba(n,e,t,-1)},ka=function(n,e,t){return wa(n,t,e,-1)},Ca=function(n,e,t){return wa(n,t,e,1)},Ea=function(n,e,t){return Sa(n,e,t,-1)},Da=function(n,e,t){return Sa(n,e,t,1)},Aa=function(n,e,t){return xa(n,t,e,-1)},Ma=function(n,e,t){return xa(n,t,e,1)},Ra=[Ue("selectors",[Pe("row"),Pe("cell")]),Xe("cycles",!0),Xe("previousSelector",p.none),Xe("execute",xu)],Ba=function(n,e){return function(t,r,o){var i=o.cycles()?n:e;return Fi(r,o.selectors().row()).bind(function(n){var e=Ai(n,o.selectors().cell());return Gu(e,r).bind(function(e){var r=Ai(t,o.selectors().row());return Gu(r,n).bind(function(n){var t=function(n,e){return D.map(n,function(n){return Ai(n,e.selectors().cell())})}(r,o);return i(t,n,e).map(function(n){return n.cell()})})})})}},Ia=Ba(Oa,Ea),Fa=Ba(Ta,Da),Ha=Ba(ka,Aa),Na=Ba(Ca,Ma),Va=s.constant([Yi(Xi.inSet(Si.LEFT()),Hu(Ia,Fa)),Yi(Xi.inSet(Si.RIGHT()),Fu(Ia,Fa)),Yi(Xi.inSet(Si.UP()),Nu(Ha)),Yi(Xi.inSet(Si.DOWN()),Vu(Na)),Yi(Xi.inSet(Si.SPACE().concat(Si.ENTER())),function(n,e,t){return No(n.element()).bind(function(r){return t.execute()(n,e,r)})})]),ja=s.constant({}),La=s.constant({}),Pa=Qi(Ra,Kt.init,Va,ja,La,p.some(function(n,e){e.previousSelector()(n).orThunk(function(){var t=e.selectors();return Ii(n.element(),t.cell())}).each(function(t){e.focusManager().set(n,t)})})),Wa=[Pe("selector"),Xe("execute",xu),Xe("moveOnTab",!1)],Ua=function(n,e,t){return t.focusManager().get(n).bind(function(r){return t.execute()(n,e,r)})},za=function(n,e,t){return ca(n,t.selector(),e,-1)},Ga=function(n,e,t){return ca(n,t.selector(),e,1)},$a=s.constant([Yi(Xi.inSet(Si.UP()),ju(za)),Yi(Xi.inSet(Si.DOWN()),ju(Ga)),Yi(Xi.and([Xi.isShift,Xi.inSet(Si.TAB())]),function(n,e,t){return t.moveOnTab()?ju(za)(n,e,t):p.none()}),Yi(Xi.and([Xi.isNotShift,Xi.inSet(Si.TAB())]),function(n,e,t){return t.moveOnTab()?ju(Ga)(n,e,t):p.none()}),Yi(Xi.inSet(Si.ENTER()),Ua),Yi(Xi.inSet(Si.SPACE()),Ua)]),_a=s.constant({}),qa=s.constant({}),Ka=Qi(Wa,Kt.init,$a,_a,qa,p.some(function(n,e,t){Ii(n.element(),e.selector()).each(function(t){e.focusManager().set(n,t)})})),Xa=[Yo.onKeyboardHandler("onSpace"),Yo.onKeyboardHandler("onEnter"),Yo.onKeyboardHandler("onShiftEnter"),Yo.onKeyboardHandler("onLeft"),Yo.onKeyboardHandler("onRight"),Yo.onKeyboardHandler("onTab"),Yo.onKeyboardHandler("onShiftTab"),Yo.onKeyboardHandler("onUp"),Yo.onKeyboardHandler("onDown"),Yo.onKeyboardHandler("onEscape"),$e("focusIn")],Ya=s.constant({}),Ja=s.constant({}),Qa=Qi(Xa,Kt.init,function(n,e,t){return[Yi(Xi.inSet(Si.SPACE()),t.onSpace()),Yi(Xi.and([Xi.isNotShift,Xi.inSet(Si.ENTER())]),t.onEnter()),Yi(Xi.and([Xi.isShift,Xi.inSet(Si.ENTER())]),t.onShiftEnter()),Yi(Xi.and([Xi.isShift,Xi.inSet(Si.TAB())]),t.onShiftTab()),Yi(Xi.and([Xi.isNotShift,Xi.inSet(Si.TAB())]),t.onTab()),Yi(Xi.inSet(Si.UP()),t.onUp()),Yi(Xi.inSet(Si.DOWN()),t.onDown()),Yi(Xi.inSet(Si.LEFT()),t.onLeft()),Yi(Xi.inSet(Si.RIGHT()),t.onRight()),Yi(Xi.inSet(Si.SPACE()),t.onSpace()),Yi(Xi.inSet(Si.ESCAPE()),t.onEscape())]},Ya,Ja,p.some(function(n,e){return e.focusIn().bind(function(t){return t(n,e)})})),Za={acyclic:bu.schema(),cyclic:wu.schema(),flow:ha.schema(),flatgrid:aa.schema(),matrix:Pa.schema(),execution:Eu.schema(),menu:Ka.schema(),special:Qa.schema()},nc=Jt.createModes({branchKey:"mode",branches:Za,name:"keying",active:{events:function(n,e){return n.handler().toEvents(n,e)}},apis:{focusIn:function(n){n.getSystem().triggerFocus(n.element(),n.element())},setGridSize:function(n,e,t,r,o){ve(t,"setGridSize")?t.setGridSize(r,o):console.error("Layout does not support setGridSize")}},state:Du}),ec=function(n,e){return Je(n,{},D.map(e,function(e){return Ge(e.name(),"Cannot configure "+e.name()+" for "+n)}).concat([Ze("dump",s.identity)]))},tc=function(n){return n.dump()},rc=0,oc=function(n){var e=(new Date).getTime(),t=Math.floor(1e9*Math.random());return rc++,n+"_"+t+rc+String(e)},ic=oc("alloy-premade"),uc=oc("api"),ac={apiConfig:s.constant(uc),makeApi:function(n){return xt(function(e){var t=Array.prototype.slice.call(arguments,0),r=e.config(uc);return n.apply(undefined,[r].concat(t))},n)},premade:function(n){return pe(ic,n)},getPremade:function(n){return ge(n,ic)}},cc=$n([{required:["data"]},{external:["data"]},{optional:["data"]},{group:["data"]}]),sc=Xe("factory",{sketch:s.identity}),fc=Xe("schema",[]),lc=Pe("name"),dc=Qe("pname","pname",qn.defaultedThunk(function(n){return"<alloy."+oc(n.name)+">"}),lt.anyValue()),mc=Xe("defaults",s.constant({})),gc=Xe("overrides",s.constant({})),pc=lt.objOf([sc,fc,lc,dc,mc,gc]),hc=lt.objOf([sc,fc,lc,mc,gc]),vc=lt.objOf([sc,fc,lc,dc,mc,gc]),yc=lt.objOf([sc,fc,lc,Pe("unit"),dc,mc,gc]),bc=function(n,e){return function(t){var r=lt.asStructOrDie("Converting part type",e,t);return n(r)}},wc={required:bc(cc.required,pc),external:bc(cc.external,hc),optional:bc(cc.optional,vc),group:bc(cc.group,yc),asNamedPart:function(n){return n.fold(p.some,p.none,p.some,p.some)},name:function(n){var e=function(n){return n.name()};return n.fold(e,e,e,e)},asCommon:function(n){return n.fold(s.identity,s.identity,s.identity,s.identity)},original:s.constant("entirety")},Sc=$n([{single:["required","valueThunk"]},{multiple:["required","valueThunks"]}]),xc=function(n,e,t,r){return"placeholder"===t.uiType?function(n,e,t,r){return n.exists(function(n){return n!==t.owner})?Sc.single(!0,s.constant(t)):ge(r,t.name).fold(function(){throw new Error("Unknown placeholder component: "+t.name+"\nKnown: ["+Nn.keys(r)+"]\nNamespace: "+n.getOr("none")+"\nSpec: "+we(t,null,2))},function(n){return n.replace()})}(n,0,t,r):Sc.single(!1,s.constant(t))},Tc=function(n,e,t,r){return xc(n,0,t,r).fold(function(o,i){var u=i(e,t.config,t.validated),a=ge(u,"components").getOr([]),c=D.bind(a,function(t){return Tc(n,e,t,r)});return[Mn.deepMerge(u,{components:c})]},function(n,r){return r(e,t.config,t.validated)})},Oc=function(n,e,t,r){return D.bind(t,function(t){return Tc(n,e,t,r)})},kc={single:Sc.single,multiple:Sc.multiple,isSubstitute:function(n){return D.contains(["placeholder"],n)},placeholder:s.constant("placeholder"),substituteAll:Oc,substitutePlaces:function(n,e,t,r){var o=Nn.map(r,function(n,e){return function(n,e){var t=!1;return{name:s.constant(n),required:function(){return e.fold(function(n,e){return n},function(n,e){return n})},used:function(){return t},replace:function(){if(!0===t)throw new Error("Trying to use the same placeholder more than once: "+n);return t=!0,e}}}(e,n)}),i=Oc(n,e,t,o);return Nn.each(o,function(t){if(!1===t.used()&&t.required())throw new Error("Placeholder: "+t.name()+" was not found in components list\nNamespace: "+n.getOr("none")+"\nComponents: "+we(e.components(),null,2))}),i},singleReplace:function(n,e){return e.fold(function(e,t){return[t(n)]},function(e,t){return t(n)})}},Cc=function(n,e,t,r){var o=t;return Mn.deepMerge(e.defaults()(n,t,r),t,{uid:n.partUids()[e.name()]},e.overrides()(n,t,r),{"debug.sketcher":pe("part-"+e.name(),o)})},Ec=function(n,e,t){var r={},o={};return D.each(t,function(n){n.fold(function(n){r[n.pname()]=kc.single(!0,function(e,t,r){return n.factory().sketch(Cc(e,n,t,r))})},function(n){var t=e.parts()[n.name()]();o[n.name()]=s.constant(Cc(e,n,t[wc.original()]()))},function(n){r[n.pname()]=kc.single(!1,function(e,t,r){return n.factory().sketch(Cc(e,n,t,r))})},function(n){r[n.pname()]=kc.multiple(!0,function(e,t,r){var o=e[n.name()]();return D.map(o,function(t){return n.factory().sketch(Mn.deepMerge(n.defaults()(e,t),t,n.overrides()(e,t)))})})})}),{internals:s.constant(r),externals:s.constant(o)}},Dc=function(n,e){return{uiType:kc.placeholder(),owner:n,name:e}},Ac=function(n){return D.map(n,wc.name)},Mc=function(n,e,t){var r=e.partUids()[t];return n.getSystem().getByUid(r).toOption()},Rc=function(n,e){var t=Ac(e);return he(D.map(t,function(e){return{key:e,value:n+"-"+e}}))},Bc=function(n,e){var t={};return D.each(e,function(e){wc.asNamedPart(e).each(function(e){var r=Dc(n,e.pname());t[e.name()]=function(t){var o=lt.asRawOrDie("Part: "+e.name()+" in "+n,lt.objOf(e.schema()),t);return Mn.deepMerge(r,{config:t,validated:o})}})}),t},Ic=function(n,e,t){return{uiType:kc.placeholder(),owner:n,name:e,config:t,validated:{}}},Fc=function(n){return D.bind(n,function(n){return n.fold(p.none,p.some,p.none,p.none).map(function(n){return Ue(n.name(),n.schema().concat([Yo.snapshot(wc.original())]))}).toArray()})},Hc=function(n,e,t){return Ec(n,e,t)},Nc=function(n,e,t){return kc.substitutePlaces(p.some(n),e,e.components(),t)},Vc=function(n){return Qe("partUids","partUids",qn.mergeWithThunk(function(e){return Rc(e.uid,n)}),lt.anyValue())},jc=function(n,e){var t=n.getSystem();return Nn.map(e.partUids(),function(n,e){return s.constant(t.getByUid(n))})},Lc=Mc,Pc=function(n,e,t){return Mc(n,e,t).getOrDie("Could not find part: "+t)},Wc={prefix:s.constant("alloy-id-"),idAttr:s.constant("data-alloy-id")},Uc=Wc.prefix(),zc=Wc.idAttr(),Gc=function(n,e){var t=oc(Uc+n);return fr(e,zc,t),t},$c=function(n,e){fr(n,zc,e)},_c=function(n){var e=ir.isElement(n)?dr(n,zc):null;return p.from(e)},qc=function(n){return oc(n)},Kc=(s.constant(zc),function(n,e,t,r){return(e.length>0?[Ue("parts",e)]:[]).concat([Pe("uid"),Xe("dom",{}),Xe("components",[]),Yo.snapshot("originalSpec"),Xe("debug.sketcher",{})]).concat(t)}),Xc=function(n,e,t,r,o){var i=Kc(0,r,o);return lt.asStructOrDie(n+" [SpecSchema]",lt.objOfOnly(i.concat(e)),t)},Yc=function(n){return Mn.deepMerge({uid:qc("uid")},n)},Jc=function(n,e,t,r){var o=Yc(r),i=Xc(n,e,o,[],[]);return Mn.deepMerge(t(i,o),{"debug.sketcher":pe(n,r)})},Qc=function(n,e,t,r,o){var i=Yc(o),u=Fc(t),a=Vc(t),c=Xc(n,e,i,u,[a]),s=Hc(n,c,t),f=Nc(n,c,s.internals());return Mn.deepMerge(r(c,f,i,s.externals()),{"debug.sketcher":pe(n,o)})},Zc=lt.objOfOnly([Pe("name"),Pe("factory"),Pe("configFields"),Xe("apis",{}),Xe("extraApis",{})]),ns=lt.objOfOnly([Pe("name"),Pe("factory"),Pe("configFields"),Pe("partFields"),Xe("apis",{}),Xe("extraApis",{})]),es=function(n){var e=lt.asRawOrDie("Sketcher for "+n.name,Zc,n),t=Nn.map(e.apis,ac.makeApi),r=Nn.map(e.extraApis,function(n,e){return St(n,e)});return Mn.deepMerge({name:s.constant(e.name),partFields:s.constant([]),configFields:s.constant(e.configFields),sketch:function(n){return Jc(e.name,e.configFields,e.factory,n)}},t,r)},ts=function(n){var e=lt.asRawOrDie("Sketcher for "+n.name,ns,n),t=Bc(e.name,e.partFields),r=Nn.map(e.apis,ac.makeApi),o=Nn.map(e.extraApis,function(n,e){return St(n,e)});return Mn.deepMerge({name:s.constant(e.name),partFields:s.constant(e.partFields),configFields:s.constant(e.configFields),sketch:function(n){return Qc(e.name,e.configFields,e.partFields,e.factory,n)},parts:s.constant(t)},r,o)},rs=function(n){var e=function(n,e){e.stop(),Wn(n)},t=un.detect().deviceType.isTouch()?[bt.run(On.tap(),e)]:[bt.run(xn.click(),e),bt.run(xn.mousedown(),function(n,e){e.cut()})];return bt.derive(D.flatten([n.map(function(n){return bt.run(On.execute(),function(e,t){n(e),t.stop()})}).toArray(),t]))},os=es({name:"Button",factory:function(n,e){var t=rs(n.action()),r=ge(n.dom(),"attributes").bind(de("type")),o=ge(n.dom(),"tag");return{uid:n.uid(),dom:n.dom(),components:n.components(),events:t,behaviours:Mn.deepMerge(Jt.derive([wi.config({}),nc.config({mode:"execution",useSpace:!0,useEnter:!0})]),tc(n.buttonBehaviours())),domModification:{attributes:Mn.deepMerge(r.fold(function(){return o.is("button")?{type:"button"}:{}},function(n){return{}}),{role:n.role().getOr("button")})},eventOrder:n.eventOrder()}},configFields:[Xe("uid",undefined),Pe("dom"),Xe("components",[]),ec("buttonBehaviours",[wi,nc]),$e("action"),$e("role"),Xe("eventOrder",{})]}),is=function(n){var e=cn.fromHtml(n),t=Wr.children(e),r=function(n){var e=n.dom().attributes!==undefined?n.dom().attributes:[];return D.foldl(e,function(n,e){return"class"===e.name?n:Mn.deepMerge(n,pe(e.name,e.value))},{})}(e),o=function(n){return Array.prototype.slice.call(n.dom().classList,0)}(e),i=0===t.length?{}:{innerHtml:io(e)};return Mn.deepMerge({tag:ir.name(e),classes:o,attributes:r},i)},us=is,as=function(n){var e=Y(n,{prefix:gi.prefix()});return us(e)},cs=as,ss=function(n){return{dom:as(n)}},fs=function(n){return Jt.derive([fi.config({toggleClass:gi.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),li(n,function(n,e){(e?fi.on:fi.off)(n)})])},ls=function(n,e,t){return os.sketch({dom:cs('<span class="${prefix}-toolbar-button ${prefix}-icon-'+n+' ${prefix}-icon"></span>'),action:e,buttonBehaviours:Mn.deepMerge(Jt.derive([hi.config({})]),t)})},ds={forToolbar:ls,forToolbarCommand:function(n,e){return ls(e,function(){n.execCommand(e)},{})},forToolbarStateAction:function(n,e,t,r){var o=fs(t);return ls(e,r,o)},forToolbarStateCommand:function(n,e){var t=fs(e);return ls(e,function(){n.execCommand(e)},t)}},ms=function(n,e,t){return Math.max(e,Math.min(t,n))},gs=function(n,e,t,r){return n<e?n:n>t?t:n===e?e-1:Math.max(e,n-r)},ps=function(n,e,t,r){return n>t?n:n<e?e:n===t?t+1:Math.min(t,n+r)},hs=function(n,e,t,r,o,i,u){var a=t-e;if(r<n.left)return e-1;if(r>n.right)return t+1;var c=Math.min(n.right,Math.max(r,n.left))-n.left,s=ms(c/n.width*a+e,e-1,t+1),f=Math.round(s);return i&&s>=e&&s<=t?function(n,e,t,r,o,i){return i.fold(function(){var n=e-t,i=Math.round(n/o)*o;return ms(t+i,t-1,r+1)},function(n){var t=(e-n)%o,i=Math.round(t/o),u=Math.floor((e-n)/o),a=Math.floor((r-n)/o),c=n+Math.min(a,u+i)*o;return Math.max(n,c)})}(0,s,e,t,o,u):f},vs=un.detect().deviceType.isTouch(),ys=function(n){return function(n){var e=n.event().raw();return vs&&e.touches!==undefined&&1===e.touches.length?p.some(e.touches[0]):vs&&e.touches!==undefined?p.none():vs||e.clientX===undefined?p.none():p.some(e)}(n).map(function(n){return n.clientX})},bs=function(n,e){Pn(n,"slider.change.value",{value:e})},ws={setXFromEvent:function(n,e,t,r){return ys(r).map(function(r){return function(n,e,t,r){var o=hs(e,t.min(),t.max(),r,t.stepSize(),t.snapToGrid(),t.snapStart());bs(n,o)}(n,t,e,r),r})},setToLedge:function(n,e){bs(n,e.min()-1)},setToRedge:function(n,e){bs(n,e.max()+1)},moveLeftFromRedge:function(n,e){bs(n,e.max())},moveRightFromLedge:function(n,e){bs(n,e.min())},moveLeft:function(n,e){var t=gs(e.value().get(),e.min(),e.max(),e.stepSize());bs(n,t)},moveRight:function(n,e){var t=ps(e.value().get(),e.min(),e.max(),e.stepSize());bs(n,t)},changeEvent:s.constant("slider.change.value")},Ss=un.detect().deviceType.isTouch(),xs=function(n,e){return wc.optional({name:n+"-edge",overrides:function(n){var t=bt.derive([bt.runActionExtra(xn.touchstart(),e,[n])]),r=bt.derive([bt.runActionExtra(xn.mousedown(),e,[n]),bt.runActionExtra(xn.mousemove(),function(n,t){t.mouseIsDown().get()&&e(n,t)},[n])]);return{events:Ss?t:r}}})},Ts=[xs("left",ws.setToLedge),xs("right",ws.setToRedge),wc.required({name:"thumb",defaults:s.constant({dom:{styles:{position:"absolute"}}}),overrides:function(n){return{events:bt.derive([bt.redirectToPart(xn.touchstart(),n,"spectrum"),bt.redirectToPart(xn.touchmove(),n,"spectrum"),bt.redirectToPart(xn.touchend(),n,"spectrum")])}}}),wc.required({schema:[Ze("mouseIsDown",function(){return Oo(!1)})],name:"spectrum",overrides:function(n){var e=function(e,t){var r=e.element().dom().getBoundingClientRect();ws.setXFromEvent(e,n,r,t)},t=bt.derive([bt.run(xn.touchstart(),e),bt.run(xn.touchmove(),e)]),r=bt.derive([bt.run(xn.mousedown(),e),bt.run(xn.mousemove(),function(t,r){n.mouseIsDown().get()&&e(t,r)})]);return{behaviours:Jt.derive(Ss?[]:[nc.config({mode:"special",onLeft:function(e){return ws.moveLeft(e,n),p.some(!0)},onRight:function(e){return ws.moveRight(e,n),p.some(!0)}}),wi.config({})]),events:Ss?t:r}}})],Os={onLoad:function(n,e,t){e.store().manager().onLoad(n,e,t)},onUnload:function(n,e,t){e.store().manager().onUnload(n,e,t)},setValue:function(n,e,t,r){e.store().manager().setValue(n,e,t,r)},getValue:function(n,e,t){return e.store().manager().getValue(n,e,t)}},ks={events:function(n,e){var t=n.resetOnDom()?[bt.runOnAttached(function(t,r){Os.onLoad(t,n,e)}),bt.runOnDetached(function(t,r){Os.onUnload(t,n,e)})]:[Pt(n,e,Os.onLoad)];return bt.derive(t)}},Cs={memory:function(){var n=Oo(null);return qt({set:n.set,get:n.get,isNotSet:function(){return null===n.get()},clear:function(){n.set(null)},readState:function(){return{mode:"memory",value:n.get()}}})},dataset:function(){var n=Oo({});return qt({readState:function(){return{mode:"dataset",dataset:n.get()}},set:n.set,get:n.get})},manual:function(){return qt({readState:function(){}})},init:function(n){return n.store().manager().state(n)}},Es=function(n,e,t,r){e.store().getDataKey();t.set({}),e.store().setData()(n,r),e.onSetValue()(n,r)},Ds=[$e("initialValue"),Pe("getFallbackEntry"),Pe("getDataKey"),Pe("setData"),Yo.output("manager",{setValue:Es,getValue:function(n,e,t){var r=e.store().getDataKey()(n),o=t.get();return ge(o,r).fold(function(){return e.store().getFallbackEntry()(r)},function(n){return n})},onLoad:function(n,e,t){e.store().initialValue().each(function(r){Es(n,e,t,r)})},onUnload:function(n,e,t){t.set({})},state:Cs.dataset})],As=[Pe("getValue"),Xe("setValue",s.noop),$e("initialValue"),Yo.output("manager",{setValue:function(n,e,t,r){e.store().setValue()(n,r),e.onSetValue()(n,r)},getValue:function(n,e,t){return e.store().getValue()(n)},onLoad:function(n,e,t){e.store().initialValue().each(function(t){e.store().setValue()(n,t)})},onUnload:s.noop,state:Kt.init})],Ms=[$e("initialValue"),Yo.output("manager",{setValue:function(n,e,t,r){t.set(r),e.onSetValue()(n,r)},getValue:function(n,e,t){return t.get()},onLoad:function(n,e,t){e.store().initialValue().each(function(n){t.isNotSet()&&t.set(n)})},onUnload:function(n,e,t){t.clear()},state:Cs.memory})],Rs=[Ye("store",{mode:"memory"},lt.choose("mode",{memory:Ms,manual:As,dataset:Ds})),Yo.onHandler("onSetValue"),Xe("resetOnDom",!1)],Bs=Jt.create({fields:Rs,name:"representing",active:ks,apis:Os,extra:{setValueFrom:function(n,e){var t=Bs.getValue(e);Bs.setValue(n,t)}},state:Cs}),Is=un.detect().deviceType.isTouch(),Fs=[Pe("min"),Pe("max"),Xe("stepSize",1),Xe("onChange",s.noop),Xe("onInit",s.noop),Xe("onDragStart",s.noop),Xe("onDragEnd",s.noop),Xe("snapToGrid",!1),$e("snapStart"),Pe("getInitialValue"),ec("sliderBehaviours",[nc,Bs]),Ze("value",function(n){return Oo(n.min)})].concat(Is?[]:[Ze("mouseIsDown",function(){return Oo(!1)})]),Hs=pu("width",function(n){return n.dom().offsetWidth}),Ns=function(n,e){Hs.set(n,e)},Vs=function(n){return Hs.get(n)},js=un.detect().deviceType.isTouch(),Ls=ts({name:"Slider",configFields:Fs,partFields:Ts,factory:function(n,e,t,r){var o=n.max()-n.min(),i=function(n){var e=n.element().dom().getBoundingClientRect();return(e.left+e.right)/2},u=function(e){return Pc(e,n,"thumb")},a=function(e){var t=Pc(e,n,"spectrum").element().dom().getBoundingClientRect(),r=e.element().dom().getBoundingClientRect(),u=function(n,e,t){var r=t.value().get();return r<t.min()?Lc(n,t,"left-edge").fold(function(){return 0},function(n){return i(n)-e.left}):r>t.max()?Lc(n,t,"right-edge").fold(function(){return e.width},function(n){return i(n)-e.left}):(t.value().get()-t.min())/o*e.width}(e,t,n);return t.left-r.left+u},c=function(n){var e=a(n),t=u(n),r=Vs(t.element())/2;su(t.element(),"left",e-r+"px")},f=function(e,t){var r=n.value().get(),o=u(e);return r!==t||mu(o.element(),"left").isNone()?(n.value().set(t),c(e),n.onChange()(e,o,t),p.some(!0)):p.none()},l=js?[bt.run(xn.touchstart(),function(e,t){n.onDragStart()(e,u(e))}),bt.run(xn.touchend(),function(e,t){n.onDragEnd()(e,u(e))})]:[bt.run(xn.mousedown(),function(e,t){t.stop(),n.onDragStart()(e,u(e)),n.mouseIsDown().set(!0)}),bt.run(xn.mouseup(),function(e,t){n.onDragEnd()(e,u(e)),n.mouseIsDown().set(!1)})];return{uid:n.uid(),dom:n.dom(),components:e,behaviours:Mn.deepMerge(Jt.derive(D.flatten([js?[]:[nc.config({mode:"special",focusIn:function(e){return Lc(e,n,"spectrum").map(nc.focusIn).map(s.constant(!0))}})],[Bs.config({store:{mode:"manual",getValue:function(e){return n.value().get()}}})]])),tc(n.sliderBehaviours())),events:bt.derive([bt.run(ws.changeEvent(),function(n,e){f(n,e.event().value())}),bt.runOnAttached(function(e,t){n.value().set(n.getInitialValue()());var r=u(e);c(e),n.onInit()(e,r,n.value().get())})].concat(l)),apis:{resetToMin:function(e){f(e,n.min())},resetToMax:function(e){f(e,n.max())},refresh:c},domModification:{styles:{position:"relative"}}}},apis:{resetToMin:function(n,e){n.resetToMin(e)},resetToMax:function(n,e){n.resetToMax(e)},refresh:function(n,e){n.refresh(e)}}}),Ps=function(n,e,t){return ds.forToolbar(e,function(){var r=t();n.setContextToolbar([{label:e+" group",items:r}])},{})},Ws=function(n){return[function(n){var e=function(n){return n<0?"black":n>360?"white":"hsl("+n+", 100%, 50%)"};return Ls.sketch({dom:cs('<div class="${prefix}-slider ${prefix}-hue-slider-container"></div>'),components:[Ls.parts()["left-edge"](ss('<div class="${prefix}-hue-slider-black"></div>')),Ls.parts().spectrum({dom:cs('<div class="${prefix}-slider-gradient-container"></div>'),components:[ss('<div class="${prefix}-slider-gradient"></div>')],behaviours:Jt.derive([fi.config({toggleClass:gi.resolve("thumb-active")})])}),Ls.parts()["right-edge"](ss('<div class="${prefix}-hue-slider-white"></div>')),Ls.parts().thumb({dom:cs('<div class="${prefix}-slider-thumb"></div>'),behaviours:Jt.derive([fi.config({toggleClass:gi.resolve("thumb-active")})])})],onChange:function(t,r,o){var i=e(o);su(r.element(),"background-color",i),n.onChange(t,r,i)},onDragStart:function(n,e){fi.on(e)},onDragEnd:function(n,e){fi.off(e)},onInit:function(n,t,r){var o=e(r);su(t.element(),"background-color",o)},stepSize:10,min:0,max:360,getInitialValue:n.getInitialValue,sliderBehaviours:Jt.derive([di(Ls.refresh)])})}(n)]},Us=function(n,e){var t={onChange:function(n,t,r){e.undoManager.transact(function(){e.formatter.apply("forecolor",{value:r}),e.nodeChanged()})},getInitialValue:function(){return-1}};return Ps(n,"color",function(){return Ws(t)})},zs=lt.objOfOnly([Pe("getInitialValue"),Pe("onChange"),Pe("category"),Pe("sizes")]),Gs=function(n){var e=lt.asRawOrDie("SizeSlider",zs,n);return Ls.sketch({dom:{tag:"div",classes:[gi.resolve("slider-"+e.category+"-size-container"),gi.resolve("slider"),gi.resolve("slider-size-container")]},onChange:function(n,t,r){(function(n){return n>=0&&n<e.sizes.length})(r)&&e.onChange(r)},onDragStart:function(n,e){fi.on(e)},onDragEnd:function(n,e){fi.off(e)},min:0,max:e.sizes.length-1,stepSize:1,getInitialValue:e.getInitialValue,snapToGrid:!0,sliderBehaviours:Jt.derive([di(Ls.refresh)]),components:[Ls.parts().spectrum({dom:cs('<div class="${prefix}-slider-size-container"></div>'),components:[ss('<div class="${prefix}-slider-size-line"></div>')]}),Ls.parts().thumb({dom:cs('<div class="${prefix}-slider-thumb"></div>'),behaviours:Jt.derive([fi.config({toggleClass:gi.resolve("thumb-active")})])})]})},$s=function(n,e,t){for(var r=n.dom(),o=Cn.isFunction(t)?t:s.constant(!1);r.parentNode;){r=r.parentNode;var i=cn.fromDom(r),u=e(i);if(u.isSome())return u;if(o(i))break}return p.none()},_s=function(n,e,t){return e(n).orThunk(function(){return t(n)?p.none():$s(n,e,t)})},qs=["9px","10px","11px","12px","14px","16px","18px","20px","24px","32px","36px"],Ks=function(n){var e=n.selection.getStart(),t=cn.fromDom(e),r=cn.fromDom(n.getBody()),o=function(n,e){return(ir.isElement(e)?p.some(e):Wr.parent(e)).map(function(e){return _s(e,function(n){return mu(n,"font-size")},n).getOrThunk(function(){return du(e,"font-size")})}).getOr("")}(function(n){return wn(r,n)},t);return D.find(qs,function(n){return o===n}).getOr("medium")},Xs={candidates:s.constant(qs),get:function(n){return function(n){return D.findIndex(qs,function(e){return e===n})}(Ks(n)).getOr(2)},apply:function(n,e){(function(n){return p.from(qs[n])})(e).each(function(e){!function(n,e){Ks(n)!==e&&n.execCommand("fontSize",!1,e)}(n,e)})}},Ys=Xs.candidates(),Js=function(n){return[ss('<span class="${prefix}-toolbar-button ${prefix}-icon-small-font ${prefix}-icon"></span>'),function(n){return Gs({onChange:n.onChange,sizes:Ys,category:"font",getInitialValue:n.getInitialValue})}(n),ss('<span class="${prefix}-toolbar-button ${prefix}-icon-large-font ${prefix}-icon"></span>')]},Qs=function(n,e){var t={onChange:function(n){Xs.apply(e,n)},getInitialValue:function(){return Xs.get(e)}};return Ps(n,"font-size",function(){return Js(t)})},Zs=function(n){var e=ve(n,"uid")?n.uid:qc("memento");return{get:function(n){return n.getSystem().getByUid(e).getOrDie()},getOpt:function(n){return n.getSystem().getByUid(e).fold(p.none,p.some)},asSpec:function(){return Mn.deepMerge(n,{uid:e})}}},nf={create:n,clone:function(t){var r;return r=n(t.width,t.height),e(r).drawImage(t,0,0),r},resize:t,get2dContext:e,get3dContext:function(n){var e=null;try{e=n.getContext("webgl")||n.getContext("experimental-webgl")}catch(t){}return e||(e=null),e}},ef={getWidth:function(n){return n.naturalWidth||n.width},getHeight:function(n){return n.naturalHeight||n.height}},tf=window.Promise?window.Promise:function(){function n(n,e){return function(){n.apply(e,arguments)}}function e(n){var e=this;null!==this._state?a(function(){var t=e._state?n.onFulfilled:n.onRejected;if(null!==t){var r;try{r=t(e._value)}catch(o){return void n.reject(o)}n.resolve(r)}else(e._state?n.resolve:n.reject)(e._value)}):this._deferreds.push(n)}function t(e){try{if(e===this)throw new TypeError("A promise cannot be resolved with itself.");if(e&&("object"==typeof e||"function"==typeof e)){var u=e.then;if("function"==typeof u)return void i(n(u,e),n(t,this),n(r,this))}this._state=!0,this._value=e,o.call(this)}catch(a){r.call(this,a)}}function r(n){this._state=!1,this._value=n,o.call(this)}function o(){for(var n=0,t=this._deferreds.length;n<t;n++)e.call(this,this._deferreds[n]);this._deferreds=null}function i(n,e,t){var r=!1;try{n(function(n){r||(r=!0,e(n))},function(n){r||(r=!0,t(n))})}catch(o){if(r)return;r=!0,t(o)}}var u=function(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");if("function"!=typeof e)throw new TypeError("not a function");this._state=null,this._value=null,this._deferreds=[],i(e,n(t,this),n(r,this))},a=u.immediateFn||"function"==typeof setImmediate&&setImmediate||function(n){setTimeout(n,1)},c=Array.isArray||function(n){return"[object Array]"===Object.prototype.toString.call(n)};return u.prototype["catch"]=function(n){return this.then(null,n)},u.prototype.then=function(n,t){var r=this;return new u(function(o,i){e.call(r,new function(n,e,t,r){this.onFulfilled="function"==typeof n?n:null,this.onRejected="function"==typeof e?e:null,this.resolve=t,this.reject=r}(n,t,o,i))})},u.all=function(){var n=Array.prototype.slice.call(1===arguments.length&&c(arguments[0])?arguments[0]:arguments);return new u(function(e,t){function r(i,u){try{if(u&&("object"==typeof u||"function"==typeof u)){var a=u.then;if("function"==typeof a)return void a.call(u,function(n){r(i,n)},t)}n[i]=u,0==--o&&e(n)}catch(c){t(c)}}if(0===n.length)return e([]);for(var o=n.length,i=0;i<n.length;i++)r(i,n[i])})},u.resolve=function(n){return n&&"object"==typeof n&&n.constructor===u?n:new u(function(e){e(n)})},u.reject=function(n){return new u(function(e,t){t(n)})},u.race=function(n){return new u(function(e,t){for(var r=0,o=n.length;r<o;r++)n[r].then(e,t)})},u}(),rf=function(n,e){return new(B("Blob"))(n,e)},of=function(){return new(B("FileReader"))},uf=function(n){return new(B("Uint8Array"))(n)},af={atob:function(n){return B("atob")(n)},requestAnimationFrame:function(n){B("requestAnimationFrame")(n)}},cf={blobToImage:r,imageToBlob:function(n){return function(n){return new tf(function(e){function t(){n.removeEventListener("load",t),e(n)}n.complete?e(n):n.addEventListener("load",t)})}(n).then(function(n){var e=n.src;return 0===e.indexOf("blob:")?o(e):0===e.indexOf("data:")?u(e):o(e)})},blobToDataUri:a,blobToBase64:function(n){return a(n).then(function(n){return n.split(",")[1]})},dataUriToBlobSync:i,canvasToBlob:function(n,e,t){return e=e||"image/png",HTMLCanvasElement.prototype.toBlob?new tf(function(r){n.toBlob(function(n){r(n)},e,t)}):u(n.toDataURL(e,t))},canvasToDataURL:function(n,e,t){return e=e||"image/png",n.then(function(n){return n.toDataURL(e,t)})},blobToCanvas:function(n){return r(n).then(function(n){!function(n){URL.revokeObjectURL(n.src)}(n);var e;return e=nf.create(ef.getWidth(n),ef.getHeight(n)),nf.get2dContext(e).drawImage(n,0,0),e})},uriToBlob:function(n){return 0===n.indexOf("blob:")?o(n):0===n.indexOf("data:")?u(n):null}},sf=function(n){return cf.blobToBase64(n)},ff=function(n){var e=Zs({dom:{tag:"input",attributes:{accept:"image/*",type:"file",title:""},styles:{visibility:"hidden",position:"absolute"}},events:bt.derive([bt.cutter(xn.click()),bt.run(xn.change(),function(e,t){(function(n){var e=n.event(),t=e.raw().target.files||e.raw().dataTransfer.files;return p.from(t[0])})(t).each(function(e){!function(n,e){sf(e).then(function(t){n.undoManager.transact(function(){var r=n.editorUpload.blobCache,o=r.create(oc("mceu"),e,t);r.add(o);var i=n.dom.createHTML("img",{src:o.blobUri()});n.insertContent(i)})})}(n,e)})})])});return os.sketch({dom:cs('<span class="${prefix}-toolbar-button ${prefix}-icon-image ${prefix}-icon"></span>'),components:[e.asSpec()],action:function(n){e.get(n).element().dom().click()}})},lf=function(n){return n.dom().textContent},df=function(n,e){n.dom().textContent=e},mf=function(n){return n.length>0},gf=function(n){return n===undefined||null===n?"":n},pf=function(n,e,t){return t.text.filter(mf).fold(function(){return function(n){return dr(n,"href")===lf(n)}(n)?p.some(e):p.none()},p.some)},hf=function(n){var e=cn.fromDom(n.selection.getStart());return Fi(e,"a")},vf={getInfo:function(n){return hf(n).fold(function(){return function(n){return{url:"",text:n.selection.getContent({format:"text"}),title:"",target:"",link:p.none()}}(n)},function(n){return function(n){var e=lf(n),t=dr(n,"href"),r=dr(n,"title"),o=dr(n,"target");return{url:gf(t),text:e!==t?gf(e):"",title:gf(r),target:gf(o),link:p.some(n)}}(n)})},applyInfo:function(n,e){e.url.filter(mf).fold(function(){!function(n,e){e.link.bind(s.identity).each(function(e){n.execCommand("unlink")})}(n,e)},function(t){var r=function(n,e){var t={};return t.href=n,e.title.filter(mf).each(function(n){t.title=n}),e.target.filter(mf).each(function(n){t.target=n}),t}(t,e);e.link.bind(s.identity).fold(function(){var o=e.text.filter(mf).getOr(t);n.insertContent(n.dom.createHTML("a",r,n.dom.encode(o)))},function(n){var o=pf(n,t,e);lr(n,r),o.each(function(e){df(n,e)})})})},query:hf},yf=function(n,e){var t=bt.derive(e);return Jt.create({fields:[Pe("enabled")],name:n,active:{events:s.constant(t)}})},bf=function(n,e){return{key:n,value:{config:{},me:yf(n,e),configAsRaw:s.constant({}),initialConfig:{},state:Jt.noState()}}},wf={getCurrent:function(n,e,t){return e.find()(n)}},Sf=[Pe("find")],xf=Jt.create({fields:Sf,name:"composing",apis:wf}),Tf=es({name:"Container",factory:function(n,e){return{uid:n.uid(),dom:Mn.deepMerge({tag:"div",attributes:{role:"presentation"}},n.dom()),components:n.components(),behaviours:tc(n.containerBehaviours()),events:n.events(),domModification:n.domModification(),eventOrder:n.eventOrder()}},configFields:[Xe("components",[]),ec("containerBehaviours",[]),Xe("events",{}),Xe("domModification",{}),Xe("eventOrder",{})]}),Of=es({name:"DataField",factory:function(n,e){return{uid:n.uid(),dom:n.dom(),behaviours:Mn.deepMerge(Jt.derive([Bs.config({store:{mode:"memory",initialValue:n.getInitialValue()()}}),xf.config({find:p.some})]),tc(n.dataBehaviours())),events:bt.derive([bt.runOnAttached(function(e,t){Bs.setValue(e,n.getInitialValue()())})])}},configFields:[Pe("uid"),Pe("dom"),Pe("getInitialValue"),ec("dataBehaviours",[Bs,xf])]}),kf=function(n,e){if(e===undefined)throw new Error("Value.set was undefined");n.dom().value=e},Cf=function(n){return n.dom().value},Ef=[$e("data"),Xe("inputAttributes",{}),Xe("inputStyles",{}),Xe("type","input"),Xe("tag","input"),Xe("inputClasses",[]),Yo.onHandler("onSetValue"),Xe("styles",{}),$e("placeholder"),Xe("eventOrder",{}),ec("inputBehaviours",[Bs,wi]),Xe("selectOnFocus",!0)],Df={schema:s.constant(Ef),behaviours:function(n){return Mn.deepMerge(Jt.derive([Bs.config({store:{mode:"manual",initialValue:n.data().getOr(undefined),getValue:function(n){return Cf(n.element())},setValue:function(n,e){Cf(n.element())!==e&&kf(n.element(),e)}},onSetValue:n.onSetValue()}),wi.config({onFocus:!1===n.selectOnFocus()?s.noop:function(n){var e=n.element(),t=Cf(e);e.dom().setSelectionRange(0,t.length)}})]),tc(n.inputBehaviours()))},dom:function(n){return{tag:n.tag(),attributes:Mn.deepMerge(he([{key:"type",value:n.type()}].concat(n.placeholder().map(function(n){return{key:"placeholder",value:n}}).toArray())),n.inputAttributes()),styles:n.inputStyles(),classes:n.inputClasses()}}},Af=es({name:"Input",configFields:Df.schema(),factory:function(n,e){return{uid:n.uid(),dom:Df.dom(n),components:[],behaviours:Df.behaviours(n),eventOrder:n.eventOrder()}}}),Mf={exhibit:function(n,e){return Nt.nu({attributes:he([{key:e.tabAttr(),value:"true"}])})}},Rf=[Xe("tabAttr","data-alloy-tabstop")],Bf=Jt.create({fields:Rf,name:"tabstopping",active:Mf}),If=function(n,e){var t=Zs(Af.sketch({placeholder:e,onSetValue:function(n,e){Ln(n,xn.input())},inputBehaviours:Jt.derive([xf.config({find:p.some}),Bf.config({}),nc.config({mode:"execution"})]),selectOnFocus:!1})),r=Zs(os.sketch({dom:cs('<button class="${prefix}-input-container-x ${prefix}-icon-cancel-circle ${prefix}-icon"></button>'),action:function(n){var e=t.get(n);Bs.setValue(e,"")}}));return{name:n,spec:Tf.sketch({dom:cs('<div class="${prefix}-input-container"></div>'),components:[t.asSpec(),r.asSpec()],containerBehaviours:Jt.derive([fi.config({toggleClass:gi.resolve("input-container-empty")}),xf.config({find:function(n){return p.some(t.get(n))}}),bf("input-clearing",[bt.run(xn.input(),function(n){var e=t.get(n);(Bs.getValue(e).length>0?fi.off:fi.on)(n)})])])})}},Ff=function(n){return{name:n,spec:Of.sketch({dom:{tag:"span",styles:{display:"none"}},getInitialValue:function(){return p.none()}})}},Hf=["input","button","textarea"],Nf=function(n){return D.contains(Hf,ir.name(n.element()))},Vf=function(n){fr(n.element(),"disabled","disabled")},jf=function(n){gr(n.element(),"disabled")},Lf=function(n){fr(n.element(),"aria-disabled","true")},Pf=function(n){fr(n.element(),"aria-disabled","false")},Wf=function(n,e,t){e.disableClass().each(function(e){Dr.add(n.element(),e)});(Nf(n)?Vf:Lf)(n)},Uf={enable:function(n,e,t){e.disableClass().each(function(e){Dr.remove(n.element(),e)});(Nf(n)?jf:Pf)(n)},disable:Wf,isDisabled:function(n){return Nf(n)?function(n){return mr(n.element(),"disabled")}(n):function(n){return"true"===dr(n.element(),"aria-disabled")}(n)},onLoad:function(n,e,t){e.disabled()&&Wf(n,e,t)}},zf={exhibit:function(n,e,t){return Nt.nu({classes:e.disabled()?e.disableClass().map(D.pure).getOr([]):[]})},events:function(n,e){return bt.derive([bt.abort(On.execute(),function(t,r){return Uf.isDisabled(t,n,e)}),Pt(n,e,Uf.onLoad)])}},Gf=[Xe("disabled",!1),$e("disableClass")],$f=Jt.create({fields:Gf,name:"disabling",active:zf,apis:Uf}),_f=[ec("formBehaviours",[Bs])],qf=function(n){return"<alloy.field."+n+">"},Kf=function(n,e,t){return Mn.deepMerge({"debug.sketcher":{Form:t},uid:n.uid(),dom:n.dom(),components:e,behaviours:Mn.deepMerge(Jt.derive([Bs.config({store:{mode:"manual",getValue:function(e){var t=jc(e,n);return Nn.map(t,function(n,e){return n().bind(xf.getCurrent).map(Bs.getValue)})},setValue:function(e,t){Nn.each(t,function(t,r){Lc(e,n,r).each(function(n){xf.getCurrent(n).each(function(n){Bs.setValue(n,t)})})})}}})]),tc(n.formBehaviours())),apis:{getField:function(e,t){return Lc(e,n,t).bind(xf.getCurrent)}}})},Xf=(ac.makeApi(function(n,e,t){return n.getField(e,t)}),function(n){var e=function(){var n=[];return{field:function(e,t){return n.push(e),Ic("form",qf(e),t)},record:function(){return n}}}(),t=n(e),r=e.record(),o=D.map(r,function(n){return wc.required({name:n,pname:qf(n)})});return Qc("form",_f,o,Kf,t)}),Yf=function(){var n=Oo(p.none()),e=function(){n.get().each(function(n){n.destroy()})};return{clear:function(){e(),n.set(p.none())},isSet:function(){return n.get().isSome()},set:function(t){e(),n.set(p.some(t))},run:function(e){n.get().each(e)}}},Jf=function(){var n=Oo(p.none());return{clear:function(){n.set(p.none())},set:function(e){n.set(p.some(e))},isSet:function(){return n.get().isSome()},on:function(e){n.get().each(e)}}},Qf=function(n){return{xValue:n,points:[]}},Zf=function(n,e){if(e===n.xValue)return n;var t=e-n.xValue>0?1:-1,r={direction:t,xValue:e};return{xValue:e,points:(0===n.points.length?[]:n.points[n.points.length-1].direction===t?n.points.slice(0,n.points.length-1):n.points).concat([r])}},nl=function(n){if(0===n.points.length)return 0;var e=n.points[0].direction,t=n.points[n.points.length-1].direction;return-1===e&&-1===t?-1:1===e&&1==t?1:0},el=function(n){var e=lt.objOf([Pe("fields"),Xe("maxFieldIndex",n.fields.length-1),Pe("onExecute"),Pe("getInitialValue"),Ze("state",function(){return{dialogSwipeState:Jf(),currentScreen:Oo(0)}})]),t=lt.asRawOrDie("SerialisedDialog",e,n),r=function(n,e,t){return os.sketch({dom:cs('<span class="${prefix}-icon-'+e+' ${prefix}-icon"></span>'),action:function(e){Pn(e,"navigateEvent",{direction:n})},buttonBehaviours:Jt.derive([$f.config({disableClass:gi.resolve("toolbar-navigation-disabled"),disabled:!t})])})},o=function(n,e){var r=Ai(n.element(),"."+gi.resolve("serialised-dialog-screen"));Ii(n.element(),"."+gi.resolve("serialised-dialog-chain")).each(function(n){t.state.currentScreen.get()+e>=0&&t.state.currentScreen.get()+e<r.length&&(mu(n,"left").each(function(t){var o=parseInt(t,10),i=Vs(r[0]);su(n,"left",o-e*i+"px")}),t.state.currentScreen.set(t.state.currentScreen.get()+e))})},i=function(n){var e=Ai(n.element(),"input");p.from(e[t.state.currentScreen.get()]).each(function(e){n.getSystem().getByDom(e).each(function(e){Gn(n,e.element())})});var r=a.get(n);Gi.highlightAt(r,t.state.currentScreen.get())},u=Zs(Xf(function(n){return{dom:cs('<div class="${prefix}-serialised-dialog"></div>'),components:[Tf.sketch({dom:cs('<div class="${prefix}-serialised-dialog-chain" style="left: 0px; position: absolute;"></div>'),components:D.map(t.fields,function(e,o){return o<=t.maxFieldIndex?Tf.sketch({dom:cs('<div class="${prefix}-serialised-dialog-screen"></div>'),components:D.flatten([[r(-1,"previous",o>0)],[n.field(e.name,e.spec)],[r(1,"next",o<t.maxFieldIndex)]])}):n.field(e.name,e.spec)})})],formBehaviours:Jt.derive([di(function(n,e){!function(n,e){Ii(n.element(),"."+gi.resolve("serialised-dialog-chain")).each(function(n){su(n,"left",-t.state.currentScreen.get()*e.width+"px")})}(n,e)}),nc.config({mode:"special",focusIn:function(n){i(n)},onTab:function(n){return o(n,1),p.some(!0)},onShiftTab:function(n){return o(n,-1),p.some(!0)}}),bf("form-events",[bt.runOnAttached(function(n,e){t.state.currentScreen.set(0),t.state.dialogSwipeState.clear();var r=a.get(n);Gi.highlightFirst(r),t.getInitialValue(n).each(function(e){Bs.setValue(n,e)})}),bt.runOnExecute(t.onExecute),bt.run(xn.transitionend(),function(n,e){"left"===e.event().raw().propertyName&&i(n)}),bt.run("navigateEvent",function(n,e){var t=e.event().direction();o(n,t)})])])}})),a=Zs({dom:cs('<div class="${prefix}-dot-container"></div>'),behaviours:Jt.derive([Gi.config({highlightClass:gi.resolve("dot-active"),itemClass:gi.resolve("dot-item")})]),components:D.bind(t.fields,function(n,e){return e<=t.maxFieldIndex?[ss('<div class="${prefix}-dot-item ${prefix}-icon-full-dot ${prefix}-icon"></div>')]:[]})});return{dom:cs('<div class="${prefix}-serializer-wrapper"></div>'),components:[u.asSpec(),a.asSpec()],behaviours:Jt.derive([nc.config({mode:"special",focusIn:function(n){var e=u.get(n);nc.focusIn(e)}}),bf("serializer-wrapper-events",[bt.run(xn.touchstart(),function(n,e){t.state.dialogSwipeState.set(Qf(e.event().raw().touches[0].clientX))}),bt.run(xn.touchmove(),function(n,e){t.state.dialogSwipeState.on(function(n){e.event().prevent(),t.state.dialogSwipeState.set(Zf(n,e.event().raw().touches[0].clientX))})}),bt.run(xn.touchend(),function(n){t.state.dialogSwipeState.on(function(e){var t=u.get(n),r=-1*nl(e);o(t,r)})})])])}},tl=un.detect(),rl=function(n,e){var t=e.selection.getRng();n(),e.selection.setRng(t)},ol=function(n,e){(tl.os.isAndroid()?rl:s.apply)(e,n)},il=N(function(n,e){return[{label:"the link group",items:[el({fields:[If("url","Type or paste URL"),If("text","Link text"),If("title","Link title"),If("target","Link target"),Ff("link")],maxFieldIndex:["url","text","title","target"].length-1,getInitialValue:function(){return p.some(vf.getInfo(e))},onExecute:function(t){var r=Bs.getValue(t);vf.applyInfo(e,r),n.restoreToolbar(),e.focus()}})]}]}),ul=function(n,e){return ds.forToolbarStateAction(e,"link","link",function(){var t=il(n,e);n.setContextToolbar(t),ol(e,function(){n.focusToolbar()}),vf.query(e).each(function(n){e.selection.select(n.dom())})})},al=[{title:"Headings",items:[{title:"Heading 1",format:"h1"},{title:"Heading 2",format:"h2"},{title:"Heading 3",format:"h3"},{title:"Heading 4",format:"h4"},{title:"Heading 5",format:"h5"},{title:"Heading 6",format:"h6"}]},{title:"Inline",items:[{title:"Bold",icon:"bold",format:"bold"},{title:"Italic",icon:"italic",format:"italic"},{title:"Underline",icon:"underline",format:"underline"},{title:"Strikethrough",icon:"strikethrough",format:"strikethrough"},{title:"Superscript",icon:"superscript",format:"superscript"},{title:"Subscript",icon:"subscript",format:"subscript"},{title:"Code",icon:"code",format:"code"}]},{title:"Blocks",items:[{title:"Paragraph",format:"p"},{title:"Blockquote",format:"blockquote"},{title:"Div",format:"div"},{title:"Pre",format:"pre"}]},{title:"Alignment",items:[{title:"Left",icon:"alignleft",format:"alignleft"},{title:"Center",icon:"aligncenter",format:"aligncenter"},{title:"Right",icon:"alignright",format:"alignright"},{title:"Justify",icon:"alignjustify",format:"alignjustify"}]}],cl=function(n,e,t,r){return ge(e.routes(),r.start()).map(s.apply).bind(function(n){return ge(n,r.destination()).map(s.apply)})},sl=function(n,e,t,r){return cl(0,e,0,r).bind(function(n){return n.transition().map(function(e){return{transition:s.constant(e),route:s.constant(n)}})})},fl=function(n,e,t){(function(n,e,t){return ll(n,e,t).bind(function(r){return sl(n,e,t,r)})})(n,e,t).each(function(t){var r=t.transition();Dr.remove(n.element(),r.transitionClass()),gr(n.element(),e.destinationAttr())})},ll=function(n,e,t){var r=n.element();return mr(r,e.destinationAttr())?p.some({start:s.constant(dr(n.element(),e.stateAttr())),destination:s.constant(dr(n.element(),e.destinationAttr()))}):p.none()},dl=function(n,e,t,r){fl(n,e,t),mr(n.element(),e.stateAttr())&&dr(n.element(),e.stateAttr())!==r&&e.onFinish()(n,r),fr(n.element(),e.stateAttr(),r)},ml={findRoute:cl,disableTransition:fl,getCurrentRoute:ll,jumpTo:dl,progressTo:function(n,e,t,r){!function(n,e,t,r){mr(n.element(),e.destinationAttr())&&(fr(n.element(),e.stateAttr(),dr(n.element(),e.destinationAttr())),gr(n.element(),e.destinationAttr()))}(n,e);var o=function(n,e,t,r){return{start:s.constant(dr(n.element(),e.stateAttr())),destination:s.constant(r)}}(n,e,0,r);sl(n,e,t,o).fold(function(){dl(n,e,t,r)},function(o){fl(n,e,t);var i=o.transition();Dr.add(n.element(),i.transitionClass()),fr(n.element(),e.destinationAttr(),r)})},getState:function(n,e,t){var r=n.element();return mr(r,e.stateAttr())?p.some(dr(r,e.stateAttr())):p.none()}},gl={events:function(n,e){return bt.derive([bt.run(xn.transitionend(),function(t,r){var o=r.event().raw();ml.getCurrentRoute(t,n,e).each(function(r){ml.findRoute(t,n,e,r).each(function(i){i.transition().each(function(i){o.propertyName===i.property()&&(ml.jumpTo(t,n,e,r.destination()),n.onTransition()(t,r))})})})}),bt.runOnAttached(function(t,r){ml.jumpTo(t,n,e,n.initialState())})])}},pl=[Xe("destinationAttr","data-transitioning-destination"),Xe("stateAttr","data-transitioning-state"),Pe("initialState"),Yo.onHandler("onTransition"),Yo.onHandler("onFinish"),We("routes",lt.setOf(Yn.value,lt.setOf(Yn.value,lt.objOfOnly([Ke("transition",[Pe("property"),Pe("transitionClass")])]))))],hl=Jt.create({fields:pl,name:"transitioning",active:gl,apis:ml,extra:{createRoutes:function(n){var e={};return Nn.each(n,function(n,t){var r=t.split("<->");e[r[0]]=pe(r[1],n),e[r[1]]=pe(r[0],n)}),e},createBistate:function(n,e,t){return he([{key:n,value:pe(e,t)},{key:e,value:pe(n,t)}])},createTristate:function(n,e,t,r){return he([{key:n,value:he([{key:e,value:r},{key:t,value:r}])},{key:e,value:he([{key:n,value:r},{key:t,value:r}])},{key:t,value:he([{key:n,value:r},{key:e,value:r}])}])}}}),vl=function(n,e){var t=D.map(e,function(n){return Qe(n.name(),n.name(),qn.asOption(),lt.objOf([Pe("config"),Xe("state",Kt)]))}),r=lt.asStruct("component.behaviours",lt.objOf(t),n.behaviours).fold(function(e){throw new Error(lt.formatError(e)+"\nComplete spec:\n"+we(n,null,2))},s.identity);return{list:e,data:Nn.map(r,function(n){var e=n();return s.constant(e.map(function(n){return{config:n.config(),state:n.state().init(n.config())}}))})}},yl=function(n){return n.list},bl=function(n){return n.data},wl=function(n,e){return vl(n,e)},Sl=function(n){var e=function(n){var e=ge(n,"behaviours").getOr({}),t=D.filter(Nn.keys(e),function(n){return e[n]!==undefined});return D.map(t,function(e){return n.behaviours[e].me})}(n);return wl(n,e)},xl=_t.exactly(["getSystem","config","hasConfigured","spec","connect","disconnect","element","syncComponents","readState","components","events"]),Tl=_t.exactly(["debugInfo","triggerFocus","triggerEvent","triggerEscape","addToWorld","removeFromWorld","addToGui","removeFromGui","build","getByUid","getByDom","broadcast","broadcastOn"]),Ol=function(n){var e=function(e){return function(){throw new Error("The component must be in a context to send: "+e+"\n"+lo(n().element())+" is not in context.")}};return Tl({debugInfo:s.constant("fake"),triggerEvent:e("triggerEvent"),triggerFocus:e("triggerFocus"),triggerEscape:e("triggerEscape"),build:e("build"),addToWorld:e("addToWorld"),removeFromWorld:e("removeFromWorld"),addToGui:e("addToGui"),removeFromGui:e("removeFromGui"),getByUid:e("getByUid"),getByDom:e("getByDom"),broadcast:e("broadcast"),broadcastOn:e("broadcastOn")})},kl=function(n,e){var t={};return Nn.each(n,function(n,r){Nn.each(n,function(n,o){var i=me(o,[])(t);t[o]=i.concat([e(r,n)])})}),t},Cl=function(n,e){return{name:s.constant(n),modification:e}},El=function(n,e,t){return n.length>1?Yn.error('Multiple behaviours have tried to change DOM "'+e+'". The guilty behaviours are: '+we(D.map(n,function(n){return n.name()}))+". At this stage, this is not supported. Future releases might provide strategies for resolving this."):0===n.length?Yn.value({}):Yn.value(n[0].modification().fold(function(){return{}},function(n){return pe(e,n)}))},Dl=function(n,e){return D.foldl(n,function(t,r){var o=r.modification().getOr({});return t.bind(function(t){var r=Nn.mapToArray(o,function(r,o){return t[o]!==undefined?function(n,e,t,r){return Yn.error("Mulitple behaviours have tried to change the _"+e+'_ "'+n+'". The guilty behaviours are: '+we(D.bind(r,function(n){return n.modification().getOr({})[e]!==undefined?[n.name()]:[]}),null,2)+". This is not currently supported.")}(e,o,0,n):Yn.value(pe(o,r))});return ye(r,t)})},Yn.value({})).map(function(n){return pe(e,n)})},Al={classes:function(n,e){var t=D.bind(n,function(n){return n.modification().getOr([])});return Yn.value(pe(e,t))},attributes:Dl,styles:Dl,domChildren:El,defChildren:El,innerHtml:El,value:El},Ml=function(n,e,t,r){var o=Mn.deepMerge({},e);D.each(t,function(e){o[e.name()]=e.exhibit(n,r)});var i=kl(o,Cl),u=Nn.map(i,function(n,e){return D.bind(n,function(n){return n.modification().fold(function(){return[]},function(e){return[n]})})}),a=Nn.mapToArray(u,function(n,e){return ge(Al,e).fold(function(){return Yn.error("Unknown field type: "+e)},function(t){return t(n,e)})});return ye(a,{}).map(Nt.nu)},Rl=function(n,e,t,r){var o=t.slice(0);try{var i=o.sort(function(t,o){var i=t[e](),u=o[e](),a=r.indexOf(i),c=r.indexOf(u);if(-1===a)throw new Error("The ordering for "+n+" does not have an entry for "+i+".\nOrder specified: "+we(r,null,2));if(-1===c)throw new Error("The ordering for "+n+" does not have an entry for "+u+".\nOrder specified: "+we(r,null,2));return a<c?-1:c<a?1:0});return Yn.value(i)}catch(u){return Yn.error([u])}},Bl=function(n,e){return{handler:n,purpose:s.constant(e)}},Il=function(n,e){return{handler:s.curry.apply(undefined,[n.handler].concat(e)),purpose:n.purpose}},Fl=function(n){return n.handler},Hl=function(n,e){return{name:s.constant(n),handler:s.constant(e)}},Nl=function(n,e,t){var r=Mn.deepMerge(t,function(n,e){var t={};return D.each(n,function(n){t[n.name()]=n.handlers(e)}),t}(e,n));return kl(r,Hl)},Vl=function(n,e,t){var r=e[t];return r?Rl("Event: "+t,"name",n,r).map(function(n){var e=D.map(n,function(n){return n.handler()});return gt(e)}):function(n,e){return new Yn.error(["The event ("+n+') has more than one behaviour that listens to it.\nWhen this occurs, you must specify an event ordering for the behaviours in your spec (e.g. [ "listing", "toggling" ]).\nThe behaviours that can trigger it are: '+we(D.map(e,function(n){return n.name()}),null,2)])}(t,n)},jl=function(n,e){var t=Nn.mapToArray(n,function(n,t){return(1===n.length?Yn.value(n[0].handler()):Vl(n,e,t)).map(function(r){var o=function(n){var e=mt(n);return function(n,t){var r=Array.prototype.slice.call(arguments,0);e.abort.apply(undefined,r)?t.stop():e.can.apply(undefined,r)&&e.run.apply(undefined,r)}}(r),i=n.length>1?D.filter(e,function(e){return D.contains(n,function(n){return n.name()===e})}).join(" > "):n[0].name();return pe(t,Bl(o,i))})});return ye(t,{})},Ll=function(n,e,t,r){var o=Nl(n,t,r);return jl(o,e)},Pl=function(n){return lt.asStruct("custom.definition",lt.objOfOnly([Qe("dom","dom",qn.strict(),lt.objOfOnly([Pe("tag"),Xe("styles",{}),Xe("classes",[]),Xe("attributes",{}),$e("value"),$e("innerHtml")])),Pe("components"),Pe("uid"),Xe("events",{}),Xe("apis",s.constant({})),Qe("eventOrder","eventOrder",qn.mergeWith({"alloy.execute":["disabling","alloy.base.behaviour","toggling"],"alloy.focus":["alloy.base.behaviour","focusing","keying"],"alloy.system.init":["alloy.base.behaviour","disabling","toggling","representing"],input:["alloy.base.behaviour","representing","streaming","invalidating"],"alloy.system.detached":["alloy.base.behaviour","representing"]}),lt.anyValue()),$e("domModification"),Yo.snapshot("originalSpec"),Xe("debug.sketcher","unknown")]),n)},Wl=function(n){var e={tag:n.dom().tag(),classes:n.dom().classes(),attributes:Mn.deepMerge(function(n){return pe(Wc.idAttr(),n.uid())}(n),n.dom().attributes()),styles:n.dom().styles(),domChildren:D.map(n.components(),function(n){return n.element()})};return Bt.nu(Mn.deepMerge(e,n.dom().innerHtml().map(function(n){return pe("innerHtml",n)}).getOr({}),n.dom().value().map(function(n){return pe("value",n)}).getOr({})))},Ul=function(n){return n.domModification().fold(function(){return Nt.nu({})},Nt.nu)},zl=function(n){return n.events()},Gl=function(n,e){D.each(e,function(e){Dr.add(n,e)})},$l=function(n,e){D.each(e,function(e){Dr.remove(n,e)})},_l=function(n){var e=cn.fromTag(n.tag());lr(e,n.attributes().getOr({})),Gl(e,n.classes().getOr([])),fu(e,n.styles().getOr({})),uo(e,n.innerHtml().getOr(""));var t=function(n){if(n.domChildren().isSome()&&n.defChildren().isSome())throw new Error("Cannot specify children and child specs! Must be one or the other.\nDef: "+Bt.defToStr(n));return n.domChildren().fold(function(){var e=n.defChildren().getOr([]);return D.map(e,ql)},function(n){return n})}(n);return _r(e,t),n.value().each(function(n){kf(e,n)}),e},ql=function(n){var e=Bt.nu(n);return _l(e)},Kl=_l,Xl=function(n){var e=function(){return h},t=Oo(Ol(e)),r=lt.getOrDie(Pl(Mn.deepMerge(n,{behaviours:undefined}))),o=Sl(n),i=yl(o),u=bl(o),a=Wl(r),c={"alloy.base.modification":Ul(r)},f=Ml(u,c,i,a).getOrDie(),l=Nt.merge(a,f),d=Kl(l),m={"alloy.base.behaviour":zl(r)},g=Ll(u,r.eventOrder(),i,m).getOrDie(),p=Oo(r.components()),h=xl({getSystem:t.get,config:function(e){if(e===ac.apiConfig())return r.apis();var t=u;return(Cn.isFunction(t[e.name()])?t[e.name()]:function(){throw new Error("Could not find "+e.name()+" in "+we(n,null,2))})()},hasConfigured:function(n){return Cn.isFunction(u[n.name()])},spec:s.constant(n),readState:function(n){return u[n]().map(function(n){return n.state.readState()}).getOr("not enabled")},connect:function(n){t.set(n)},disconnect:function(){t.set(Ol(e))},element:s.constant(d),syncComponents:function(){var n=Wr.children(d),e=D.bind(n,function(n){return t.get().getByDom(n).fold(function(){return[]},function(n){return[n]})});p.set(e)},components:p.get,events:s.constant(g)});return h},Yl={events:bt.derive([bt.can(On.focus(),function(n,e){var t=e.event().originator(),r=e.event().target();return!function(n,e,t){return wn(e,n.element())&&!wn(e,t)}(n,t,r)||(console.warn(On.focus()+" did not get interpreted by the desired target. \nOriginator: "+lo(t)+"\nTarget: "+lo(r)+"\nCheck the "+On.focus()+" event handlers"),!1)})])},Jl=function(n){return n},Ql=function(n){var e=Jl(n),t=function(n){var e=me("components",[])(n);return D.map(e,nd)}(e),r=Mn.deepMerge(Yl,e,pe("components",t));return Yn.value(Xl(r))},Zl=function(n){var e=lt.asStructOrDie("external.component",lt.objOfOnly([Pe("element"),$e("uid")]),n),t=Oo(Ol());e.uid().each(function(n){$c(e.element(),n)});var r=xl({getSystem:t.get,config:p.none,hasConfigured:s.constant(!1),connect:function(n){t.set(n)},disconnect:function(){t.set(Ol(function(){return r}))},element:s.constant(e.element()),spec:s.constant(n),readState:s.constant("No state"),syncComponents:s.noop,components:s.constant([]),events:s.constant({})});return ac.premade(r)},nd=function(n){return ac.getPremade(n).fold(function(){var e=Mn.deepMerge({uid:qc("")},n);return Ql(e).getOrDie()},function(n){return n})},ed={build:nd,premade:ac.premade,external:Zl,text:function(n){var e=cn.fromText(n);return Zl({element:e})}},td={hover:s.constant("alloy.item-hover"),focus:s.constant("alloy.item-focus"),onHover:function(n){(No(n.element()).isNone()||wi.isFocused(n))&&(wi.isFocused(n)||wi.focus(n),Pn(n,"alloy.item-hover",{item:n}))},onFocus:function(n){Pn(n,"alloy.item-focus",{item:n})}},rd=[Pe("data"),Pe("components"),Pe("dom"),$e("toggling"),Xe("itemBehaviours",{}),Xe("ignoreFocus",!1),Xe("domModification",{}),Yo.output("builder",function(n){return{dom:Mn.deepMerge(n.dom(),{attributes:{role:n.toggling().isSome()?"menuitemcheckbox":"menuitem"}}),behaviours:Mn.deepMerge(Jt.derive([n.toggling().fold(fi.revoke,function(n){return fi.config(Mn.deepMerge({aria:{mode:"checked"}},n))}),wi.config({ignore:n.ignoreFocus(),onFocus:function(n){td.onFocus(n)}}),nc.config({mode:"execution"}),Bs.config({store:{mode:"memory",initialValue:n.data()}})]),n.itemBehaviours()),events:bt.derive([bt.runWithTarget(On.tapOrClick(),Wn),bt.cutter(xn.mousedown()),bt.run(xn.mouseover(),td.onHover),bt.run(On.focusItem(),wi.focus)]),components:n.components(),domModification:n.domModification()}})],od=[Pe("dom"),Pe("components"),Yo.output("builder",function(n){return{dom:n.dom(),components:n.components(),events:bt.derive([bt.stopper(On.focusItem())])}})],id=[wc.required({name:"widget",overrides:function(n){return{behaviours:Jt.derive([Bs.config({store:{mode:"manual",getValue:function(e){return n.data()},setValue:function(){}}})])}}})],ud={owner:s.constant("item-widget"),parts:s.constant(id)},ad=[Pe("uid"),Pe("data"),Pe("components"),Pe("dom"),Xe("autofocus",!1),Xe("domModification",{}),Vc(ud.parts()),Yo.output("builder",function(n){var e=Hc(ud.owner(),n,ud.parts()),t=Nc(ud.owner(),n,e.internals()),r=function(e){return Lc(e,n,"widget").map(function(n){return nc.focusIn(n),n})},o=function(e,t){return Su(t.event().target())?p.none():n.autofocus()?(t.setSource(e.element()),p.none()):p.none()};return Mn.deepMerge({dom:n.dom(),components:t,domModification:n.domModification(),events:bt.derive([bt.runOnExecute(function(n,e){r(n).each(function(n){e.stop()})}),bt.run(xn.mouseover(),td.onHover),bt.run(On.focusItem(),function(e,t){n.autofocus()?r(e):wi.focus(e)})]),behaviours:Jt.derive([Bs.config({store:{mode:"memory",initialValue:n.data()}}),wi.config({onFocus:function(n){td.onFocus(n)}}),nc.config({mode:"special",onLeft:o,onRight:o,onEscape:function(e,t){return wi.isFocused(e)||n.autofocus()?n.autofocus()?(t.setSource(e.element()),p.none()):p.none():(wi.focus(e),p.some(!0))}})])})})],cd=lt.choose("type",{widget:ad,item:rd,separator:od}),sd=[wc.group({factory:{sketch:function(n){var e=lt.asStructOrDie("menu.spec item",cd,n);return e.builder()(e)}},name:"items",unit:"item",defaults:function(n,e){var t=qc("");return Mn.deepMerge({uid:t},e)},overrides:function(n,e){return{type:e.type,ignoreFocus:n.fakeFocus(),domModification:{classes:[n.markers().item()]}}}})],fd=[Pe("value"),Pe("items"),Pe("dom"),Pe("components"),Xe("eventOrder",{}),ec("menuBehaviours",[Gi,Bs,xf,nc]),Ye("movement",{mode:"menu",moveOnTab:!0},lt.choose("mode",{grid:[Yo.initSize(),Yo.output("config",function(n,e){return{mode:"flatgrid",selector:"."+n.markers().item(),initSize:{numColumns:e.initSize().numColumns(),numRows:e.initSize().numRows()},focusManager:n.focusManager()}})],menu:[Xe("moveOnTab",!0),Yo.output("config",function(n,e){return{mode:"menu",selector:"."+n.markers().item(),moveOnTab:e.moveOnTab(),focusManager:n.focusManager()}})]})),Yo.itemMarkers(),Xe("fakeFocus",!1),Xe("focusManager",$i()),Yo.onHandler("onHighlight")],ld={name:s.constant("Menu"),schema:s.constant(fd),parts:s.constant(sd)},dd={focus:s.constant("alloy.menu-focus")},md=function(n,e,t,r){return Mn.deepMerge({dom:Mn.deepMerge(n.dom(),{attributes:{role:"menu"}}),uid:n.uid(),behaviours:Mn.deepMerge(Jt.derive([Gi.config({highlightClass:n.markers().selectedItem(),itemClass:n.markers().item(),onHighlight:n.onHighlight()}),Bs.config({store:{mode:"memory",initialValue:n.value()}}),xf.config({find:s.identity}),nc.config(n.movement().config()(n,n.movement()))]),tc(n.menuBehaviours())),events:bt.derive([bt.run(td.focus(),function(n,e){var t=e.event();n.getSystem().getByDom(t.target()).each(function(t){Gi.highlight(n,t),e.stop(),Pn(n,dd.focus(),{menu:n,item:t})})}),bt.run(td.hover(),function(n,e){var t=e.event().item();Gi.highlight(n,t)})]),components:e,eventOrder:n.eventOrder()})},gd=ts({name:"Menu",configFields:ld.schema(),partFields:ld.parts(),factory:md}),pd=function(n,e){var t=Wr.owner(e),r=Ho(t).bind(function(n){var t=function(e){return wn(n,e)};return t(e)?p.some(e):Ao.descendant(e,t)}),o=n(e);return r.each(function(n){Ho(t).filter(function(e){return wn(e,n)}).orThunk(function(){Io(n)})}),o},hd=function(n,e,t,r){var o=n.getSystem().build(r);to.attachWith(n,o,t)},vd=function(n,e){return n.components()},yd={append:function(n,e,t,r){hd(n,0,Gr.append,r)},prepend:function(n,e,t,r){hd(n,0,Gr.prepend,r)},remove:function(n,e,t,r){var o=vd(n,e);D.find(o,function(n){return wn(r.element(),n.element())}).each(to.detach)},set:function(n,e,t,r){to.detachChildren(n),pd(function(){var e=D.map(r,n.getSystem().build);D.each(e,function(e){to.attach(n,e)})},n.element())},contents:vd},bd=Jt.create({fields:[],name:"replacing",apis:yd}),wd=function(n,e,t,r){return ge(t,r).bind(function(r){return ge(n,r).bind(function(r){var o=wd(n,e,t,r);return p.some([r].concat(o))})}).getOr([])},Sd=function(n,e){var t={};Nn.each(n,function(n,e){D.each(n,function(n){t[n]=e})});var r=e,o=function(n){return Nn.tupleMap(n,function(n,e){return{k:n,v:e}})}(e),i=Nn.map(o,function(n,e){return[e].concat(wd(t,r,o,e))});return Nn.map(t,function(n){return ge(i,n).getOr([n])})},xd={make:function(n,e){var t=function(){var n=Oo({}),e=Oo({}),t=Oo({}),r=Oo(p.none()),o=Oo(s.constant([])),i=function(n){return ge(e.get(),n)};return{setContents:function(i,u,a,c){r.set(p.some(i)),n.set(a),e.set(u),o.set(c);var s=c(u),f=Sd(s,a);t.set(f)},expand:function(e){return ge(n.get(),e).map(function(n){var r=ge(t.get(),e).getOr([]);return[n].concat(r)})},refresh:function(n){return ge(t.get(),n)},collapse:function(n){return ge(t.get(),n).bind(function(n){return n.length>1?p.some(n.slice(1)):p.none()})},lookupMenu:i,otherMenus:function(n){var t=o.get()(e.get());return D.difference(Nn.keys(t),n)},getPrimary:function(){return r.get().bind(i)},getMenus:function(){return e.get()},clear:function(){n.set({}),e.set({}),t.set({}),r.set(p.none())},isClear:function(){return r.get().isNone()}}}(),r=function(r){var o=function(t,r){return Nn.map(r,function(r,o){var i=gd.sketch(Mn.deepMerge(r,{value:o,items:r.items,markers:fe(e.markers,["item","selectedItem"]),fakeFocus:n.fakeFocus(),onHighlight:n.onHighlight(),focusManager:n.fakeFocus()?_i():$i()}));return t.getSystem().build(i)})}(r,n.data().menus());return t.setContents(n.data().primary(),o,n.data().expansions(),function(n){return i(r,n)}),t.getPrimary()},o=function(n){return Bs.getValue(n).value},i=function(e,t){return Nn.map(n.data().menus(),function(n,e){return D.bind(n.items,function(n){return"separator"===n.type?[]:[n.data.value]})})},u=function(n,e){Gi.highlight(n,e),Gi.getHighlighted(e).orThunk(function(){return Gi.getFirst(e)}).each(function(e){Un(n,e.element(),On.focusItem())})},a=function(n,e){return mo(D.map(e,n.lookupMenu))},c=function(e,t,r){return p.from(r[0]).bind(t.lookupMenu).map(function(o){var i=a(t,r.slice(1));D.each(i,function(e){Dr.add(e.element(),n.markers().backgroundMenu())}),Jr.inBody(o.element())||bd.append(e,ed.premade(o)),$l(o.element(),[n.markers().backgroundMenu()]),u(e,o);var c=a(t,t.otherMenus(r));return D.each(c,function(t){$l(t.element(),[n.markers().backgroundMenu()]),n.stayInDom()||bd.remove(e,t)}),o})},f=function(e,r){var i=o(r);return t.expand(i).bind(function(o){return p.from(o[0]).bind(t.lookupMenu).each(function(t){Jr.inBody(t.element())||bd.append(e,ed.premade(t)),n.onOpenSubmenu()(e,r,t),Gi.highlightFirst(t)}),c(e,t,o)})},l=function(e,r){var i=o(r);return t.collapse(i).bind(function(o){return c(e,t,o).map(function(t){return n.onCollapseMenu()(e,r,t),t})})},d=function(e){return function(t,r){return Fi(r.getSource(),"."+n.markers().item()).bind(function(n){return t.getSystem().getByDom(n).bind(function(n){return e(t,n)})})}},m=bt.derive([bt.run(dd.focus(),function(n,e){var t=e.event().menu();Gi.highlight(n,t)}),bt.runOnExecute(function(e,t){var r=t.event().target();return e.getSystem().getByDom(r).bind(function(t){return 0===o(t).indexOf("collapse-item")?l(e,t):f(e,t).orThunk(function(){return n.onExecute()(e,t)})})}),bt.runOnAttached(function(e,t){r(e).each(function(t){bd.append(e,ed.premade(t)),n.openImmediately()&&(u(e,t),n.onOpenMenu()(e,t))})})].concat(n.navigateOnHover()?[bt.run(td.hover(),function(e,r){var i=r.event().item();!function(n,e){var r=o(e);t.refresh(r).bind(function(e){return c(n,t,e)})}(e,i),f(e,i),n.onHover()(e,i)})]:[]));return{uid:n.uid(),dom:n.dom(),behaviours:Mn.deepMerge(Jt.derive([nc.config({mode:"special",onRight:d(function(n,e){return Su(e.element())?p.none():f(n,e)}),onLeft:d(function(n,e){return Su(e.element())?p.none():l(n,e)}),onEscape:d(function(e,t){return l(e,t).orThunk(function(){return n.onEscape()(e,t)})}),focusIn:function(n,e){t.getPrimary().each(function(e){Un(n,e.element(),On.focusItem())})}}),Gi.config({highlightClass:n.markers().selectedMenu(),itemClass:n.markers().menu()}),xf.config({find:function(n){return Gi.getHighlighted(n)}}),bd.config({})]),tc(n.tmenuBehaviours())),eventOrder:n.eventOrder(),apis:{collapseMenu:function(n){Gi.getHighlighted(n).each(function(e){Gi.getHighlighted(e).each(function(e){l(n,e)})})}},events:m}},collapseItem:s.constant("collapse-item")},Td=es({name:"TieredMenu",configFields:[Yo.onStrictKeyboardHandler("onExecute"),Yo.onStrictKeyboardHandler("onEscape"),Yo.onStrictHandler("onOpenMenu"),Yo.onStrictHandler("onOpenSubmenu"),Yo.onHandler("onCollapseMenu"),Xe("openImmediately",!0),Ue("data",[Pe("primary"),Pe("menus"),Pe("expansions")]),Xe("fakeFocus",!1),Yo.onHandler("onHighlight"),Yo.onHandler("onHover"),Yo.tieredMenuMarkers(),Pe("dom"),Xe("navigateOnHover",!0),Xe("stayInDom",!1),ec("tmenuBehaviours",[nc,Gi,xf,bd]),Xe("eventOrder",{})],apis:{collapseMenu:function(n,e){n.collapseMenu(e)}},factory:xd.make,extraApis:{tieredData:function(n,e,t){return{primary:n,menus:e,expansions:t}},singleData:function(n,e){return{primary:n,menus:pe(n,e),expansions:{}}},collapseItem:function(n){return{value:oc(xd.collapseItem()),text:n}}}}),Od=gi.resolve("scrollable"),kd={register:function(n){Dr.add(n,Od)},deregister:function(n){Dr.remove(n,Od)},scrollable:s.constant(Od)},Cd=function(n){return ge(n,"format").getOr(n.title)},Ed=function(n,e,t,r,o){return{data:{value:n,text:e},type:"item",dom:{tag:"div",classes:o?[gi.resolve("styles-item-is-menu")]:[]},toggling:{toggleOnExecute:!1,toggleClass:gi.resolve("format-matches"),selected:t},itemBehaviours:Jt.derive(o?[]:[li(n,function(n,e){(e?fi.on:fi.off)(n)})]),components:[{dom:{tag:"div",attributes:{style:r},innerHtml:e}}]}},Dd=function(n,e,t,r){return{value:n,dom:{tag:"div"},components:[os.sketch({dom:{tag:"div",classes:[gi.resolve("styles-collapser")]},components:r?[{dom:{tag:"span",classes:[gi.resolve("styles-collapse-icon")]}},ed.text(n)]:[ed.text(n)],action:function(n){if(r){var e=t().get(n);Td.collapseMenu(e)}}}),{dom:{tag:"div",classes:[gi.resolve("styles-menu-items-container")]},components:[gd.parts().items({})],behaviours:Jt.derive([bf("adhoc-scrollable-menu",[bt.runOnAttached(function(n,e){su(n.element(),"overflow-y","auto"),su(n.element(),"-webkit-overflow-scrolling","touch"),kd.register(n.element())}),bt.runOnDetached(function(n){lu(n.element(),"overflow-y"),lu(n.element(),"-webkit-overflow-scrolling"),kd.deregister(n.element())})])])}],items:e,menuBehaviours:Jt.derive([hl.config({initialState:"after",routes:hl.createTristate("before","current","after",{transition:{property:"transform",transitionClass:"transitioning"}})})])}},Ad=function(n){var e=function(n,e){var t=Dd("Styles",[].concat(D.map(n.items,function(e){return Ed(Cd(e),e.title,e.isSelected(),e.getPreview(),ve(n.expansions,Cd(e)))})),e,!1),r=Nn.map(n.menus,function(t,r){var o=D.map(t,function(e){return Ed(Cd(e),e.title,e.isSelected!==undefined&&e.isSelected(),e.getPreview!==undefined?e.getPreview():"",ve(n.expansions,Cd(e)))});return Dd(r,o,e,!0)}),o=Mn.deepMerge(r,pe("styles",t));return{tmenu:Td.tieredData("styles",o,n.expansions)}}(n.formats,function(){return t}),t=Zs(Td.sketch({dom:{tag:"div",classes:[gi.resolve("styles-menu")]},components:[],fakeFocus:!0,stayInDom:!0,onExecute:function(e,t){var r=Bs.getValue(t);n.handle(t,r.value)},onEscape:function(){},onOpenMenu:function(n,e){var t=Vs(n.element());Ns(e.element(),t),hl.jumpTo(e,"current")},onOpenSubmenu:function(n,e,t){var r=Vs(n.element()),o=Bi(e.element(),'[role="menu"]').getOrDie("hacky"),i=n.getSystem().getByDom(o).getOrDie();Ns(t.element(),r),hl.progressTo(i,"before"),hl.jumpTo(t,"after"),hl.progressTo(t,"current")},onCollapseMenu:function(n,e,t){var r=Bi(e.element(),'[role="menu"]').getOrDie("hacky"),o=n.getSystem().getByDom(r).getOrDie();hl.progressTo(o,"after"),hl.progressTo(t,"current")},navigateOnHover:!1,openImmediately:!0,data:e.tmenu,markers:{backgroundMenu:gi.resolve("styles-background-menu"),menu:gi.resolve("styles-menu"),selectedMenu:gi.resolve("styles-selected-menu"),item:gi.resolve("styles-item"),selectedItem:gi.resolve("styles-selected-item")}}));return t.asSpec()},Md=function(n){return ve(n,"items")?function(n){var e=Mn.deepMerge(le(n,["items"]),{menu:!0}),t=Rd(n.items);return{item:e,menus:Mn.deepMerge(t.menus,pe(n.title,t.items)),expansions:Mn.deepMerge(t.expansions,pe(n.title,n.title))}}(n):{item:n,menus:{},expansions:{}}},Rd=function(n){return D.foldr(n,function(n,e){var t=Md(e);return{menus:Mn.deepMerge(n.menus,t.menus),items:[t.item].concat(n.items),expansions:Mn.deepMerge(n.expansions,t.expansions)}},{menus:{},expansions:{},items:[]})},Bd={expand:Rd},Id=function(n,e){var t=function(e){return function(){return n.formatter.match(e)}},r=function(e){return function(){return n.formatter.getCssText(e)}},o=ge(e,"style_formats").getOr(al),i=function(e){return D.map(e,function(e){if(ve(e,"items")){var o=i(e.items);return Mn.deepMerge(function(n){return Mn.deepMerge(n,{isSelected:s.constant(!1),getPreview:s.constant("")})}(e),{items:o})}return ve(e,"format")?function(n){return Mn.deepMerge(n,{isSelected:t(n.format),getPreview:r(n.format)})}(e):function(e){var o=oc(e.title),i=Mn.deepMerge(e,{format:o,isSelected:t(o),getPreview:r(o)});return n.formatter.register(o,i),i}(e)})};return i(o)},Fd=function(n,e,t){var r=function(n,e){var t=function(e){return D.bind(e,function(e){return e.items!==undefined?t(e.items).length>0?[e]:[]:!ve(e,"format")||n.formatter.canApply(e.format)?[e]:[]})},r=t(e);return Bd.expand(r)}(n,e);return Ad({formats:r,handle:function(e,r){n.undoManager.transact(function(){fi.isOn(e)?n.formatter.remove(r):n.formatter.apply(r)}),t()}})},Hd=["undo","bold","italic","link","image","bullist","styleselect"],Nd=function(n){var e=n.replace(/\|/g," ").trim();return e.length>0?e.split(/\s+/):[]},Vd=function(n){return D.bind(n,function(n){return Cn.isArray(n)?Vd(n):Nd(n)})},jd=function(n){var e=n.toolbar!==undefined?n.toolbar:Hd;return Cn.isArray(e)?Vd(e):Nd(e)},Ld=function(n,e){var t=function(n){return function(){return ds.forToolbarCommand(e,n)}},r=function(n){return function(){return ds.forToolbarStateCommand(e,n)}},o=function(n,t,r){return function(){return ds.forToolbarStateAction(e,n,t,r)}},i=t("undo"),u=t("redo"),a=r("bold"),c=r("italic"),s=r("underline"),f=t("removeformat"),l=o("unlink","link",function(){e.execCommand("unlink",null,!1)}),d=o("unordered-list","ul",function(){e.execCommand("InsertUnorderedList",null,!1)}),m=o("ordered-list","ol",function(){e.execCommand("InsertOrderedList",null,!1)}),g=Id(e,e.settings),h=function(){return Fd(e,g,function(){e.fire("scrollIntoView")})},v=function(n,t){return{isSupported:function(){return n.forall(function(n){return ve(e.buttons,n)})},sketch:t}};return{undo:v(p.none(),i),redo:v(p.none(),u),bold:v(p.none(),a),italic:v(p.none(),c),underline:v(p.none(),s),removeformat:v(p.none(),f),link:v(p.none(),function(){return ul(n,e)}),unlink:v(p.none(),l),image:v(p.none(),function(){return ff(e)}),bullist:v(p.some("bullist"),d),numlist:v(p.some("numlist"),m),fontsizeselect:v(p.none(),function(){return Qs(n,e)}),forecolor:v(p.none(),function(){return Us(n,e)}),styleselect:v(p.none(),function(){return ds.forToolbar("style-formats",function(t){e.fire("toReading"),n.dropup().appear(h,fi.on,t)},Jt.derive([fi.config({toggleClass:gi.resolve("toolbar-button-selected"),toggleOnExecute:!1,aria:{mode:"pressed"}}),Qo.config({channels:he([mi(Wo.orientationChanged(),fi.off),mi(Wo.dropupDismissed(),fi.off)])})]))})}},Pd=function(n,e){var t=jd(n),r={};return D.bind(t,function(n){var t=!ve(r,n)&&ve(e,n)&&e[n].isSupported()?[e[n].sketch()]:[];return r[n]=!0,t})},Wd=function(n,e){return function(t){if(n(t)){var r=cn.fromDom(t.target),o=function(){t.stopPropagation()},i=function(){t.preventDefault()},u=s.compose(i,o),a=function(n,e,t,r,o,i,u){return{target:s.constant(n),x:s.constant(e),y:s.constant(t),stop:r,prevent:o,kill:i,raw:s.constant(u)}}(r,t.clientX,t.clientY,o,i,u,t);e(a)}}},Ud=function(n,e,t,r,o){var i=Wd(t,r);return n.dom().addEventListener(e,i,o),{unbind:s.curry(zd,n,e,i,o)}},zd=function(n,e,t,r){n.dom().removeEventListener(e,t,r)},Gd=function(n,e,t,r){return Ud(n,e,t,r,!1)},$d=function(n,e,t,r){return Ud(n,e,t,r,!0)},_d=s.constant(!0),qd=function(n,e,t){return Gd(n,e,_d,t)},Kd=function(n,e,t){return $d(n,e,_d,t)},Xd=function(n){var e=n.matchMedia("(orientation: portrait)").matches;return{isPortrait:s.constant(e)}},Yd=Xd,Jd=function(n,e){var t=cn.fromDom(n),r=null,o=qd(t,"orientationchange",function(){clearInterval(r);var t=Xd(n);e.onChange(t),i(function(){e.onReady(t)})}),i=function(e){clearInterval(r);var t=n.innerHeight,o=0;r=setInterval(function(){t!==n.innerHeight?(clearInterval(r),e(p.some(n.innerHeight))):o>20&&(clearInterval(r),e(p.none())),o++},50)};return{onAdjustment:i,destroy:function(){o.unbind()}}},Qd=function(n){var e=un.detect().os.isiOS(),t=Xd(n).isPortrait();return e&&!t?n.screen.height:n.screen.width},Zd=function(n){return n.raw().touches===undefined||1!==n.raw().touches.length?p.none():p.some(n.raw().touches[0])},nm=function(n){var e=Oo(p.none()),t=function(n,e){var t=null;return{cancel:function(){null!==t&&(clearTimeout(t),t=null)},schedule:function(){var r=arguments;t=setTimeout(function(){n.apply(null,r),t=null},e)}}}(function(t){e.set(p.none()),n.triggerEvent(On.longpress(),t)},400),r=he([{key:xn.touchstart(),value:function(n){return Zd(n).each(function(r){t.cancel();var o={x:s.constant(r.clientX),y:s.constant(r.clientY),target:n.target};t.schedule(o),e.set(p.some(o))}),p.none()}},{key:xn.touchmove(),value:function(n){return t.cancel(),Zd(n).each(function(n){e.get().each(function(t){(function(n,e){var t=Math.abs(n.clientX-e.x()),r=Math.abs(n.clientY-e.y());return t>5||r>5})(n,t)&&e.set(p.none())})}),p.none()}},{key:xn.touchend(),value:function(r){return t.cancel(),e.get().filter(function(n){return wn(n.target(),r.target())}).map(function(e){return n.triggerEvent(On.tap(),r)})}}]);return{fireIfReady:function(n,e){return ge(r,e).bind(function(e){return e(n)})}}},em=function(n){var e=nm({triggerEvent:function(e,t){n.onTapContent(t)}});return{fireTouchstart:function(n){e.fireIfReady(n,"touchstart")},onTouchend:function(){return qd(n.body(),"touchend",function(n){e.fireIfReady(n,"touchend")})},onTouchmove:function(){return qd(n.body(),"touchmove",function(n){e.fireIfReady(n,"touchmove")})}}},tm=un.detect().os.version.major>=6,rm=function(n,e,t){var r=em(n),o=Wr.owner(e),i=function(n){return!wn(n.start(),n.finish())||n.soffset()!==n.foffset()},u=function(){var r=n.doc().dom().hasFocus()&&n.getSelection().exists(i);t.getByDom(e).each(!0===(r||Ho(o).filter(function(n){return"input"===ir.name(n)}).exists(function(n){return n.dom().selectionStart!==n.dom().selectionEnd}))?fi.on:fi.off)},a=[qd(n.body(),"touchstart",function(e){n.onTouchContent(),r.fireTouchstart(e)}),r.onTouchmove(),r.onTouchend(),qd(e,"touchstart",function(e){n.onTouchToolstrip()}),n.onToReading(function(){Fo(n.body())}),n.onToEditing(s.noop),n.onScrollToCursor(function(e){e.preventDefault(),n.getCursorBox().each(function(e){var t=n.win(),r=e.top()>t.innerHeight||e.bottom()>t.innerHeight?e.bottom()-t.innerHeight+50:0;0!==r&&t.scrollTo(t.pageXOffset,t.pageYOffset+r)})})].concat(!0===tm?[]:[qd(cn.fromDom(n.win()),"blur",function(){t.getByDom(e).each(fi.off)}),qd(o,"select",u),qd(n.doc(),"selectionchange",u)]);return{destroy:function(){D.each(a,function(n){n.unbind()})}}},om=function(n){n.focus();var e=cn.fromDom(n.document.body);(Ho().exists(function(n){return D.contains(["input","textarea"],ir.name(n))})?function(n){setTimeout(function(){n()},0)}:s.apply)(function(){Ho().each(Fo),Io(e)})},im=function(n,e){var t=parseInt(dr(n,e),10);return isNaN(t)?0:t},um=function(n,e){var t=function(e){return n(e)?p.from(e.dom().nodeValue):p.none()},r=un.detect().browser,o=r.isIE()&&10===r.version.major?function(n){try{return t(n)}catch(e){return p.none()}}:t;return{get:function(t){if(!n(t))throw new Error("Can only get "+e+" value of a "+e+" node");return o(t).getOr("")},getOption:o,set:function(t,r){if(!n(t))throw new Error("Can only set raw "+e+" value of a "+e+" node");t.dom().nodeValue=r}}}(ir.isText,"text"),am=function(n){return um.get(n)},cm=function(n){return um.getOption(n)},sm=function(n){return"img"===ir.name(n)?1:cm(n).fold(function(){return Wr.children(n).length},function(n){return n.length})},fm=["img","br"],lm=sm,dm=function(n){return function(n){return cm(n).filter(function(n){return 0!==n.trim().length||n.indexOf("\xa0")>-1}).isSome()}(n)||D.contains(fm,ir.name(n))},mm=$n([{before:["element"]},{on:["element","offset"]},{after:["element"]}]),gm={before:mm.before,on:mm.on,after:mm.after,cata:function(n,e,t,r){return n.fold(e,t,r)},getStart:function(n){return n.fold(s.identity,s.identity,s.identity)}},pm=$n([{domRange:["rng"]},{relative:["startSitu","finishSitu"]},{exact:["start","soffset","finish","foffset"]}]),hm=At("start","soffset","finish","foffset"),vm={domRange:pm.domRange,relative:pm.relative,exact:pm.exact,exactFromRange:function(n){return pm.exact(n.start(),n.soffset(),n.finish(),n.foffset())},range:hm,getWin:function(n){var e=function(n){return n.match({domRange:function(n){return cn.fromDom(n.startContainer)},relative:function(n,e){return gm.getStart(n)},exact:function(n,e,t,r){return n}})}(n);return Wr.defaultView(e)}},ym=function(n,e,t,r){var o=Wr.owner(n).dom().createRange();return o.setStart(n.dom(),e),o.setEnd(t.dom(),r),o},bm=function(n,e,t,r){var o=ym(n,e,t,r),i=wn(n,t)&&e===r;return o.collapsed&&!i},wm=function(n,e){n.selectNodeContents(e.dom())},Sm=function(n){n.deleteContents()},xm=function(n){return{left:s.constant(n.left),top:s.constant(n.top),right:s.constant(n.right),bottom:s.constant(n.bottom),width:s.constant(n.width),height:s.constant(n.height)}},Tm={create:function(n){return n.document.createRange()},replaceWith:function(n,e){Sm(n),n.insertNode(e.dom())},selectNodeContents:function(n,e){var t=n.document.createRange();return wm(t,e),t},selectNodeContentsUsing:wm,relativeToNative:function(n,e,t){var r=n.document.createRange();return function(n,e){e.fold(function(e){n.setStartBefore(e.dom())},function(e,t){n.setStart(e.dom(),t)},function(e){n.setStartAfter(e.dom())})}(r,e),function(n,e){e.fold(function(e){n.setEndBefore(e.dom())},function(e,t){n.setEnd(e.dom(),t)},function(e){n.setEndAfter(e.dom())})}(r,t),r},exactToNative:function(n,e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},deleteContents:Sm,cloneFragment:function(n){var e=n.cloneContents();return cn.fromDom(e)},getFirstRect:function(n){var e=n.getClientRects(),t=e.length>0?e[0]:n.getBoundingClientRect();return t.width>0||t.height>0?p.some(t).map(xm):p.none()},getBounds:function(n){var e=n.getBoundingClientRect();return e.width>0||e.height>0?p.some(e).map(xm):p.none()},isWithin:function(n,e){return e.compareBoundaryPoints(n.END_TO_START,n)<1&&e.compareBoundaryPoints(n.START_TO_END,n)>-1},toString:function(n){return n.toString()}},Om=$n([{ltr:["start","soffset","finish","foffset"]},{rtl:["start","soffset","finish","foffset"]}]),km=function(n,e,t){return e(cn.fromDom(t.startContainer),t.startOffset,cn.fromDom(t.endContainer),t.endOffset)},Cm=function(n,e){return function(n,e){var t=e.ltr();if(t.collapsed)return e.rtl().filter(function(n){return!1===n.collapsed}).map(function(n){return Om.rtl(cn.fromDom(n.endContainer),n.endOffset,cn.fromDom(n.startContainer),n.startOffset)}).getOrThunk(function(){return km(0,Om.ltr,t)});return km(0,Om.ltr,t)}(0,function(n,e){return e.match({domRange:function(n){return{ltr:s.constant(n),rtl:p.none}},relative:function(e,t){return{ltr:N(function(){return Tm.relativeToNative(n,e,t)}),rtl:N(function(){return p.some(Tm.relativeToNative(n,t,e))})}},exact:function(e,t,r,o){return{ltr:N(function(){return Tm.exactToNative(n,e,t,r,o)}),rtl:N(function(){return p.some(Tm.exactToNative(n,r,o,e,t))})}}})}(n,e))},Em=(Om.ltr,Om.rtl,Cm),Dm=function(n,e){return Cm(n,e).match({ltr:function(e,t,r,o){var i=n.document.createRange();return i.setStart(e.dom(),t),i.setEnd(r.dom(),o),i},rtl:function(e,t,r,o){var i=n.document.createRange();return i.setStart(r.dom(),o),i.setEnd(e.dom(),t),i}})},Am=function(n,e,t){return e>=n.left&&e<=n.right&&t>=n.top&&t<=n.bottom},Mm=function(n,e,t,r,o){if(0===o)return 0;if(e===r)return o-1;for(var i=r,u=1;u<o;u++){var a=n(u),c=Math.abs(e-a.left);if(t>a.bottom);else{if(t<a.top||c>i)return u-1;i=c}}return 0},Rm=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getClientRects();return go(i,function(n){return Am(n,t,r)?p.some(n):p.none()}).map(function(o){return function(n,e,t,r,o){var i=function(t){var r=n.dom().createRange();return r.setStart(e.dom(),t),r.collapse(!0),r},u=am(e).length,a=Mm(function(n){return i(n).getBoundingClientRect()},t,r,o.right,u);return i(a)}(n,e,t,r,o)})},Bm=function(n,e,t,r){var o=n.dom().createRange(),i=Wr.children(e);return go(i,function(e){return o.selectNode(e.dom()),Am(o.getBoundingClientRect(),t,r)?Im(n,e,t,r):p.none()})},Im=function(n,e,t,r){return(ir.isText(e)?Rm:Bm)(n,e,t,r)},Fm=function(n,e,t,r){var o=n.dom().createRange();o.selectNode(e.dom());var i=o.getBoundingClientRect(),u=Math.max(i.left,Math.min(i.right,t)),a=Math.max(i.top,Math.min(i.bottom,r));return Im(n,e,u,a)},Hm=function(n,e){var t=function(n){for(var r=Wr.children(n),o=r.length-1;o>=0;o--){var i=r[o];if(e(i))return p.some(i);var u=t(i);if(u.isSome())return u}return p.none()};return t(n)},Nm=function(n){return Ao.descendant(n,dm)},Vm=function(n){return Hm(n,dm)},jm=function(n,e){return e-n.left<n.right-e},Lm=function(n,e,t){var r=n.dom().createRange();return r.selectNode(e.dom()),r.collapse(t),r},Pm=function(n,e,t){var r=n.dom().createRange();r.selectNode(e.dom());var o=r.getBoundingClientRect(),i=jm(o,t);return(!0===i?Nm:Vm)(e).map(function(e){return Lm(n,e,i)})},Wm=function(n,e,t){var r=e.dom().getBoundingClientRect(),o=jm(r,t);return p.some(Lm(n,e,o))},Um=function(n,e,t){return(0===Wr.children(e).length?Wm:Pm)(n,e,t)},zm=(document.caretPositionFromPoint||document.caretRangeFromPoint,function(n,e){var t=ir.name(n);return"input"===t?gm.after(n):D.contains(["br","img"],t)?0===e?gm.before(n):gm.after(n):gm.on(n,e)}),Gm=function(n,e,t,r){var o=zm(n,e),i=zm(t,r);return vm.relative(o,i)},$m=Gm,_m=function(n,e){p.from(n.getSelection()).each(function(n){n.removeAllRanges(),n.addRange(e)})},qm=function(n,e,t,r,o){var i=Tm.exactToNative(n,e,t,r,o);_m(n,i)},Km=function(n,e){return Em(n,e).match({ltr:function(e,t,r,o){qm(n,e,t,r,o)},rtl:function(e,t,r,o){var i=n.getSelection();i.extend?(i.collapse(e.dom(),t),i.extend(r.dom(),o)):qm(n,r,o,e,t)}})},Xm=function(n){var e=cn.fromDom(n.anchorNode),t=cn.fromDom(n.focusNode);return bm(e,n.anchorOffset,t,n.focusOffset)?p.some(vm.range(cn.fromDom(n.anchorNode),n.anchorOffset,cn.fromDom(n.focusNode),n.focusOffset)):function(n){if(n.rangeCount>0){var e=n.getRangeAt(0),t=n.getRangeAt(n.rangeCount-1);return p.some(vm.range(cn.fromDom(e.startContainer),e.startOffset,cn.fromDom(t.endContainer),t.endOffset))}return p.none()}(n)},Ym=function(n){var e=n.getSelection();return e.rangeCount>0?Xm(e):p.none()},Jm=function(n,e,t,r,o){var i=$m(e,t,r,o);Km(n,i)},Qm=Ym,Zm=function(n){return Ym(n).map(function(n){return vm.exact(n.start(),n.soffset(),n.finish(),n.foffset())})},ng=function(n){n.getSelection().removeAllRanges()},eg=function(n,e){var t=Dm(n,e);return Tm.getFirstRect(t)},tg=function(n){return{left:n.left,top:n.top,right:n.right,bottom:n.bottom,width:s.constant(2),height:n.height}},rg=function(n){return{left:s.constant(n.left),top:s.constant(n.top),right:s.constant(n.right),bottom:s.constant(n.bottom),width:s.constant(n.width),height:s.constant(n.height)}},og=function(n){var e=n.getSelection();return e!==undefined&&e.rangeCount>0?function(n){if(n.collapsed){var e=cn.fromDom(n.startContainer);return Wr.parent(e).bind(function(t){var r=vm.exact(e,n.startOffset,t,lm(t));return eg(n.startContainer.ownerDocument.defaultView,r).map(tg).map(D.pure)}).getOr([])}return D.map(n.getClientRects(),rg)}(e.getRangeAt(0)):[]},ig="data-"+gi.resolve("last-outer-height"),ug=function(n,e){fr(n,ig,e)},ag=function(n){return{top:s.constant(n.top()),bottom:s.constant(n.top()+n.height())}},cg=function(n,e){var t=function(n){return im(n,ig)}(e),r=n.innerHeight;return t>r?p.some(t-r):p.none()},sg=function(n,e){var t=cn.fromDom(e.document.body),r=qd(cn.fromDom(n),"resize",function(){cg(n,t).each(function(n){(function(n){var e=og(n);return e.length>0?p.some(e[0]).map(ag):p.none()})(e).each(function(t){var r=function(n,e,t){return e.top()>n.innerHeight||e.bottom()>n.innerHeight?Math.min(t,e.bottom()-n.innerHeight+50):0}(e,t,n);0!==r&&e.scrollTo(e.pageXOffset,e.pageYOffset+r)})}),ug(t,n.innerHeight)});ug(t,n.innerHeight);return{toEditing:function(){om(e)},destroy:function(){r.unbind()}}},fg=function(n){return p.some(cn.fromDom(n.dom().contentWindow.document.body))},lg=function(n){return p.some(cn.fromDom(n.dom().contentWindow.document))},dg=function(n){return p.from(n.dom().contentWindow)},mg=function(n){return dg(n).bind(Qm)},gg=function(n){return n.getFrame()},pg=function(n,e){return function(t){return t[n].getOrThunk(function(){var n=gg(t);return function(){return e(n)}})()}},hg=function(n,e,t,r){return n[t].getOrThunk(function(){return function(n){return qd(e,r,n)}})},vg=function(n){return{left:s.constant(n.left),top:s.constant(n.top),right:s.constant(n.right),bottom:s.constant(n.bottom),width:s.constant(n.width),height:s.constant(n.height)}},yg={getBody:pg("getBody",fg),getDoc:pg("getDoc",lg),getWin:pg("getWin",dg),getSelection:pg("getSelection",mg),getFrame:gg,getActiveApi:function(n){var e=gg(n);return fg(e).bind(function(t){return lg(e).bind(function(r){return dg(e).map(function(o){var i=cn.fromDom(r.dom().documentElement),u=n.getCursorBox.getOrThunk(function(){return function(){return Zm(o).bind(function(n){return eg(o,n).orThunk(function(){return function(n){return Qm(n).filter(function(n){return wn(n.start(),n.finish())&&n.soffset()===n.foffset()}).bind(function(n){var e=n.start().dom().getBoundingClientRect();return e.width>0||e.height>0?p.some(e).map(vg):p.none()})}(o)})})}}),a=n.setSelection.getOrThunk(function(){return function(n,e,t,r){Jm(o,n,e,t,r)}}),c=n.clearSelection.getOrThunk(function(){return function(){ng(o)}});return{body:s.constant(t),doc:s.constant(r),win:s.constant(o),html:s.constant(i),getSelection:s.curry(mg,e),setSelection:a,clearSelection:c,frame:s.constant(e),onKeyup:hg(n,r,"onKeyup","keyup"),onNodeChanged:hg(n,r,"onNodeChanged","selectionchange"),onDomChanged:n.onDomChanged,onScrollToCursor:n.onScrollToCursor,onScrollToElement:n.onScrollToElement,onToReading:n.onToReading,onToEditing:n.onToEditing,onToolbarScrollStart:n.onToolbarScrollStart,onTouchContent:n.onTouchContent,onTapContent:n.onTapContent,onTouchToolstrip:n.onTouchToolstrip,getCursorBox:u}})})})}},bg="data-ephox-mobile-fullscreen-style",wg="position:absolute!important;",Sg="top:0!important;left:0!important;margin:0!important;padding:0!important;width:100%!important;",xg=un.detect().os.isAndroid(),Tg=function(n,e){var t=function(n){return function(e){var t=dr(e,"style"),r=t===undefined?"no-styles":t.trim();r!==n&&(fr(e,bg,r),fr(e,"style",n))}},r=Ei(n,"*"),o=D.bind(r,function(n){return Di(n,"*")}),i=function(n){var e=du(n,"background-color");return e!==undefined&&""!==e?"background-color:"+e+"!important":"background-color:rgb(255,255,255)!important;"}(e);D.each(o,t("display:none!important;")),D.each(r,t(wg+Sg+i));t((!0===xg?"":wg)+Sg+i)(n)},Og=function(){var n=Ci("["+bg+"]");D.each(n,function(n){var e=dr(n,bg);"no-styles"!==e?fr(n,"style",e):gr(n,"style"),gr(n,bg)})},kg=function(){var n=Ri("head").getOrDie(),e=Ri('meta[name="viewport"]').getOrThunk(function(){var e=cn.fromTag("meta");return fr(e,"name","viewport"),Gr.append(n,e),e}),t=dr(e,"content");return{maximize:function(){fr(e,"content","width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0")},restore:function(){t!==undefined&&null!==t&&t.length>0?fr(e,"content",t):fr(e,"content","user-scalable=yes")}}},Cg=function(n,e){var t=kg(),r=Yf(),o=Yf();return{enter:function(){e.hide(),Dr.add(n.container,gi.resolve("fullscreen-maximized")),Dr.add(n.container,gi.resolve("android-maximized")),t.maximize(),Dr.add(n.body,gi.resolve("android-scroll-reload")),r.set(sg(n.win,yg.getWin(n.editor).getOrDie("no"))),yg.getActiveApi(n.editor).each(function(e){Tg(n.container,e.body()),o.set(rm(e,n.toolstrip,n.alloy))})},exit:function(){t.restore(),e.show(),Dr.remove(n.container,gi.resolve("fullscreen-maximized")),Dr.remove(n.container,gi.resolve("android-maximized")),Og(),Dr.remove(n.body,gi.resolve("android-scroll-reload")),o.clear(),r.clear()}}},Eg=lt.objOf([Ue("editor",[Pe("getFrame"),$e("getBody"),$e("getDoc"),$e("getWin"),$e("getSelection"),$e("setSelection"),$e("clearSelection"),$e("cursorSaver"),$e("onKeyup"),$e("onNodeChanged"),$e("getCursorBox"),Pe("onDomChanged"),Xe("onTouchContent",s.noop),Xe("onTapContent",s.noop),Xe("onTouchToolstrip",s.noop),Xe("onScrollToCursor",s.constant({unbind:s.noop})),Xe("onScrollToElement",s.constant({unbind:s.noop})),Xe("onToEditing",s.constant({unbind:s.noop})),Xe("onToReading",s.constant({unbind:s.noop})),Xe("onToolbarScrollStart",s.identity)]),Pe("socket"),Pe("toolstrip"),Pe("dropup"),Pe("toolbar"),Pe("container"),Pe("alloy"),Ze("win",function(n){return Wr.owner(n.socket).dom().defaultView}),Ze("body",function(n){return cn.fromDom(n.socket.dom().ownerDocument.body)}),Xe("translate",s.identity),Xe("setReadOnly",s.noop)]),Dg=function(n,e){var t=null;return{cancel:function(){null!==t&&(clearTimeout(t),t=null)},throttle:function(){var r=arguments;null===t&&(t=setTimeout(function(){n.apply(null,r),t=null,r=null},e))}}},Ag=function(n,e){var t=null;return{cancel:function(){null!==t&&(clearTimeout(t),t=null)},throttle:function(){var r=arguments;null!==t&&clearTimeout(t),t=setTimeout(function(){n.apply(null,r),t=null,r=null},e)}}},Mg=function(n,e){var t=Zs(Tf.sketch({dom:cs('<div aria-hidden="true" class="${prefix}-mask-tap-icon"></div>'),containerBehaviours:Jt.derive([fi.config({toggleClass:gi.resolve("mask-tap-icon-selected"),toggleOnExecute:!1})])})),r=Dg(n,200);return Tf.sketch({dom:cs('<div class="${prefix}-disabled-mask"></div>'),components:[Tf.sketch({dom:cs('<div class="${prefix}-content-container"></div>'),components:[os.sketch({dom:cs('<div class="${prefix}-content-tap-section"></div>'),components:[t.asSpec()],action:function(n){r.throttle()},buttonBehaviours:Jt.derive([fi.config({toggleClass:gi.resolve("mask-tap-icon-selected")})])})]})]})},Rg=function(n){var e=lt.asRawOrDie("Getting AndroidWebapp schema",Eg,n);su(e.toolstrip,"width","100%");var t=ed.build(Mg(function(){e.setReadOnly(!0),o.enter()},e.translate));e.alloy.add(t);var r={show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}};Gr.append(e.container,t.element());var o=Cg(e,r);return{setReadOnly:e.setReadOnly,refreshStructure:s.noop,enter:o.enter,exit:o.exit,destroy:s.noop}},Bg=[Xe("shell",!0),ec("toolbarBehaviours",[bd])],Ig=[wc.optional({name:"groups",overrides:function(n){return{behaviours:Jt.derive([bd.config({})])}}})],Fg={name:s.constant("Toolbar"),schema:s.constant(Bg),parts:s.constant(Ig)},Hg=ts({name:"Toolbar",configFields:Fg.schema(),partFields:Fg.parts(),factory:function(n,e,t,r){var o=function(e){return n.shell()?p.some(e):Lc(e,n,"groups")},i=n.shell()?{behaviours:[bd.config({})],components:[]}:{behaviours:[],components:e};return{uid:n.uid(),dom:n.dom(),components:i.components,behaviours:Mn.deepMerge(Jt.derive(i.behaviours),tc(n.toolbarBehaviours())),apis:{setGroups:function(n,e){o(n).fold(function(){throw console.error("Toolbar was defined to not be a shell, but no groups container was specified in components"),new Error("Toolbar was defined to not be a shell, but no groups container was specified in components")},function(n){bd.set(n,e)})}},domModification:{attributes:{role:"group"}}}},apis:{setGroups:function(n,e,t){n.setGroups(e,t)}}}),Ng=[Pe("items"),Yo.markers(["itemClass"]),ec("tgroupBehaviours",[nc])],Vg=[wc.group({name:"items",unit:"item",overrides:function(n){return{domModification:{classes:[n.markers().itemClass()]}}}})],jg={name:s.constant("ToolbarGroup"),schema:s.constant(Ng),parts:s.constant(Vg)},Lg=ts({name:"ToolbarGroup",configFields:jg.schema(),partFields:jg.parts(),factory:function(n,e,t,r){return Mn.deepMerge({dom:{attributes:{role:"toolbar"}}},{uid:n.uid(),dom:n.dom(),components:e,behaviours:Mn.deepMerge(Jt.derive([nc.config({mode:"flow",selector:"."+n.markers().itemClass()})]),tc(n.tgroupBehaviours())),"debug.sketcher":t["debug.sketcher"]})}}),Pg="data-"+gi.resolve("horizontal-scroll"),Wg=function(n){return n.dom().scrollTop>0||function(n){n.dom().scrollTop=1;var e=0!==n.dom().scrollTop;return n.dom().scrollTop=0,e}(n)},Ug=function(n){return n.dom().scrollLeft>0||function(n){n.dom().scrollLeft=1;var e=0!==n.dom().scrollLeft;return n.dom().scrollLeft=0,e}(n)},zg=function(n){return"true"===dr(n,Pg)?Ug:Wg},Gg=function(n,e){return qd(n,"touchmove",function(n){Fi(n.target(),e).filter(zg).fold(function(){n.raw().preventDefault()},s.noop)})},$g=function(n){fr(n,Pg,"true")},_g=function(){var n=function(n){var e=!0===n.scrollable?"${prefix}-toolbar-scrollable-group":"";return{dom:cs('<div aria-label="'+n.label+'" class="${prefix}-toolbar-group '+e+'"></div>'),tgroupBehaviours:Jt.derive([bf("adhoc-scrollable-toolbar",!0===n.scrollable?[bt.runOnInit(function(n,e){su(n.element(),"overflow-x","auto"),$g(n.element()),kd.register(n.element())})]:[])]),components:[Tf.sketch({components:[Lg.parts().items({})]})],markers:{itemClass:gi.resolve("toolbar-group-item")},items:n.items}},e=ed.build(Hg.sketch({dom:cs('<div class="${prefix}-toolbar"></div>'),components:[Hg.parts().groups({})],toolbarBehaviours:Jt.derive([fi.config({toggleClass:gi.resolve("context-toolbar"),toggleOnExecute:!1,aria:{mode:"none"}}),nc.config({mode:"cyclic"})]),shell:!0})),t=ed.build(Tf.sketch({dom:{classes:[gi.resolve("toolstrip")]},components:[ed.premade(e)],containerBehaviours:Jt.derive([fi.config({toggleClass:gi.resolve("android-selection-context-toolbar"),toggleOnExecute:!1})])})),r=function(){Hg.setGroups(e,o.get()),fi.off(e)},o=Oo([]);return{wrapper:s.constant(t),toolbar:s.constant(e),createGroups:function(e){return D.map(e,s.compose(Lg.sketch,n))},setGroups:function(n){o.set(n),r()},setContextToolbar:function(n){fi.on(e),Hg.setGroups(e,n)},restoreToolbar:function(){fi.isOn(e)&&r()},refresh:function(){Hg.refresh(e)},focus:function(){nc.focusIn(e)}}},qg=function(n,e){bd.append(n,ed.premade(e))},Kg=function(n,e){bd.remove(n,e)},Xg=function(n){return ed.build(os.sketch({dom:cs('<div class="${prefix}-mask-edit-icon ${prefix}-icon"></div>'),action:function(){n.run(function(n){n.setReadOnly(!1)})}}))},Yg=function(){return ed.build(Tf.sketch({dom:cs('<div class="${prefix}-editor-socket"></div>'),components:[],containerBehaviours:Jt.derive([bd.config({})])}))},Jg=function(n,e,t,r){(!0===t?Br.toAlpha:Br.toOmega)(r);(t?qg:Kg)(n,e)},Qg=function(n,e){return e.getAnimationRoot().fold(function(){return n.element()},function(e){return e(n)})},Zg=function(n){return n.dimension().property()},np=function(n,e){return n.dimension().getDimension()(e)},ep=function(n,e){var t=Qg(n,e);$l(t,[e.shrinkingClass(),e.growingClass()])},tp=function(n,e){Dr.remove(n.element(),e.openClass()),Dr.add(n.element(),e.closedClass()),su(n.element(),Zg(e),"0px"),gu(n.element())},rp=function(n,e){Dr.remove(n.element(),e.closedClass()),Dr.add(n.element(),e.openClass()),lu(n.element(),Zg(e))},op=function(n,e,t){t.setCollapsed(),su(n.element(),Zg(e),np(e,n.element())),gu(n.element());var r=Qg(n,e);Dr.add(r,e.shrinkingClass()),tp(n,e),e.onStartShrink()(n)},ip=function(n,e,t){var r=function(n,e){rp(n,e);var t=np(e,n.element());return tp(n,e),t}(n,e),o=Qg(n,e);Dr.add(o,e.growingClass()),rp(n,e),su(n.element(),Zg(e),r),t.setExpanded(),e.onStartGrow()(n)},up=function(n,e,t){var r=Qg(n,e);return!0===Dr.has(r,e.growingClass())},ap=function(n,e,t){var r=Qg(n,e);return!0===Dr.has(r,e.shrinkingClass())},cp={grow:function(n,e,t){t.isExpanded()||ip(n,e,t)},shrink:function(n,e,t){t.isExpanded()&&op(n,e,t)},immediateShrink:function(n,e,t){t.isExpanded()&&function(n,e,t){t.setCollapsed(),su(n.element(),Zg(e),np(e,n.element())),gu(n.element()),ep(n,e),tp(n,e),e.onStartShrink()(n),e.onShrunk()(n)}(n,e,t)},hasGrown:function(n,e,t){return t.isExpanded()},hasShrunk:function(n,e,t){return t.isCollapsed()},isGrowing:up,isShrinking:ap,isTransitioning:function(n,e,t){return!0===up(n,e)||!0===ap(n,e)},toggleGrow:function(n,e,t){(t.isExpanded()?op:ip)(n,e,t)},disableTransitions:ep},sp={exhibit:function(n,e){return e.expanded()?Nt.nu({classes:[e.openClass()],styles:{}}):Nt.nu({classes:[e.closedClass()],styles:pe(e.dimension().property(),"0px")})},events:function(n,e){return bt.derive([bt.run(xn.transitionend(),function(t,r){r.event().raw().propertyName===n.dimension().property()&&(cp.disableTransitions(t,n,e),e.isExpanded()&&lu(t.element(),n.dimension().property()),(e.isExpanded()?n.onGrown():n.onShrunk())(t,r))})])}},fp=[Pe("closedClass"),Pe("openClass"),Pe("shrinkingClass"),Pe("growingClass"),$e("getAnimationRoot"),Yo.onHandler("onShrunk"),Yo.onHandler("onStartShrink"),Yo.onHandler("onGrown"),Yo.onHandler("onStartGrow"),Xe("expanded",!1),We("dimension",lt.choose("property",{width:[Yo.output("property","width"),Yo.output("getDimension",function(n){return Vs(n)+"px"})],height:[Yo.output("property","height"),Yo.output("getDimension",function(n){return vu(n)+"px"})]}))],lp={init:function(n){var e=Oo(n.expanded());return qt({isExpanded:function(){return!0===e.get()},isCollapsed:function(){return!1===e.get()},setCollapsed:s.curry(e.set,!1),setExpanded:s.curry(e.set,!0),readState:function(){return"expanded: "+e.get()}})}},dp=Jt.create({fields:fp,name:"sliding",active:sp,apis:cp,state:lp}),mp=function(n,e){var t=ed.build(Tf.sketch({dom:{tag:"div",classes:gi.resolve("dropup")},components:[],containerBehaviours:Jt.derive([bd.config({}),dp.config({closedClass:gi.resolve("dropup-closed"),openClass:gi.resolve("dropup-open"),shrinkingClass:gi.resolve("dropup-shrinking"),growingClass:gi.resolve("dropup-growing"),dimension:{property:"height"},onShrunk:function(t){n(),e(),bd.set(t,[])},onGrown:function(t){n(),e()}}),di(function(n,e){r(s.noop)})])})),r=function(n){window.requestAnimationFrame(function(){n(),dp.shrink(t)})};return{appear:function(n,e,r){!0===dp.hasShrunk(t)&&!1===dp.isTransitioning(t)&&window.requestAnimationFrame(function(){e(r),bd.set(t,[n()]),dp.grow(t)})},disappear:r,component:s.constant(t),element:t.element}},gp=un.detect().browser.isFirefox(),pp=lt.objOfOnly([ze("triggerEvent"),ze("broadcastEvent"),Xe("stopBackspace",!0)]),hp=function(n,e){var t=lt.asRawOrDie("Getting GUI events settings",pp,e),r=un.detect().deviceType.isTouch()?["touchstart","touchmove","touchend","gesturestart"]:["mousedown","mouseup","mouseover","mousemove","mouseout","click"],o=nm(t),i=D.map(r.concat(["selectstart","input","contextmenu","change","transitionend","dragstart","dragover","drop"]),function(e){return qd(n,e,function(n){o.fireIfReady(n,e).each(function(e){e&&n.kill()}),t.triggerEvent(e,n)&&n.kill()})}),u=qd(n,"keydown",function(n){t.triggerEvent("keydown",n)?n.kill():!0===t.stopBackspace&&function(n){return n.raw().which===Si.BACKSPACE()[0]&&!D.contains(["input","textarea"],ir.name(n.target()))}(n)&&n.prevent()}),a=function(n,e){return gp?Kd(n,"focus",e):qd(n,"focusin",e)}(n,function(n){t.triggerEvent("focusin",n)&&n.kill()}),c=function(n,e){return gp?Kd(n,"blur",e):qd(n,"focusout",e)}(n,function(n){t.triggerEvent("focusout",n)&&n.kill(),setTimeout(function(){t.triggerEvent(On.postBlur(),n)},0)}),s=Wr.defaultView(n),f=qd(s,"scroll",function(n){t.broadcastEvent(On.windowScroll(),n)&&n.kill()});return{unbind:function(){D.each(i,function(n){n.unbind()}),u.unbind(),a.unbind(),c.unbind(),f.unbind()}}},vp=function(n,e){var t=ge(n,"target").map(function(n){return n()}).getOr(e);return Oo(t)},yp=function(n,e){var t=Oo(!1),r=Oo(!1);return{stop:function(){t.set(!0)},cut:function(){r.set(!0)},isStopped:t.get,isCut:r.get,event:s.constant(n),setSource:e.set,getSource:e.get}},bp=yp,wp=function(n){var e=Oo(!1);return{stop:function(){e.set(!0)},cut:s.noop,isStopped:e.get,isCut:s.constant(!1),event:s.constant(n),setTarget:s.die(new Error("Cannot set target of a broadcasted event")),getTarget:s.die(new Error("Cannot get target of a broadcasted event"))}},Sp=$n([{stopped:[]},{resume:["element"]},{complete:[]}]),xp=function(n,e,t,r,o,i){var u=n(e,r),a=bp(t,o);return u.fold(function(){return i.logEventNoHandlers(e,r),Sp.complete()},function(n){var t=n.descHandler();return Fl(t)(a),a.isStopped()?(i.logEventStopped(e,n.element(),t.purpose()),Sp.stopped()):a.isCut()?(i.logEventCut(e,n.element(),t.purpose()),Sp.complete()):Wr.parent(n.element()).fold(function(){return i.logNoParent(e,n.element(),t.purpose()),Sp.complete()},function(r){return i.logEventResponse(e,n.element(),t.purpose()),Sp.resume(r)})})},Tp=function(n,e,t,r,o,i){return xp(n,e,t,r,o,i).fold(function(){return!0},function(r){return Tp(n,e,t,r,o,i)},function(){return!1})},Op=function(n,e,t,r,o){var i=vp(t,r);return Tp(n,e,t,r,i,o)},kp={triggerHandler:function(n,e,t,r,o){var i=vp(t,r);return xp(n,e,t,r,i,o)},triggerUntilStopped:function(n,e,t,r){var o=t.target();return Op(n,e,t,o,r)},triggerOnUntilStopped:Op,broadcast:function(n,e,t){var r=wp(e);return D.each(n,function(n){var e=n.descHandler();Fl(e)(r)}),r.isStopped()}},Cp=function(n,e,t){return Ao.closest(n,function(n){return e(n).isSome()},t).bind(e)},Ep=At("element","descHandler"),Dp=function(){var n={};return{registerId:function(e,t,r){Nn.each(r,function(r,o){var i=n[o]!==undefined?n[o]:{};i[t]=Il(r,e),n[o]=i})},unregisterId:function(e){Nn.each(n,function(n,t){n.hasOwnProperty(e)&&delete n[e]})},filterByType:function(e){return ge(n,e).map(function(n){return Nn.mapToArray(n,function(n,e){return function(n,e){return{id:s.constant(n),descHandler:s.constant(e)}}(e,n)})}).getOr([])},find:function(e,t,r){var o=de(t)(n);return Cp(r,function(n){return function(n,e){return _c(e).fold(function(n){return p.none()},function(t){var r=de(t);return n.bind(r).map(function(n){return Ep(e,n)})})}(o,n)},e)}}},Ap=function(){var n=Dp(),e={},t=function(t){_c(t.element()).each(function(t){e[t]=undefined,n.unregisterId(t)})};return{find:function(e,t,r){return n.find(e,t,r)},filter:function(e){return n.filterByType(e)},register:function(r){var o=function(n){var e=n.element();return _c(e).fold(function(){return Gc("uid-",n.element())},function(n){return n})}(r);ve(e,o)&&function(n,r){var o=e[r];if(o!==n)throw new Error('The tagId "'+r+'" is already used by: '+lo(o.element())+"\nCannot use it for: "+lo(n.element())+"\nThe conflicting element is"+(Jr.inBody(o.element())?" ":" not ")+"already in the DOM");t(n)}(r,o);var i=[r];n.registerId(i,o,r.events()),e[o]=r},unregister:t,getById:function(n){return de(n)(e)}}},Mp=function(n){var e=function(e){return Wr.parent(n.element()).fold(function(){return!0},function(n){return wn(e,n)})},t=Ap(),r=function(n,r){return t.find(e,n,r)},o=hp(n.element(),{triggerEvent:function(n,e){return xo(n,e.target(),function(t){return kp.triggerUntilStopped(r,n,e,t)})},broadcastEvent:function(n,e){var r=t.filter(n);return kp.broadcast(r,e)}}),i=Tl({debugInfo:s.constant("real"),triggerEvent:function(n,e,t){xo(n,e,function(o){kp.triggerOnUntilStopped(r,n,t,e,o)})},triggerFocus:function(n,e){_c(n).fold(function(){Io(n)},function(t){xo(On.focus(),n,function(t){kp.triggerHandler(r,On.focus(),{originator:s.constant(e),target:s.constant(n)},n,t)})})},triggerEscape:function(n,e){i.triggerEvent("keydown",n.element(),e.event())},getByUid:function(n){return g(n)},getByDom:function(n){return p(n)},build:ed.build,addToGui:function(n){c(n)},removeFromGui:function(n){f(n)},addToWorld:function(n){u(n)},removeFromWorld:function(n){a(n)},broadcast:function(n){d(n)},broadcastOn:function(n,e){m(n,e)}}),u=function(n){n.connect(i),ir.isText(n.element())||(t.register(n),D.each(n.components(),u),i.triggerEvent(On.systemInit(),n.element(),{target:s.constant(n.element())}))},a=function(n){ir.isText(n.element())||(D.each(n.components(),a),t.unregister(n)),n.disconnect()},c=function(e){to.attach(n,e)},f=function(n){to.detach(n)},l=function(n){var e=t.filter(On.receive());D.each(e,function(e){var t=e.descHandler();Fl(t)(n)})},d=function(n){l({universal:s.constant(!0),data:s.constant(n)})},m=function(n,e){l({universal:s.constant(!1),channels:s.constant(n),data:s.constant(e)})},g=function(n){return t.getById(n).fold(function(){return Yn.error(new Error('Could not find component with uid: "'+n+'" in system.'))},Yn.value)},p=function(n){return _c(n).bind(g)};return u(n),{root:s.constant(n),element:n.element,destroy:function(){o.unbind(),Kr.remove(n.element())},add:c,remove:f,getByUid:g,getByDom:p,addToWorld:u,removeFromWorld:a,broadcast:d,broadcastOn:m}},Rp={create:function(){var n=ed.build(Tf.sketch({dom:{tag:"div"}}));return Mp(n)},takeover:Mp},Bp=s.constant(gi.resolve("readonly-mode")),Ip=s.constant(gi.resolve("edit-mode")),Fp=function(n){var e=ed.build(Tf.sketch({dom:{classes:[gi.resolve("outer-container")].concat(n.classes)},containerBehaviours:Jt.derive([Br.config({alpha:Bp(),omega:Ip()})])}));return Rp.takeover(e)},Hp=function(n,e){var t=e||cn.fromDom(document.documentElement);return Ao.ancestor(n,s.curry(wn,t)).isSome()},Np=function(n){var e=n.dom();return e===e.window?n:ir.isDocument(n)?e.defaultView||e.parentWindow:null},Vp=function(n,e){return{left:s.constant(n),top:s.constant(e),translate:function(t,r){return Vp(n+t,e+r)}}},jp=function(n,e){return n!==undefined?n:e!==undefined?e:0},Lp=function(n){var e=n.dom(),t=e.ownerDocument,r=t.body,o=cn.fromDom(t.documentElement);return r===e?Vp(r.offsetLeft,r.offsetTop):Hp(n,o)?function(n){var e=n.getBoundingClientRect();return Vp(e.left,e.top)}(e):Vp(0,0)},Pp=function(n){var e=n.dom().ownerDocument,t=e.body,r=Np(cn.fromDom(e)),o=e.documentElement,i=jp(r.pageYOffset,o.scrollTop),u=jp(r.pageXOffset,o.scrollLeft),a=jp(o.clientTop,t.clientTop),c=jp(o.clientLeft,t.clientLeft);return Lp(n).translate(u-c,i-a)},Wp=function(n,e,t,r,o){var i=function(){e.run(function(n){n.refreshSelection()})},u=function(n,t){var o=n-r.dom().scrollTop;e.run(function(n){n.scrollIntoView(o,o+t)})},a=function(){e.run(function(n){n.clearSelection()})},c=function(){n.getCursorBox().each(function(n){u(n.top(),n.height())}),e.run(function(n){n.syncHeight()})},s=em(n),f=Ag(c,300),l=[n.onKeyup(function(){a(),f.throttle()}),n.onNodeChanged(i),n.onDomChanged(f.throttle),n.onDomChanged(i),n.onScrollToCursor(function(n){n.preventDefault(),f.throttle()}),n.onScrollToElement(function(n){!function(n){Pp(n).top(),vu(n),u(e,r)}(n.element())}),n.onToEditing(function(){e.run(function(n){n.toEditing()})}),n.onToReading(function(){e.run(function(n){n.toReading()})}),qd(n.doc(),"touchend",function(e){wn(n.html(),e.target())||wn(n.body(),e.target())}),qd(t,"transitionend",function(n){"height"===n.raw().propertyName&&function(){var n=vu(t);e.run(function(e){e.setViewportOffset(n)}),i(),c()}()}),Kd(t,"touchstart",function(t){e.run(function(n){n.highlightSelection()}),function(n){e.run(function(e){e.onToolbarTouch(n)})}(t),n.onTouchToolstrip()}),qd(n.body(),"touchstart",function(e){a(),n.onTouchContent(),s.fireTouchstart(e)}),s.onTouchmove(),s.onTouchend(),qd(n.body(),"click",function(n){n.kill()}),qd(t,"touchmove",function(){n.onToolbarScrollStart()})];return{destroy:function(){D.each(l,function(n){n.unbind()})}}},Up=function(n){var e=n.getSelection();if(e.rangeCount>0){var t=e.getRangeAt(0),r=n.document.createRange();r.setStart(t.startContainer,t.startOffset),r.setEnd(t.endContainer,t.endOffset),e.removeAllRanges(),e.addRange(r)}},zp=function(n,e){Ho().each(function(n){wn(n,e)||Fo(n)}),n.focus(),Io(cn.fromDom(n.document.body)),Up(n)},Gp=function(n){var e=p.none(),t=[],r=function(n){o()?u(n):t.push(n)},o=function(){return e.isSome()},i=function(n){D.each(n,u)},u=function(n){e.each(function(e){setTimeout(function(){n(e)},0)})};return n(function(n){e=p.some(n),i(t),t=[]}),{get:r,map:function(n){return Gp(function(e){r(function(t){e(n(t))})})},isReady:o}},$p={nu:Gp,pure:function(n){return Gp(function(e){e(n)})}},_p=function(n){return function(){var e=Array.prototype.slice.call(arguments),t=this;setTimeout(function(){n.apply(t,e)},0)}},qp=function(n){var e=function(e){n(_p(e))};return{map:function(n){return qp(function(t){e(function(e){var r=n(e);t(r)})})},bind:function(n){return qp(function(t){e(function(e){n(e).get(t)})})},anonBind:function(n){return qp(function(t){e(function(e){n.get(t)})})},toLazy:function(){return $p.nu(e)},get:e}},Kp={nu:qp,pure:function(n){return qp(function(e){e(n)})}},Xp=function(n,e,t){return Math.abs(n-e)<=t?p.none():n<e?p.some(n+t):p.some(n-t)},Yp=function(){var n=null;return{animate:function(e,t,r,o,i,u){var a=!1,c=function(n){a=!0,i(n)};clearInterval(n);var s=function(e){clearInterval(n),c(e)};n=setInterval(function(){var i=e();Xp(i,t,r).fold(function(){clearInterval(n),c(t)},function(r){if(o(r,s),!a){var u=e();(u!==r||Math.abs(u-t)>Math.abs(i-t))&&(clearInterval(n),c(t))}})},u)}}},Jp=function(n,e){return go([{width:320,height:480,keyboard:{portrait:300,landscape:240}},{width:320,height:568,keyboard:{portrait:300,landscape:240}},{width:375,height:667,keyboard:{portrait:305,landscape:240}},{width:414,height:736,keyboard:{portrait:320,landscape:240}},{width:768,height:1024,keyboard:{portrait:320,landscape:400}},{width:1024,height:1366,keyboard:{portrait:380,landscape:460}}],function(t){return n<=t.width&&e<=t.height?p.some(t.keyboard):p.none()}).getOr({portrait:e/5,landscape:n/4})},Qp=function(n){var e=Yd(n).isPortrait(),t=function(n){return Jp(n.screen.width,n.screen.height)}(n),r=e?t.portrait:t.landscape;return(e?n.screen.height:n.screen.width)-n.innerHeight>r?0:r},Zp=function(n,e){var t=Wr.owner(n).dom().defaultView;return vu(n)+vu(e)-Qp(t)},nh=Zp,eh=function(n,e,t){var r=Zp(e,t),o=vu(e)+vu(t)-r;su(n,"padding-bottom",o+"px")},th=$n([{fixed:["element","property","offsetY"]},{scroller:["element","offsetY"]}]),rh="data-"+gi.resolve("position-y-fixed"),oh="data-"+gi.resolve("y-property"),ih="data-"+gi.resolve("scrolling"),uh="data-"+gi.resolve("last-window-height"),ah=function(n){return im(n,rh)},ch=function(n,e){var t=function(n){return dr(n,oh)}(n);return th.fixed(n,t,e)},sh=function(n,e){return th.scroller(n,e)},fh=function(n){var e=ah(n);return("true"===dr(n,ih)?sh:ch)(n,e)},lh=function(n,e,t){var r=Wr.owner(n).dom().defaultView.innerHeight;return fr(n,uh,r+"px"),r-e-t},dh=function(n){var e=Ai(n,"["+rh+"]");return D.map(e,fh)},mh=function(n,e,t,r){var o=Wr.owner(n).dom().defaultView,i=function(n){var e=dr(n,"style");return fu(n,{position:"absolute",top:"0px"}),fr(n,rh,"0px"),fr(n,oh,"top"),{restore:function(){fr(n,"style",e||""),gr(n,rh),gr(n,oh)}}}(t),u=vu(t),a=vu(r),c=lh(n,u,a),f=function(n,e,t){var r=dr(t,"style");return kd.register(t),fu(t,{position:"absolute",height:e+"px",width:"100%",top:n+"px"}),fr(t,rh,n+"px"),fr(t,ih,"true"),fr(t,oh,"top"),{restore:function(){kd.deregister(t),fr(t,"style",r||""),gr(t,rh),gr(t,ih),gr(t,oh)}}}(u,c,n),l=function(n,e,t){var r=dr(n,"style");return fu(n,{position:"absolute",bottom:"0px"}),fr(n,rh,"0px"),fr(n,oh,"bottom"),{restore:function(){fr(n,"style",r||""),gr(n,rh),gr(n,oh)}}}(r),d=!0,m=function(){return o.innerHeight>function(n){return im(n,uh)}(n)},g=function(){if(d){var o=vu(t),i=vu(r),u=lh(n,o,i);fr(n,rh,o+"px"),su(n,"height",u+"px"),su(r,"bottom",-(o+u+i)+"px"),eh(e,n,r)}};return eh(e,n,r),{setViewportOffset:function(e){fr(n,rh,e+"px"),g()},isExpanding:m,isShrinking:s.not(m),refresh:g,restore:function(){d=!1,i.restore(),f.restore(),l.restore()}}},gh=ah,ph=Yp(),hh="data-"+gi.resolve("last-scroll-top"),vh=function(n){var e=mu(n,"top").getOr(0);return parseInt(e,10)},yh=function(n){return parseInt(n.dom().scrollTop,10)},bh=function(n,e){var t=e+gh(n)+"px";su(n,"top",t)},wh=function(n,e,t){return Kp.nu(function(r){var o=s.curry(yh,n);ph.animate(o,e,15,function(e){n.dom().scrollTop=e,su(n,"top",vh(n)+15+"px")},function(){n.dom().scrollTop=e,su(n,"top",t+"px"),r(e)},10)})},Sh=function(n,e){return Kp.nu(function(t){var r=s.curry(yh,n);fr(n,hh,r());var o=Math.abs(e-r()),i=Math.ceil(o/10);ph.animate(r,e,i,function(e,t){im(n,hh)!==n.dom().scrollTop?t(n.dom().scrollTop):(n.dom().scrollTop=e,fr(n,hh,e))},function(){n.dom().scrollTop=e,fr(n,hh,e),t(e)},10)})},xh=function(n,e){return Kp.nu(function(t){var r=s.curry(vh,n),o=function(e){su(n,"top",e+"px")},i=Math.abs(e-r()),u=Math.ceil(i/10);ph.animate(r,e,u,o,function(){o(e),t(e)},10)})},Th=function(n,e,t){var r=Wr.owner(n).dom().defaultView;return Kp.nu(function(o){bh(n,t),bh(e,t),r.scrollTo(0,t),o(t)})},Oh=function(n,e,t,r,o){var i=nh(e,t),u=s.curry(Up,n);r>i||o>i?Sh(e,e.dom().scrollTop-i+o).get(u):r<0&&Sh(e,e.dom().scrollTop+r).get(u)},kh=function(n,e){return e(function(e){var t=[],r=0;0===n.length?e([]):D.each(n,function(o,i){o.get(function(o){return function(i){t[o]=i,++r>=n.length&&e(t)}}(i))})})},Ch=function(n){return kh(n,Kp.nu)},Eh=Ch,Dh=function(n,e){return n.fold(function(n,t,r){return function(n,e,t,r){return su(n,e,t+r+"px"),Kp.pure(r)}(n,t,e,r)},function(n,t){return function(n,e,t){var r=e+t,o=mu(n,"top").getOr(t),i=r-parseInt(o,10),u=n.dom().scrollTop+i;return wh(n,u,r)}(n,e,t)})},Ah=function(n,e){var t=dh(n),r=D.map(t,function(n){return Dh(n,e)});return Eh(r)},Mh=function(n,e){var t=cn.fromTag("input");fu(t,{opacity:"0",position:"absolute",top:"-1000px",left:"-1000px"}),Gr.append(n,t),Io(t),e(t),Kr.remove(t)},Rh=function(n,e,t,r,o,i){var u=function(n){var e=Oo($p.pure({}));return{start:function(t){var r=$p.nu(function(e){return n(t).get(e)});e.set(r)},idle:function(n){e.get().get(function(){n()})}}}(function(t){return Th(n,e,t)}),a=Ag(function(){u.idle(function(){Ah(t,r.pageYOffset).get(function(){(function(){var n=og(i);return p.from(n[0]).bind(function(n){var t=n.top()-e.dom().scrollTop;return t>r.innerHeight+5||t<-5?p.some({top:s.constant(t),bottom:s.constant(t+n.height())}):p.none()})})().each(function(n){e.dom().scrollTop=e.dom().scrollTop+n.top()}),u.start(0),o.refresh()})})},1e3),c=qd(cn.fromDom(r),"scroll",function(){r.pageYOffset<0||a.throttle()});return Ah(t,r.pageYOffset).get(s.identity),{unbind:c.unbind}},Bh=function(n){var e=n.cWin(),t=n.ceBody(),r=n.socket(),o=n.toolstrip(),i=n.toolbar(),u=n.contentElement(),a=n.keyboardType(),c=n.outerWindow(),f=n.dropup(),l=mh(r,t,o,f),d=a(n.outerBody(),e,Jr.body(),u,o,i),m=Jd(c,{onChange:s.noop,onReady:l.refresh});m.onAdjustment(function(){l.refresh()});var g=qd(cn.fromDom(c),"resize",function(){l.isExpanding()&&l.refresh()}),p=Rh(o,r,n.outerBody(),c,l,e),h=function(n,e){var t=n.document,r=cn.fromTag("div");Dr.add(r,gi.resolve("unfocused-selections")),Gr.append(cn.fromDom(t.documentElement),r);var o=qd(r,"touchstart",function(t){t.prevent(),zp(n,e),u()}),i=function(n){var e=cn.fromTag("span");return Gl(e,[gi.resolve("layer-editor"),gi.resolve("unfocused-selection")]),fu(e,{left:n.left()+"px",top:n.top()+"px",width:n.width()+"px",height:n.height()+"px"}),e},u=function(){Kr.empty(r)};return{update:function(){u();var e=og(n),t=D.map(e,i);_r(r,t)},isActive:function(){return Wr.children(r).length>0},destroy:function(){o.unbind(),Kr.remove(r)},clear:u}}(e,u),v=function(){h.clear()};return{toEditing:function(){d.toEditing(),v()},toReading:function(){d.toReading()},onToolbarTouch:function(n){d.onToolbarTouch(n)},refreshSelection:function(){h.isActive()&&h.update()},clearSelection:v,highlightSelection:function(){h.update()},scrollIntoView:function(n,t){Oh(e,r,f,n,t)},updateToolbarPadding:s.noop,setViewportOffset:function(n){l.setViewportOffset(n),xh(r,n).get(s.identity)},syncHeight:function(){su(u,"height",u.dom().contentWindow.document.body.scrollHeight+"px")},refreshStructure:l.refresh,destroy:function(){l.restore(),m.destroy(),p.unbind(),g.unbind(),d.destroy(),h.destroy(),Mh(Jr.body(),Fo)}}},Ih=function(n,e,t,r){var o=function(){zp(e,r)},i=qd(t,"keydown",function(n){D.contains(["input","textarea"],ir.name(n.target()))||o()});return{toReading:function(){Mh(n,Fo)},toEditing:o,onToolbarTouch:function(){},destroy:function(){i.unbind()}}},Fh=function(n,e){var t=kg(),r=Jf(),o=Jf(),i=Yf(),u=Yf();return{enter:function(){e.hide();var a=cn.fromDom(document);yg.getActiveApi(n.editor).each(function(e){r.set({socketHeight:mu(n.socket,"height"),iframeHeight:mu(e.frame(),"height"),outerScroll:document.body.scrollTop}),o.set({exclusives:Gg(a,"."+kd.scrollable())}),Dr.add(n.container,gi.resolve("fullscreen-maximized")),Tg(n.container,e.body()),t.maximize(),su(n.socket,"overflow","scroll"),su(n.socket,"-webkit-overflow-scrolling","touch"),Io(e.body());var c=Mt(["cWin","ceBody","socket","toolstrip","toolbar","dropup","contentElement","cursor","keyboardType","isScrolling","outerWindow","outerBody"],[]);i.set(Bh(c({cWin:e.win(),ceBody:e.body(),socket:n.socket,toolstrip:n.toolstrip,toolbar:n.toolbar,dropup:n.dropup.element(),contentElement:e.frame(),cursor:s.noop,outerBody:n.body,outerWindow:n.win,keyboardType:Ih,isScrolling:function(){return o.get().exists(function(n){return n.socket.isScrolling()})}}))),i.run(function(n){n.syncHeight()}),u.set(Wp(e,i,n.toolstrip,n.socket,n.dropup))})},refreshStructure:function(){i.run(function(n){n.refreshStructure()})},exit:function(){t.restore(),u.clear(),i.clear(),e.show(),r.on(function(e){e.socketHeight.each(function(e){su(n.socket,"height",e)}),e.iframeHeight.each(function(e){su(n.editor.getFrame(),"height",e)}),document.body.scrollTop=e.scrollTop}),r.clear(),o.on(function(n){n.exclusives.unbind()}),o.clear(),Dr.remove(n.container,gi.resolve("fullscreen-maximized")),Og(),kd.deregister(n.toolbar),lu(n.socket,"overflow"),lu(n.socket,"-webkit-overflow-scrolling"),Fo(n.editor.getFrame()),yg.getActiveApi(n.editor).each(function(n){n.clearSelection()})}}},Hh=function(n){var e=lt.asRawOrDie("Getting IosWebapp schema",Eg,n);su(e.toolstrip,"width","100%"),su(e.container,"position","relative");var t=ed.build(Mg(function(){e.setReadOnly(!0),r.enter()},e.translate));e.alloy.add(t);var r=Fh(e,{show:function(){e.alloy.add(t)},hide:function(){e.alloy.remove(t)}});return{setReadOnly:e.setReadOnly,refreshStructure:r.refreshStructure,enter:r.enter,exit:r.exit,destroy:s.noop}},Nh=tinymce.util.Tools.resolve("tinymce.EditorManager"),Vh=function(n){var e=ge(n.settings,"skin_url").fold(function(){return Nh.baseURL+"/skins/lightgray"},function(n){return n});return{content:e+"/content.mobile.min.css",ui:e+"/skin.mobile.min.css"}},jh=function(n,e,t){n.system().broadcastOn([Wo.formatChanged()],{command:e,state:t})},Lh=function(n,e){var t=Nn.keys(e.formatter.get());D.each(t,function(t){e.formatter.formatChanged(t,function(e){jh(n,t,e)})}),D.each(["ul","ol"],function(t){e.selection.selectorChanged(t,function(e,r){jh(n,t,e)})})},Ph=(s.constant(["x-small","small","medium","large","x-large"]),function(n){var e=function(){n._skinLoaded=!0,n.fire("SkinLoaded")};return function(){n.initialized?e():n.on("init",e)}}),Wh=s.constant("toReading"),Uh=s.constant("toEditing");Vo.add("mobile",function(n){return{getNotificationManagerImpl:function(){return{open:s.identity,close:s.noop,reposition:s.noop,getArgs:s.identity}},renderUI:function(e){var t=Vh(n);!1===Po(n)?(n.contentCSS.push(t.content),jo.DOM.styleSheetLoader.load(t.ui,Ph(n))):Ph(n)();var r=function(){n.fire("scrollIntoView")},o=cn.fromTag("div"),i=un.detect().os.isAndroid()?function(n){var e=Fp({classes:[gi.resolve("android-container")]}),t=_g(),r=Yf(),o=Xg(r),i=Yg(),u=mp(s.noop,n);return e.add(t.wrapper()),e.add(i),e.add(u.component()),{system:s.constant(e),element:e.element,init:function(n){r.set(Rg(n))},exit:function(){r.run(function(n){n.exit(),bd.remove(i,o)})},setToolbarGroups:function(n){var e=t.createGroups(n);t.setGroups(e)},setContextToolbar:function(n){var e=t.createGroups(n);t.setContextToolbar(e)},focusToolbar:function(){t.focus()},restoreToolbar:function(){t.restoreToolbar()},updateMode:function(n){Jg(i,o,n,e.root())},socket:s.constant(i),dropup:s.constant(u)}}(r):function(n){var e=Fp({classes:[gi.resolve("ios-container")]}),t=_g(),r=Yf(),o=Xg(r),i=Yg(),u=mp(function(){r.run(function(n){n.refreshStructure()})},n);return e.add(t.wrapper()),e.add(i),e.add(u.component()),{system:s.constant(e),element:e.element,init:function(n){r.set(Hh(n))},exit:function(){r.run(function(n){bd.remove(i,o),n.exit()})},setToolbarGroups:function(n){var e=t.createGroups(n);t.setGroups(e)},setContextToolbar:function(n){var e=t.createGroups(n);t.setContextToolbar(e)},focusToolbar:function(){t.focus()},restoreToolbar:function(){t.restoreToolbar()},updateMode:function(n){Jg(i,o,n,e.root())},socket:s.constant(i),dropup:s.constant(u)}}(r),u=cn.fromDom(e.targetNode);Gr.after(u,o),to.attachSystem(o,i.system());var a=e.targetNode.ownerDocument.defaultView,c=Jd(a,{onChange:function(){i.system().broadcastOn([Wo.orientationChanged()],{width:Qd(a)})},onReady:s.noop}),f=function(e,t,r){!1===r&&n.selection.collapse(),i.setToolbarGroups(r?e.get():t.get()),n.setMode(!0===r?"readonly":"design"),n.fire(!0===r?Wh():Uh()),i.updateMode(r)},l=function(e,t){return n.on(e,t),{unbind:function(){n.off(e)}}};return n.on("init",function(){i.init({editor:{getFrame:function(){return cn.fromDom(n.contentAreaContainer.querySelector("iframe"))},onDomChanged:function(){return{unbind:s.noop}},onToReading:function(n){return l(Wh(),n)},onToEditing:function(n){return l(Uh(),n)},onScrollToCursor:function(e){return n.on("scrollIntoView",function(n){e(n)}),{unbind:function(){n.off("scrollIntoView"),c.destroy()}}},onTouchToolstrip:function(){e()},onTouchContent:function(){(function(n){return No(n).bind(function(n){return i.system().getByDom(n).toOption()})})(cn.fromDom(n.editorContainer.querySelector("."+gi.resolve("toolbar")))).each(Wn),i.restoreToolbar(),e()},onTapContent:function(e){var t=e.target();"img"===ir.name(t)?(n.selection.select(t.dom()),e.kill()):"a"===ir.name(t)&&i.system().getByDom(cn.fromDom(n.editorContainer)).each(function(n){Br.isAlpha(n)&&Lo(t.dom())})}},container:cn.fromDom(n.editorContainer),socket:cn.fromDom(n.contentAreaContainer),toolstrip:cn.fromDom(n.editorContainer.querySelector("."+gi.resolve("toolstrip"))),toolbar:cn.fromDom(n.editorContainer.querySelector("."+gi.resolve("toolbar"))),dropup:i.dropup(),alloy:i.system(),translate:s.noop,setReadOnly:function(n){f(m,d,n)}});var e=function(){i.dropup().disappear(function(){i.system().broadcastOn([Wo.dropupDismissed()],{})})};To("remove this",i.system());var t={label:"The first group",scrollable:!1,items:[ds.forToolbar("back",function(){n.selection.collapse(),i.exit()},{})]},r={label:"Back to read only",scrollable:!1,items:[ds.forToolbar("readonly-back",function(){f(m,d,!0)},{})]},o=Ld(i,n),u=Pd(n.settings,o),a={label:"The extra group",scrollable:!1,items:[]},d=Oo([r,{label:"the action group",scrollable:!0,items:u},a]),m=Oo([t,{label:"The read only mode group",scrollable:!0,items:[]},a]);Lh(i,n)}),{iframeContainer:i.socket().element().dom(),editorContainer:i.element().dom()}}}})}();